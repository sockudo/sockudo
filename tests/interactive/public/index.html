<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pusher WebSocket Testing Dashboard</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>
          <i class="fas fa-broadcast-tower"></i> Pusher WebSocket Testing
          Dashboard
        </h1>
        <div class="connection-indicator">
          <div class="status-dot" id="status-dot"></div>
          <span id="connection-status">Disconnected</span>
        </div>
        <div style="margin-top: 15px">
          <a
            href="/conflation-test.html"
            style="
              color: white;
              text-decoration: none;
              background: rgba(255, 255, 255, 0.2);
              padding: 8px 16px;
              border-radius: 6px;
              display: inline-block;
              font-size: 0.9rem;
            "
          >
            <i class="fas fa-compress"></i> Conflation Keys Test Suite
          </a>
        </div>
      </header>

      <div class="main-grid">
        <!-- Connection Panel -->
        <div class="panel connection-panel">
          <div class="panel-header">
            <i class="fas fa-plug"></i>
            <h2>Connection</h2>
          </div>
          <div class="panel-content">
            <div class="config-display">
              <pre id="config-display">Loading configuration...</pre>
            </div>
            <div class="button-group">
              <button id="connect-btn" class="btn btn-success" disabled>
                <i class="fas fa-play"></i> Connect
              </button>
              <button id="disconnect-btn" class="btn btn-danger" disabled>
                <i class="fas fa-stop"></i> Disconnect
              </button>
            </div>
          </div>
        </div>

        <!-- Channels Panel -->
        <div class="panel channels-panel">
          <div class="panel-header">
            <i class="fas fa-stream"></i>
            <h2>Channels</h2>
            <span class="channel-count" id="channel-count">0</span>
          </div>
          <div class="panel-content">
            <div class="input-group">
              <input
                type="text"
                id="channel-name"
                placeholder="Enter channel name (e.g., public-test, private-secret, presence-room)"
                class="input"
              />
              <button id="subscribe-btn" class="btn btn-primary" disabled>
                <i class="fas fa-plus"></i> Subscribe
              </button>
            </div>

            <div class="channel-suggestions">
              <span class="suggestion-label">Quick channels:</span>
              <button
                class="btn btn-small btn-outline"
                onclick="document.getElementById('channel-name').value='public-test'"
              >
                public-test
              </button>
              <button
                class="btn btn-small btn-outline"
                onclick="document.getElementById('channel-name').value='private-secret'"
              >
                private-secret
              </button>
              <button
                class="btn btn-small btn-outline"
                onclick="document.getElementById('channel-name').value='presence-room'"
              >
                presence-room
              </button>
            </div>

            <!-- Tag Filtering Section -->
            <div
              class="tag-filtering-section"
              style="
                margin-top: 1rem;
                padding: 1rem;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
              "
            >
              <div
                style="
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                  margin-bottom: 0.5rem;
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <i class="fas fa-filter"></i>
                  <strong>Tag Filtering</strong>
                </div>
                <label class="toggle-switch" style="margin: 0">
                  <input type="checkbox" id="enable-tag-filter" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div id="tag-filter-controls" style="display: none">
                <div class="input-group" style="margin-top: 0.5rem">
                  <select id="filter-preset" class="input" style="flex: 1">
                    <option value="">Custom Filter...</option>
                    <option value="goals">Goals Only</option>
                    <option value="goals-shots">Goals & Shots</option>
                    <option value="high-xg">High xG (â‰¥0.8)</option>
                    <option value="goals-high-xg">
                      Goals OR High xG Shots
                    </option>
                  </select>
                </div>
                <textarea
                  id="filter-json"
                  placeholder='Custom filter JSON or use preset above&#10;Example: {"key": "event_type", "cmp": "eq", "val": "goal"}'
                  class="textarea"
                  style="
                    margin-top: 0.5rem;
                    min-height: 80px;
                    font-family: monospace;
                    font-size: 0.85rem;
                  "
                ></textarea>
                <div
                  class="note"
                  style="margin-top: 0.5rem; font-size: 0.85rem"
                >
                  <i class="fas fa-info-circle"></i>
                  Filter applied only to next subscription
                </div>
              </div>
            </div>

            <div id="subscribed-channels" class="subscribed-channels"></div>
          </div>
        </div>

        <!-- Server Events Panel -->
        <div class="panel server-events-panel">
          <div class="panel-header">
            <i class="fas fa-paper-plane"></i>
            <h2>Server Events</h2>
          </div>
          <div class="panel-content">
            <div class="input-group">
              <select id="server-event-channel" class="input">
                <option value="">Select channel...</option>
              </select>
              <input
                type="text"
                id="server-event-name"
                placeholder="Event name (e.g., user-message)"
                class="input"
              />
            </div>
            <textarea
              id="server-event-data"
              placeholder='Event data (JSON): {"message": "Hello World!"}'
              class="textarea"
            ></textarea>
            <textarea
              id="server-event-tags"
              placeholder='Event tags (JSON, optional): {"event_type": "goal", "priority": "high"}'
              class="textarea"
              style="margin-top: 0.5rem; min-height: 60px"
            ></textarea>
            <div class="input-group" style="margin-top: 0.5rem">
              <input
                type="text"
                id="conflation-key"
                placeholder="Conflation key (optional, e.g., 'score_update')"
                class="input"
                style="flex: 1"
              />
            </div>
            <div class="button-group">
              <button id="send-server-event-btn" class="btn btn-primary">
                <i class="fas fa-rocket"></i> Send Event
              </button>
              <button id="send-batch-events-btn" class="btn btn-secondary">
                <i class="fas fa-layer-group"></i> Send Batch (5x)
              </button>
            </div>
            <div class="note" style="margin-top: 0.5rem">
              <i class="fas fa-info-circle"></i>
              Tags are used for server-side filtering. Conflation keys group
              messages for delta compression.
            </div>
          </div>
        </div>

        <!-- Client Events Panel -->
        <div class="panel client-events-panel">
          <div class="panel-header">
            <i class="fas fa-comments"></i>
            <h2>Client Events</h2>
          </div>
          <div class="panel-content">
            <div class="input-group">
              <select id="client-event-channel" class="input">
                <option value="">Select channel...</option>
              </select>
              <input
                type="text"
                id="client-event-name"
                placeholder="Event name (must start with 'client-')"
                class="input"
              />
            </div>
            <textarea
              id="client-event-data"
              placeholder='Event data (JSON): {"message": "Hello from client!"}'
              class="textarea"
            ></textarea>
            <button id="send-client-event-btn" class="btn btn-primary" disabled>
              <i class="fas fa-share"></i> Send Client Event
            </button>
            <div class="note">
              <i class="fas fa-info-circle"></i>
              Client events require channel authorization and server
              configuration.
            </div>
          </div>
        </div>

        <!-- Events Log Panel -->
        <div class="panel events-log-panel">
          <div class="panel-header">
            <i class="fas fa-list-alt"></i>
            <h2>Live Events</h2>
            <div class="panel-controls">
              <button id="clear-events-btn" class="btn btn-small btn-secondary">
                <i class="fas fa-trash"></i> Clear
              </button>
              <button
                id="export-events-btn"
                class="btn btn-small btn-secondary"
              >
                <i class="fas fa-download"></i> Export
              </button>
            </div>
          </div>
          <div class="panel-content">
            <div class="event-filters">
              <button class="filter-btn active" data-filter="all">All</button>
              <button class="filter-btn" data-filter="system">System</button>
              <button class="filter-btn" data-filter="custom">Custom</button>
              <button class="filter-btn" data-filter="client">Client</button>
              <button class="filter-btn" data-filter="error">Errors</button>
            </div>
            <div class="events-container">
              <ul id="events-log" class="events-list"></ul>
            </div>
          </div>
        </div>

        <!-- Presence Panel -->
        <div class="panel presence-panel">
          <div class="panel-header">
            <i class="fas fa-users"></i>
            <h2>Presence</h2>
            <span class="member-count" id="presence-count">0</span>
          </div>
          <div class="panel-content">
            <div class="presence-channel">
              Channel:
              <strong id="presence-channel-name">None</strong>
            </div>
            <div id="presence-members" class="presence-members"></div>
          </div>
        </div>

        <!-- Delta Compression Panel -->
        <div class="panel delta-panel">
          <div class="panel-header">
            <i class="fas fa-compress"></i>
            <h2>Delta Compression</h2>
            <div class="panel-controls">
              <label class="toggle-switch">
                <input type="checkbox" id="delta-compression-toggle" disabled />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="panel-content">
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-value" id="delta-enabled">Disabled</div>
                <div class="stat-label">Status</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="delta-messages">0</div>
                <div class="stat-label">Delta Messages</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="full-messages">0</div>
                <div class="stat-label">Full Messages</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="bandwidth-saved">0%</div>
                <div class="stat-label">Bandwidth Saved</div>
              </div>
            </div>
            <div class="note" style="margin-top: 1rem">
              <i class="fas fa-info-circle"></i>
              Delta compression reduces bandwidth by sending only message
              differences. Server-side per-channel configuration determines the
              algorithm used.
            </div>
          </div>
        </div>

        <!-- Statistics Panel -->
        <div class="panel stats-panel">
          <div class="panel-header">
            <i class="fas fa-chart-bar"></i>
            <h2>Statistics</h2>
          </div>
          <div class="panel-content">
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-value" id="total-events">0</div>
                <div class="stat-label">Total Events</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="total-channels">0</div>
                <div class="stat-label">Channels</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="connection-time">00:00</div>
                <div class="stat-label">Connected Time</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="webhook-count">0</div>
                <div class="stat-label">Webhooks</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Webhooks Panel -->
        <div class="panel webhooks-panel">
          <div class="panel-header">
            <i class="fas fa-webhook"></i>
            <h2>Webhooks</h2>
            <div class="panel-controls">
              <button id="fetch-webhooks-btn" class="btn btn-small btn-primary">
                <i class="fas fa-sync"></i> Refresh
              </button>
              <button
                id="clear-webhooks-btn"
                class="btn btn-small btn-secondary"
              >
                <i class="fas fa-trash"></i> Clear
              </button>
            </div>
          </div>
          <div class="panel-content">
            <div class="webhooks-container">
              <ul id="webhooks-log" class="webhooks-list"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- All dependencies bundled with Bun -->
    <script src="dist/bundle.js?v=20251215-1430"></script>
  </body>
</html>
