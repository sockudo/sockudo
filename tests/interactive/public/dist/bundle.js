var wX=(X,Z)=>()=>(Z||X((Z={exports:{}}).exports,Z),Z.exports),bX=class extends Error{constructor(X){super(X);Object.setPrototypeOf(this,new.target.prototype)}},gX=class extends Error{constructor(X){super(X);Object.setPrototypeOf(this,new.target.prototype)}},vX=class extends Error{constructor(X){super(X);Object.setPrototypeOf(this,new.target.prototype)}},hX=class extends Error{constructor(X){super(X);Object.setPrototypeOf(this,new.target.prototype)}},BX=class extends Error{constructor(X){super(X);Object.setPrototypeOf(this,new.target.prototype)}},pX=class extends Error{constructor(X){super(X);Object.setPrototypeOf(this,new.target.prototype)}},OX=class extends Error{constructor(X){super(X);Object.setPrototypeOf(this,new.target.prototype)}},a=class extends Error{status;constructor(X,Z){super(Z);this.status=X,Object.setPrototypeOf(this,new.target.prototype)}},mX="application/x-www-form-urlencoded",GX=(X,Z)=>{if(!Z)return;for(let H in Z)X.set(H,Z[H])},dX=(X,Z,H,Q,W)=>{let G=new Headers;G.set("Content-Type",mX),GX(G,H.headers),GX(G,H.headersProvider?.());let J=new Request(H.endpoint,{method:"POST",headers:G,body:Z,credentials:"same-origin"});fetch(J).then(async(R)=>{if(R.status!==200)throw new a(R.status,`Could not get ${Q.toString()} info from your auth endpoint, status: ${R.status}`);let Y=await R.text();try{W(null,JSON.parse(Y))}catch{throw new a(200,`JSON returned from ${Q.toString()} endpoint was invalid, yet status code was 200. Data was: ${Y}`)}}).catch((R)=>{W(R,null)})},JX=dX;function uX(X){return rX(oX(X))}var y=String.fromCharCode,v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",cX={};for(let X=0,Z=64;X<Z;X++)cX[v.charAt(X)]=X;var lX=function(X){let Z=X.charCodeAt(0);return Z<128?X:Z<2048?y(192|Z>>>6)+y(128|Z&63):y(224|Z>>>12&15)+y(128|Z>>>6&63)+y(128|Z&63)},oX=function(X){return X.replace(/[\u0080-\uFFFF]/g,lX)},iX=function(X){let Z=[0,2,1][X.length%3],H=X.charCodeAt(0)<<16|(X.length>1?X.charCodeAt(1):0)<<8|(X.length>2?X.charCodeAt(2):0);return[v.charAt(H>>>18),v.charAt(H>>>12&63),Z>=2?"=":v.charAt(H>>>6&63),Z>=1?"=":v.charAt(H&63)].join("")},rX=window.btoa||function(X){return X.replace(/[\s\S]{1,3}/g,iX)},sX=class{clear;timer;constructor(X,Z,H,Q){this.clear=Z,this.timer=X(()=>{if(this.timer)this.timer=Q(this.timer)},H)}isRunning(){return this.timer!==null}ensureAborted(){if(this.timer)this.clear(this.timer),this.timer=null}},PX=sX;function nX(X){window.clearTimeout(X)}function aX(X){window.clearInterval(X)}var x=class extends PX{constructor(X,Z){super(setTimeout,nX,X,function(H){return Z(),null})}},tX=class extends PX{constructor(X,Z){super(setInterval,aX,X,function(H){return Z(),H})}},T={now(){if(Date.now)return Date.now();else return new Date().valueOf()},defer(X){return new x(0,X)},method(X,...Z){let H=Array.prototype.slice.call(arguments,1);return function(Q){return Q[X].apply(Q,H.concat(arguments))}}};function N(X,...Z){for(let H=0;H<Z.length;H++){let Q=Z[H];for(let W in Q)if(Q[W]&&Q[W].constructor&&Q[W].constructor===Object)X[W]=N(X[W]||{},Q[W]);else X[W]=Q[W]}return X}function eX(){let X=["Pusher"];for(let Z=0;Z<arguments.length;Z++)if(typeof arguments[Z]==="string")X.push(arguments[Z]);else X.push(l(arguments[Z]));return X.join(" : ")}function RX(X,Z){let H=Array.prototype.indexOf;if(X===null)return-1;if(H&&X.indexOf===H)return X.indexOf(Z);for(let Q=0,W=X.length;Q<W;Q++)if(X[Q]===Z)return Q;return-1}function z(X,Z){for(let H in X)if(Object.prototype.hasOwnProperty.call(X,H))Z(X[H],H,X)}function LX(X){let Z=[];return z(X,function(H,Q){Z.push(Q)}),Z}function XZ(X){let Z=[];return z(X,function(H){Z.push(H)}),Z}function m(X,Z,H){for(let Q=0;Q<X.length;Q++)Z.call(H||window,X[Q],Q,X)}function _X(X,Z){let H=[];for(let Q=0;Q<X.length;Q++)H.push(Z(X[Q],Q,X,H));return H}function ZZ(X,Z){let H={};return z(X,function(Q,W){H[W]=Z(Q)}),H}function TX(X,Z){Z=Z||function(Q){return!!Q};let H=[];for(let Q=0;Q<X.length;Q++)if(Z(X[Q],Q,X,H))H.push(X[Q]);return H}function MX(X,Z){let H={};return z(X,function(Q,W){if(Z&&Z(Q,W,X,H)||Boolean(Q))H[W]=Q}),H}function HZ(X){let Z=[];return z(X,function(H,Q){Z.push([Q,H])}),Z}function EX(X,Z){for(let H=0;H<X.length;H++)if(Z(X[H],H,X))return!0;return!1}function QZ(X,Z){for(let H=0;H<X.length;H++)if(!Z(X[H],H,X))return!1;return!0}function WZ(X){return ZZ(X,function(Z){if(typeof Z==="object")Z=l(Z);return encodeURIComponent(uX(Z.toString()))})}function GZ(X){return _X(HZ(WZ(MX(X,function(Z){return Z!==void 0}))),T.method("join","=")).join("&")}function JZ(X){let Z=[],H=[];return function Q(W,G){let J,R,Y;switch(typeof W){case"object":if(!W)return null;for(J=0;J<Z.length;J+=1)if(Z[J]===W)return{$ref:H[J]};if(Z.push(W),H.push(G),Object.prototype.toString.apply(W)==="[object Array]"){Y=[];for(J=0;J<W.length;J+=1)Y[J]=Q(W[J],G+"["+J+"]")}else{Y={};for(R in W)if(Object.prototype.hasOwnProperty.call(W,R))Y[R]=Q(W[R],G+"["+JSON.stringify(R)+"]")}return Y;case"number":case"string":case"boolean":return W}}(X,"$")}function l(X){try{return JSON.stringify(X)}catch{return JSON.stringify(JZ(X))}}var p={logToConsole:!1};function YX(X){p={...p,...X}}var RZ=class{debug(...X){this.log(this.globalLog,X)}warn(...X){this.log(this.globalLogWarn,X)}error(...X){this.log(this.globalLogError,X)}globalLog=(X)=>{if(window.console&&window.console.log)window.console.log(X)};globalLogWarn(X){if(window.console&&window.console.warn)window.console.warn(X);else this.globalLog(X)}globalLogError(X){if(window.console&&window.console.error)window.console.error(X);else this.globalLogWarn(X)}log(X,...Z){let H=eX.apply(this,arguments);if(p.log)p.log(H);else if(p.logToConsole)X.bind(this)(H)}},w=new RZ,YZ=(X,Z)=>{return(H,Q)=>{let W=`http${Z?"s":""}://`+(X.host||X.options.host)+X.options.path,G=GZ(H);W+=`/2?${G}`,fetch(W).then(async(J)=>{if(J.status!==200)throw Error(`received ${J.status} from stats.pusher.com`);return J.json()}).then(({host:J})=>{if(J)X.host=J}).catch((J)=>{w.debug("TimelineSender Error: ",J)})}},UZ={name:"fetch",getAgent:YZ},_={VERSION:"8.4.9-next.0",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"fetch",activityTimeout:120000,pongTimeout:30000,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"fetch"},channelAuthorization:{endpoint:"/pusher/auth",transport:"fetch"},cdn_http:"//js.pusher.com/",cdn_https:"//js.pusher.com/",dependency_suffix:""};function KZ(X,Z,H){let Q=X+(Z.useTLS?"s":""),W=Z.useTLS?Z.hostTLS:Z.hostNonTLS;return Q+"://"+W+H}function VZ(X,Z){return"/app/"+X+("?protocol="+_.PROTOCOL+"&client=js&version="+_.VERSION+(Z?"&"+Z:""))}var FZ={getInitial:function(X,Z){return KZ("ws",Z,(Z.httpPath||"")+VZ(X,"flash=false"))}},jZ=class{_callbacks;constructor(){this._callbacks={}}get(X){return this._callbacks[o(X)]}add(X,Z,H){let Q=o(X);this._callbacks[Q]=this._callbacks[Q]||[],this._callbacks[Q].push({fn:Z,context:H})}remove(X,Z,H){if(!X&&!Z&&!H){this._callbacks={};return}let Q=X?[o(X)]:LX(this._callbacks);if(Z||H)this.removeCallback(Q,Z,H);else this.removeAllCallbacks(Q)}removeCallback(X,Z,H){m(X,function(Q){if(this._callbacks[Q]=TX(this._callbacks[Q]||[],function(W){return Z&&Z!==W.fn||H&&H!==W.context}),this._callbacks[Q].length===0)delete this._callbacks[Q]},this)}removeAllCallbacks(X){m(X,function(Z){delete this._callbacks[Z]},this)}};function o(X){return"_"+X}var S=class{callbacks;global_callbacks;failThrough;constructor(X){this.callbacks=new jZ,this.global_callbacks=[],this.failThrough=X}bind(X,Z,H){return this.callbacks.add(X,Z,H),this}bind_global(X){return this.global_callbacks.push(X),this}unbind(X,Z,H){return this.callbacks.remove(X,Z,H),this}unbind_global(X){if(!X)return this.global_callbacks=[],this;return this.global_callbacks=TX(this.global_callbacks||[],(Z)=>Z!==X),this}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(X,Z,H){for(let G=0;G<this.global_callbacks.length;G++)this.global_callbacks[G](X,Z);let Q=this.callbacks.get(X),W=[];if(H)W.push(Z,H);else if(Z)W.push(Z);if(Q&&Q.length>0)for(let G=0;G<Q.length;G++)Q[G].fn.apply(Q[G].context||window,W);else if(this.failThrough)this.failThrough(X,Z);return this}},qZ=class extends S{hooks;name;priority;key;options;state;timeline;activityTimeout;id;socket;beforeOpen;initialize;constructor(X,Z,H,Q,W){super();this.initialize=P.transportConnectionInitializer,this.hooks=X,this.name=Z,this.priority=H,this.key=Q,this.options=W,this.state="new",this.timeline=W.timeline,this.activityTimeout=W.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return Boolean(this.hooks.handlesActivityChecks)}supportsPing(){return Boolean(this.hooks.supportsPing)}connect(){if(this.socket||this.state!=="initialized")return!1;let X=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(X,this.options)}catch(Z){return T.defer(()=>{this.onError(Z),this.changeState("closed")}),!1}return this.bindListeners(),w.debug("Connecting",{transport:this.name,url:X}),this.changeState("connecting"),!0}close(){if(this.socket)return this.socket.close(),!0;else return!1}send(X){if(this.state==="open")return T.defer(()=>{if(this.socket)this.socket.send(X)}),!0;else return!1}ping(){if(this.state==="open"&&this.supportsPing())this.socket.ping()}onOpen(){if(this.hooks.beforeOpen)this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options));this.changeState("open"),this.socket.onopen=void 0}onError(X){this.emit("error",{type:"WebSocketError",error:X}),this.timeline.error(this.buildTimelineMessage({error:X.toString()}))}onClose(X){if(X)this.changeState("closed",{code:X.code,reason:X.reason,wasClean:X.wasClean});else this.changeState("closed");this.unbindListeners(),this.socket=void 0}onMessage(X){this.emit("message",X)}onActivity(){this.emit("activity")}bindListeners(){if(this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=(X)=>{this.onError(X)},this.socket.onclose=(X)=>{this.onClose(X)},this.socket.onmessage=(X)=>{this.onMessage(X)},this.supportsPing())this.socket.onactivity=()=>{this.onActivity()}}unbindListeners(){if(this.socket){if(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing())this.socket.onactivity=void 0}}changeState(X,Z){this.state=X,this.timeline.info(this.buildTimelineMessage({state:X,params:Z})),this.emit(X,Z)}buildTimelineMessage(X){return N({cid:this.id},X)}},CZ=class{hooks;constructor(X){this.hooks=X}isSupported(X){return this.hooks.isSupported(X)}createConnection(X,Z,H,Q){return new qZ(this.hooks,X,Z,H,Q)}},i=()=>{return globalThis.WebSocket},AZ={ws:new CZ({urls:FZ,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(i())},isSupported:function(){return Boolean(i())},getSocket:function(X){let Z=i();if(!Z)throw Error("WebSocket is not available in this environment.");return new Z(X)}})},wZ=class extends S{constructor(){super();if(window.addEventListener!==void 0)window.addEventListener("online",()=>this.emit("online"),!1),window.addEventListener("offline",()=>this.emit("offline"),!1)}isOnline(){if(window.navigator.onLine===void 0)return!0;else return window.navigator.onLine}},BZ=new wZ,OZ=class{manager;transport;minPingDelay;maxPingDelay;pingDelay;constructor(X,Z,H){this.manager=X,this.transport=Z,this.minPingDelay=H.minPingDelay,this.maxPingDelay=H.maxPingDelay,this.pingDelay=void 0}createConnection(X,Z,H,Q){Q=N({},Q,{activityTimeout:this.pingDelay});let W=this.transport.createConnection(X,Z,H,Q),G=null,J=function(){W.unbind("open",J),W.bind("closed",R),G=T.now()},R=(Y)=>{if(W.unbind("closed",R),Y.code===1002||Y.code===1003)this.manager.reportDeath();else if(!Y.wasClean&&G){let K=T.now()-G;if(K<2*this.maxPingDelay)this.manager.reportDeath(),this.pingDelay=Math.max(K/2,this.minPingDelay)}};return W.bind("open",J),W}isSupported(X){return this.manager.isAlive()&&this.transport.isSupported(X)}},IX={decodeMessage:function(X){try{let Z=JSON.parse(X.data),H=Z.data;if(typeof H==="string")try{H=JSON.parse(Z.data)}catch{}let Q={event:Z.event,channel:Z.channel,data:H,rawMessage:X.data};if(Z.user_id)Q.user_id=Z.user_id;let W=Z.__delta_seq??Z.sequence,G=Z.__conflation_key??Z.conflation_key;if(typeof W==="number")Q.sequence=W;if(G!==void 0)Q.conflation_key=G;return Q}catch(Z){throw{type:"MessageParseError",error:Z,data:X.data}}},encodeMessage:function(X){return JSON.stringify(X)},processHandshake:function(X){let Z=IX.decodeMessage(X);if(Z.event==="pusher:connection_established"){if(!Z.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:Z.data.socket_id,activityTimeout:Z.data.activity_timeout*1000}}else if(Z.event==="pusher:error")return{action:this.getCloseAction(Z.data),error:this.getCloseError(Z.data)};else throw"Invalid handshake"},getCloseAction:function(X){if(X.code<4000)if(X.code>=1002&&X.code<=1004)return"backoff";else return null;else if(X.code===4000)return"tls_only";else if(X.code<4100)return"refused";else if(X.code<4200)return"backoff";else if(X.code<4300)return"retry";else return"refused"},getCloseError:function(X){if(X.code!==1000&&X.code!==1001)return{type:"PusherError",data:{code:X.code,message:X.reason||X.message}};else return null}},f=IX,PZ=class extends S{id;transport;activityTimeout;constructor(X,Z){super();this.id=X,this.transport=Z,this.activityTimeout=Z.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(X){return this.transport.send(X)}send_event(X,Z,H){let Q={event:X,data:Z};if(H)Q.channel=H;return w.debug("Event sent",Q),this.send(f.encodeMessage(Q))}ping(){if(this.transport.supportsPing())this.transport.ping();else this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){let X={message:(H)=>{let Q;try{Q=f.decodeMessage(H)}catch(W){this.emit("error",{type:"MessageParseError",error:W,data:H.data})}if(Q!==void 0){switch(w.debug("Event recd",Q),Q.event){case"pusher:error":this.emit("error",{type:"PusherError",data:Q.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong");break}this.emit("message",Q)}},activity:()=>{this.emit("activity")},error:(H)=>{this.emit("error",H)},closed:(H)=>{if(Z(),H&&H.code)this.handleCloseEvent(H);this.transport=null,this.emit("closed")}},Z=()=>{z(X,(H,Q)=>{this.transport.unbind(Q,H)})};z(X,(H,Q)=>{this.transport.bind(Q,H)})}handleCloseEvent(X){let Z=f.getCloseAction(X),H=f.getCloseError(X);if(H)this.emit("error",H);if(Z)this.emit(Z,{action:Z,error:H})}},LZ=class{transport;callback;onMessage;onClosed;constructor(X,Z){this.transport=X,this.callback=Z,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=(X)=>{this.unbindListeners();let Z;try{Z=f.processHandshake(X)}catch(H){this.finish("error",{error:H}),this.transport.close();return}if(Z.action==="connected")this.finish("connected",{connection:new PZ(Z.id,this.transport),activityTimeout:Z.activityTimeout});else this.finish(Z.action,{error:Z.error}),this.transport.close()},this.onClosed=(X)=>{this.unbindListeners();let Z=f.getCloseAction(X)||"backoff",H=f.getCloseError(X);this.finish(Z,{error:H})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(X,Z){this.callback(N({transport:this.transport,action:X},Z))}},_Z=class{timeline;options;host;constructor(X,Z){this.timeline=X,this.options=Z||{}}send(X,Z){if(this.timeline.isEmpty())return;this.timeline.send(P.TimelineTransport.getAgent(this,X),Z)}},UX={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}},TZ=function(X){let H=UX.urls[X];if(!H)return"";let Q;if(H.fullUrl)Q=H.fullUrl;else if(H.path)Q=UX.baseUrl+H.path;if(!Q)return"";return`See: ${Q}`},e={buildLogSuffix:TZ};function MZ(X){if(X.enabled===void 0&&X.algorithm)return X.algorithm;if(X.enabled===!1&&X.algorithm===void 0)return!1;if(X.enabled===!0&&X.algorithm===void 0)return!0;return{enabled:X.enabled,algorithm:X.algorithm}}var XX=class extends S{name;pusher;subscribed;subscriptionPending;subscriptionCancelled;subscriptionCount;tagsFilter;deltaSettings;constructor(X,Z){super(function(H,Q){w.debug("No callbacks on "+X+" for "+H)});this.name=X,this.pusher=Z,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1,this.tagsFilter=null,this.deltaSettings=null}setDeltaSettings(X){this.deltaSettings=X,w.debug(`Delta settings for channel ${this.name}: ${JSON.stringify(X)}`)}getDeltaSettings(){return this.deltaSettings}authorize(X,Z){return Z(null,{auth:""})}trigger(X,Z){if(X.indexOf("client-")!==0)throw new bX("Event '"+X+"' does not start with 'client-'");if(!this.subscribed){let H=e.buildLogSuffix("triggeringClientEvents");w.warn(`Client event triggered before channel 'subscription_succeeded' event . ${H}`)}return this.pusher.send_event(X,Z,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(X){let{event:Z,data:H}=X;if(Z==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(X);else if(Z==="pusher_internal:subscription_count")this.handleSubscriptionCountEvent(X);else if(Z.indexOf("pusher_internal:")!==0)this.emit(Z,H,{})}handleSubscriptionSucceededEvent(X){if(this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled)this.pusher.unsubscribe(this.name);else this.emit("pusher:subscription_succeeded",X.data)}handleSubscriptionCountEvent(X){if(X.data.subscription_count)this.subscriptionCount=X.data.subscription_count;this.emit("pusher:subscription_count",X.data)}subscribe(){if(this.subscribed)return;this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,(X,Z)=>{if(X)this.subscriptionPending=!1,w.error(X.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:X.message},X instanceof a?{status:X.status}:{}));else{let H={auth:Z.auth,channel_data:Z.channel_data,channel:this.name};if(this.tagsFilter)H.tags_filter=this.tagsFilter;if(this.deltaSettings)H.delta=MZ(this.deltaSettings),w.debug(`Subscribing to ${this.name} with delta settings: ${JSON.stringify(H.delta)}`);this.pusher.send_event("pusher:subscribe",H)}})}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}},ZX=class extends XX{authorize(X,Z){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:X},Z)}},EZ=class{members;count;myID;me;constructor(){this.reset()}get(X){if(Object.prototype.hasOwnProperty.call(this.members,X))return{id:X,info:this.members[X]};else return null}each(X){z(this.members,(Z,H)=>{X(this.get(H))})}setMyID(X){this.myID=X}onSubscription(X){this.members=X.presence.hash,this.count=X.presence.count,this.me=this.get(this.myID)}addMember(X){if(this.get(X.user_id)===null)this.count++;return this.members[X.user_id]=X.user_info,this.get(X.user_id)}removeMember(X){let Z=this.get(X.user_id);if(Z)delete this.members[X.user_id],this.count--;return Z}reset(){this.members={},this.count=0,this.myID=null,this.me=null}},IZ=class extends ZX{members;constructor(X,Z){super(X,Z);this.members=new EZ}authorize(X,Z){super.authorize(X,async(H,Q)=>{if(!H)if(Q=Q,Q.channel_data!=null){let W=JSON.parse(Q.channel_data);this.members.setMyID(W.user_id)}else if(await this.pusher.user.signinDonePromise,this.pusher.user.user_data!=null)this.members.setMyID(this.pusher.user.user_data.id);else{let W=e.buildLogSuffix("authorizationEndpoint");w.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${W}, or the user should be signed in.`),Z("Invalid auth response");return}Z(H,Q)})}handleEvent(X){let Z=X.event;if(Z.indexOf("pusher_internal:")===0)this.handleInternalEvent(X);else{let H=X.data,Q={};if(X.user_id)Q.user_id=X.user_id;this.emit(Z,H,Q)}}handleInternalEvent(X){let{event:Z,data:H}=X;switch(Z){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(X);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(X);break;case"pusher_internal:member_added":let Q=this.members.addMember(H);this.emit("pusher:member_added",Q);break;case"pusher_internal:member_removed":let W=this.members.removeMember(H);if(W)this.emit("pusher:member_removed",W);break}}handleSubscriptionSucceededEvent(X){if(this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled)this.pusher.unsubscribe(this.name);else this.members.onSubscription(X.data),this.emit("pusher:subscription_succeeded",this.members)}disconnect(){this.members.reset(),super.disconnect()}},DZ=wX((X)=>{Object.defineProperty(X,"__esModule",{value:!0}),X.decode=X.encodedLength=X.encode=void 0;var Z="utf8: invalid string",H="utf8: invalid source encoding";function Q(J){let R=new Uint8Array(W(J)),Y=0;for(let K=0;K<J.length;K++){let F=J.charCodeAt(K);if(F>=55296&&F<=56319)F=(F-55296<<10)+(J.charCodeAt(++K)-56320)+65536;if(F<128)R[Y++]=F;else if(F<2048)R[Y++]=192|F>>6,R[Y++]=128|F&63;else if(F<65536)R[Y++]=224|F>>12,R[Y++]=128|F>>6&63,R[Y++]=128|F&63;else R[Y++]=240|F>>18,R[Y++]=128|F>>12&63,R[Y++]=128|F>>6&63,R[Y++]=128|F&63}return R}X.encode=Q;function W(J){let R=0;for(let Y=0;Y<J.length;Y++){let K=J.charCodeAt(Y);if(K>=55296&&K<=56319){if(Y===J.length-1)throw Error(Z);Y++;let F=J.charCodeAt(Y);if(F<56320||F>57343)throw Error(Z);K=(K-55296<<10)+(F-56320)+65536}if(K<128)R+=1;else if(K<2048)R+=2;else if(K<65536)R+=3;else R+=4}return R}X.encodedLength=W;function G(J){let R=[];for(let Y=0;Y<J.length;Y++){let K=J[Y];if(K&128){let F;if(K<224){if(Y>=J.length)throw Error(H);let C=J[++Y];if((C&192)!==128)throw Error(H);K=(K&31)<<6|C&63,F=128}else if(K<240){if(Y>=J.length-1)throw Error(H);let C=J[++Y],U=J[++Y];if((C&192)!==128||(U&192)!==128)throw Error(H);K=(K&15)<<12|(C&63)<<6|U&63,F=2048}else if(K<248){if(Y>=J.length-2)throw Error(H);let C=J[++Y],U=J[++Y],V=J[++Y];if((C&192)!==128||(U&192)!==128||(V&192)!==128)throw Error(H);K=(K&15)<<18|(C&63)<<12|(U&63)<<6|V&63,F=65536}else throw Error(H);if(K<F||K>=55296&&K<=57343)throw Error(H);if(K>=65536){if(K>1114111)throw Error(H);K-=65536,R.push(String.fromCharCode(55296|K>>10)),K=56320|K&1023}}R.push(String.fromCharCode(K))}return R.join("")}X.decode=G}),zZ=wX((X)=>{var Z=X&&X.__extends||function(){var J=function(R,Y){return J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,F){K.__proto__=F}||function(K,F){for(var C in F)if(F.hasOwnProperty(C))K[C]=F[C]},J(R,Y)};return function(R,Y){J(R,Y);function K(){this.constructor=R}R.prototype=Y===null?Object.create(Y):(K.prototype=Y.prototype,new K)}}();Object.defineProperty(X,"__esModule",{value:!0});var H=256,Q=function(){function J(R){if(R===void 0)R="=";this._paddingCharacter=R}return J.prototype.encodedLength=function(R){if(!this._paddingCharacter)return(R*8+5)/6|0;return(R+2)/3*4|0},J.prototype.encode=function(R){var Y="",K=0;for(;K<R.length-2;K+=3){var F=R[K]<<16|R[K+1]<<8|R[K+2];Y+=this._encodeByte(F>>>18&63),Y+=this._encodeByte(F>>>12&63),Y+=this._encodeByte(F>>>6&63),Y+=this._encodeByte(F>>>0&63)}var C=R.length-K;if(C>0){var F=R[K]<<16|(C===2?R[K+1]<<8:0);if(Y+=this._encodeByte(F>>>18&63),Y+=this._encodeByte(F>>>12&63),C===2)Y+=this._encodeByte(F>>>6&63);else Y+=this._paddingCharacter||"";Y+=this._paddingCharacter||""}return Y},J.prototype.maxDecodedLength=function(R){if(!this._paddingCharacter)return(R*6+7)/8|0;return R/4*3|0},J.prototype.decodedLength=function(R){return this.maxDecodedLength(R.length-this._getPaddingLength(R))},J.prototype.decode=function(R){if(R.length===0)return new Uint8Array(0);var Y=this._getPaddingLength(R),K=R.length-Y,F=new Uint8Array(this.maxDecodedLength(K)),C=0,U=0,V=0,j=0,q=0,B=0,O=0;for(;U<K-4;U+=4)j=this._decodeChar(R.charCodeAt(U+0)),q=this._decodeChar(R.charCodeAt(U+1)),B=this._decodeChar(R.charCodeAt(U+2)),O=this._decodeChar(R.charCodeAt(U+3)),F[C++]=j<<2|q>>>4,F[C++]=q<<4|B>>>2,F[C++]=B<<6|O,V|=j&H,V|=q&H,V|=B&H,V|=O&H;if(U<K-1)j=this._decodeChar(R.charCodeAt(U)),q=this._decodeChar(R.charCodeAt(U+1)),F[C++]=j<<2|q>>>4,V|=j&H,V|=q&H;if(U<K-2)B=this._decodeChar(R.charCodeAt(U+2)),F[C++]=q<<4|B>>>2,V|=B&H;if(U<K-3)O=this._decodeChar(R.charCodeAt(U+3)),F[C++]=B<<6|O,V|=O&H;if(V!==0)throw Error("Base64Coder: incorrect characters for decoding");return F},J.prototype._encodeByte=function(R){var Y=R;return Y+=65,Y+=25-R>>>8&6,Y+=51-R>>>8&-75,Y+=61-R>>>8&-15,Y+=62-R>>>8&3,String.fromCharCode(Y)},J.prototype._decodeChar=function(R){var Y=H;return Y+=(42-R&R-44)>>>8&-H+R-43+62,Y+=(46-R&R-48)>>>8&-H+R-47+63,Y+=(47-R&R-58)>>>8&-H+R-48+52,Y+=(64-R&R-91)>>>8&-H+R-65+0,Y+=(96-R&R-123)>>>8&-H+R-97+26,Y},J.prototype._getPaddingLength=function(R){var Y=0;if(this._paddingCharacter){for(var K=R.length-1;K>=0;K--){if(R[K]!==this._paddingCharacter)break;Y++}if(R.length<4||Y>2)throw Error("Base64Coder: incorrect padding")}return Y},J}(),W=new Q;function G(J){return W.decode(J)}X.decode=G,new(function(J){Z(R,J);function R(){return J!==null&&J.apply(this,arguments)||this}return R.prototype._encodeByte=function(Y){var K=Y;return K+=65,K+=25-Y>>>8&6,K+=51-Y>>>8&-75,K+=61-Y>>>8&-13,K+=62-Y>>>8&49,String.fromCharCode(K)},R.prototype._decodeChar=function(Y){var K=H;return K+=(44-Y&Y-46)>>>8&-H+Y-45+62,K+=(94-Y&Y-96)>>>8&-H+Y-95+63,K+=(47-Y&Y-58)>>>8&-H+Y-48+52,K+=(64-Y&Y-91)>>>8&-H+Y-65+0,K+=(96-Y&Y-123)>>>8&-H+Y-97+26,K},R}(Q))}),SZ=DZ(),r=zZ(),NZ=class extends ZX{key=null;nacl;constructor(X,Z,H){super(X,Z);this.nacl=H}authorize(X,Z){super.authorize(X,(H,Q)=>{if(H){Z(H,Q);return}let W=Q.shared_secret;if(!W){Z(Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null);return}this.key=(0,r.decode)(W),delete Q.shared_secret,Z(null,Q)})}trigger(X,Z){throw new BX("Client events are not currently supported for encrypted channels")}handleEvent(X){let{event:Z,data:H}=X;if(Z.indexOf("pusher_internal:")===0||Z.indexOf("pusher:")===0){super.handleEvent(X);return}this.handleEncryptedEvent(Z,H)}handleEncryptedEvent(X,Z){if(!this.key){w.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!Z.ciphertext||!Z.nonce){w.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+Z);return}let H=(0,r.decode)(Z.ciphertext);if(H.length<this.nacl.secretbox.overheadLength){w.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${H.length}`);return}let Q=(0,r.decode)(Z.nonce);if(Q.length<this.nacl.secretbox.nonceLength){w.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${Q.length}`);return}let W=this.nacl.secretbox.open(H,Q,this.key);if(W===null){w.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),this.authorize(this.pusher.connection.socket_id,(G,J)=>{if(G){w.error(`Failed to make a request to the authEndpoint: ${J}. Unable to fetch new key, so dropping encrypted event`);return}if(W=this.nacl.secretbox.open(H,Q,this.key),W===null){w.error("Failed to decrypt event with new key. Dropping encrypted event");return}this.emit(X,this.getDataToEmit(W))});return}this.emit(X,this.getDataToEmit(W))}getDataToEmit(X){let Z=(0,SZ.decode)(X);try{return JSON.parse(Z)}catch{return Z}}},$Z=class extends S{key;options;state;connection;usingTLS;timeline;socket_id;unavailableTimer;activityTimer;retryTimer;activityTimeout;strategy;runner;errorCallbacks;handshakeCallbacks;connectionCallbacks;constructor(X,Z){super();this.state="initialized",this.connection=null,this.key=X,this.options=Z,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);let H=P.getNetwork();H.bind("online",()=>{if(this.timeline.info({netinfo:"online"}),this.state==="connecting"||this.state==="unavailable")this.retryIn(0)}),H.bind("offline",()=>{if(this.timeline.info({netinfo:"offline"}),this.connection)this.sendActivityCheck()}),this.updateStrategy()}connect(){if(this.connection||this.runner)return;if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}send(X){if(this.connection)return this.connection.send(X);else return!1}send_event(X,Z,H){if(this.connection)return this.connection.send_event(X,Z,H);else return!1}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){let X=(Z,H)=>{if(Z)this.runner=this.strategy.connect(0,X);else if(H.action==="error")this.emit("error",{type:"HandshakeError",error:H.error}),this.timeline.error({handshakeError:H.error});else this.abortConnecting(),this.handshakeCallbacks[H.action](H)};this.runner=this.strategy.connect(0,X)}abortConnecting(){if(this.runner)this.runner.abort(),this.runner=null}disconnectInternally(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection)this.abandonConnection().close()}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(X){if(this.timeline.info({action:"retry",delay:X}),X>0)this.emit("connecting_in",Math.round(X/1000));this.retryTimer=new x(X||0,()=>{this.disconnectInternally(),this.connect()})}clearRetryTimer(){if(this.retryTimer)this.retryTimer.ensureAborted(),this.retryTimer=null}setUnavailableTimer(){this.unavailableTimer=new x(this.options.unavailableTimeout,()=>{this.updateState("unavailable")})}clearUnavailableTimer(){if(this.unavailableTimer)this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new x(this.options.pongTimeout,()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)})}resetActivityCheck(){if(this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks())this.activityTimer=new x(this.activityTimeout,()=>{this.sendActivityCheck()})}stopActivityCheck(){if(this.activityTimer)this.activityTimer.ensureAborted()}buildConnectionCallbacks(X){return N({},X,{message:(Z)=>{this.resetActivityCheck(),this.emit("message",Z)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:(Z)=>{this.emit("error",Z)},closed:()=>{if(this.abandonConnection(),this.shouldRetry())this.retryIn(1000)}})}buildHandshakeCallbacks(X){return N({},X,{connected:(Z)=>{this.activityTimeout=Math.min(this.options.activityTimeout,Z.activityTimeout,Z.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(Z.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let X=(Z)=>{return(H)=>{if(H.error)this.emit("error",{type:"WebSocketError",error:H.error});Z(H)}};return{tls_only:X(()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)}),refused:X(()=>{this.disconnect()}),backoff:X(()=>{this.retryIn(1000)}),retry:X(()=>{this.retryIn(0)})}}setConnection(X){this.connection=X;for(let Z in this.connectionCallbacks)this.connection.bind(Z,this.connectionCallbacks[Z]);this.resetActivityCheck()}abandonConnection(){if(!this.connection)return;this.stopActivityCheck();for(let Z in this.connectionCallbacks)this.connection.unbind(Z,this.connectionCallbacks[Z]);let X=this.connection;return this.connection=null,X}updateState(X,Z){let H=this.state;if(this.state=X,H!==X){let Q=X;if(Q==="connected")Q+=" with new socket ID "+Z.socket_id;w.debug("State changed",H+" -> "+Q),this.timeline.info({state:X,params:Z}),this.emit("state_change",{previous:H,current:X}),this.emit(X,Z)}}shouldRetry(){return this.state==="connecting"||this.state==="connected"}},xZ=class{channels;constructor(){this.channels={}}add(X,Z){if(!this.channels[X])this.channels[X]=fZ(X,Z);return this.channels[X]}all(){return XZ(this.channels)}find(X){return this.channels[X]}remove(X){let Z=this.channels[X];return delete this.channels[X],Z}disconnect(){z(this.channels,function(X){X.disconnect()})}};function fZ(X,Z){if(X.indexOf("private-encrypted-")===0){if(Z.config.nacl)return D.createEncryptedChannel(X,Z,Z.config.nacl);throw new BX(`Tried to subscribe to a private-encrypted- channel but no nacl implementation available. ${e.buildLogSuffix("encryptedChannelSupport")}`)}else if(X.indexOf("private-")===0)return D.createPrivateChannel(X,Z);else if(X.indexOf("presence-")===0)return D.createPresenceChannel(X,Z);else if(X.indexOf("#")===0)throw new gX('Cannot create a channel with name "'+X+'".');else return D.createChannel(X,Z)}var D={createChannels(){return new xZ},createConnectionManager(X,Z){return new $Z(X,Z)},createChannel(X,Z){return new XX(X,Z)},createPrivateChannel(X,Z){return new ZX(X,Z)},createPresenceChannel(X,Z){return new IZ(X,Z)},createEncryptedChannel(X,Z,H){return new NZ(X,Z,H)},createTimelineSender(X,Z){return new _Z(X,Z)},createHandshake(X,Z){return new LZ(X,Z)},createAssistantToTheTransportManager(X,Z,H){return new OZ(X,Z,H)}},kZ=class{options;livesLeft;constructor(X){this.options=X||{},this.livesLeft=this.options.lives||1/0}getAssistant(X){return D.createAssistantToTheTransportManager(this,X,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}},t=class{strategies;loop;failFast;timeout;timeoutLimit;constructor(X,Z){this.strategies=X,this.loop=Boolean(Z.loop),this.failFast=Boolean(Z.failFast),this.timeout=Z.timeout,this.timeoutLimit=Z.timeoutLimit}isSupported(){return EX(this.strategies,T.method("isSupported"))}connect(X,Z){let H=this.strategies,Q=0,W=this.timeout,G=null,J=(R,Y)=>{if(Y)Z(null,Y);else{if(Q=Q+1,this.loop)Q=Q%H.length;if(Q<H.length){if(W){if(W=W*2,this.timeoutLimit)W=Math.min(W,this.timeoutLimit)}G=this.tryStrategy(H[Q],X,{timeout:W,failFast:this.failFast},J)}else Z(!0)}};return G=this.tryStrategy(H[Q],X,{timeout:W,failFast:this.failFast},J),{abort:function(){G.abort()},forceMinPriority:function(R){if(X=R,G)G.forceMinPriority(R)}}}tryStrategy(X,Z,H,Q){let W=null,G=null;if(H.timeout>0)W=new x(H.timeout,function(){G.abort(),Q(!0)});return G=X.connect(Z,function(J,R){if(J&&W&&W.isRunning()&&!H.failFast)return;if(W)W.ensureAborted();Q(J,R)}),{abort:function(){if(W)W.ensureAborted();G.abort()},forceMinPriority:function(J){G.forceMinPriority(J)}}}},yZ=class{strategies;constructor(X){this.strategies=X}isSupported(){return EX(this.strategies,T.method("isSupported"))}connect(X,Z){return bZ(this.strategies,X,function(H,Q){return function(W,G){if(Q[H].error=W,W){if(gZ(Q))Z(!0);return}m(Q,function(J){J.forceMinPriority(G.transport.priority)}),Z(null,G)}})}};function bZ(X,Z,H){let Q=_X(X,function(W,G,J,R){return W.connect(Z,H(G,R))});return{abort:function(){m(Q,vZ)},forceMinPriority:function(W){m(Q,function(G){G.forceMinPriority(W)})}}}function gZ(X){return QZ(X,function(Z){return Boolean(Z.error)})}function vZ(X){if(!X.error&&!X.aborted)X.abort(),X.aborted=!0}var hZ=class{strategy;transports;ttl;usingTLS;timeline;constructor(X,Z,H){this.strategy=X,this.transports=Z,this.ttl=H.ttl||1800000,this.usingTLS=H.useTLS,this.timeline=H.timeline}isSupported(){return this.strategy.isSupported()}connect(X,Z){let H=this.usingTLS,Q=pZ(H),W=Q&&Q.cacheSkipCount?Q.cacheSkipCount:0,G=[this.strategy];if(Q&&Q.timestamp+this.ttl>=T.now()){let Y=this.transports[Q.transport];if(Y)if(["ws","wss"].includes(Q.transport)||W>3)this.timeline.info({cached:!0,transport:Q.transport,latency:Q.latency}),G.push(new t([Y],{timeout:Q.latency*2+1000,failFast:!0}));else W++}let J=T.now(),R=G.pop().connect(X,function Y(K,F){if(K)if(DX(H),G.length>0)J=T.now(),R=G.pop().connect(X,Y);else Z(K);else mZ(H,F.transport.name,T.now()-J,W),Z(null,F)});return{abort:function(){R.abort()},forceMinPriority:function(Y){if(X=Y,R)R.forceMinPriority(Y)}}}};function HX(X){return"pusherTransport"+(X?"TLS":"NonTLS")}function pZ(X){let Z=P.getLocalStorage();if(Z)try{let H=Z[HX(X)];if(H)return JSON.parse(H)}catch{DX(X)}return null}function mZ(X,Z,H,Q){let W=P.getLocalStorage();if(W)try{W[HX(X)]=l({timestamp:T.now(),transport:Z,latency:H,cacheSkipCount:Q})}catch{}}function DX(X){let Z=P.getLocalStorage();if(Z)try{delete Z[HX(X)]}catch{}}var dZ=class{strategy;options;constructor(X,{delay:Z}){this.strategy=X,this.options={delay:Z}}isSupported(){return this.strategy.isSupported()}connect(X,Z){let H=this.strategy,Q,W=new x(this.options.delay,function(){Q=H.connect(X,Z)});return{abort:function(){if(W.ensureAborted(),Q)Q.abort()},forceMinPriority:function(G){if(X=G,Q)Q.forceMinPriority(G)}}}},uZ=class{strategy;constructor(X){this.strategy=X}isSupported(){return this.strategy.isSupported()}connect(X,Z){let H=this.strategy.connect(X,function(Q,W){if(W)H.abort();Z(Q,W)});return H}},cZ=(X,Z,H)=>{let Q={},W=(V,j,q,B,O)=>{let M=H(X,V,j,q,B,O);return Q[V]=M,M},G=Object.assign({},Z,{hostNonTLS:`${X.wsHost}:${X.wsPort}`,hostTLS:`${X.wsHost}:${X.wssPort}`,httpPath:X.wsPath}),J=Object.assign({},G,{useTLS:!0}),R={loop:!0,timeout:15000,timeoutLimit:60000},Y=new kZ({minPingDelay:1e4,maxPingDelay:X.activityTimeout}),K=W("ws","ws",3,G,Y),F=W("wss","ws",3,J,Y),C=new t([K],R),U=new t([F],R);return new hZ(new uZ(Z.useTLS?C:new yZ([C,new dZ(U,{delay:2000})])),Q,{ttl:1800000,timeline:Z.timeline,useTLS:Z.useTLS})},lZ=cZ;function oZ(){if(this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.useTLS?"s":"")})),this.hooks.isInitialized())this.changeState("initialized");else this.onClose()}var iZ=262144,rZ=class extends S{hooks;method;url;position;xhr;unloader;constructor(X,Z,H){super();this.hooks=X,this.method=Z,this.url=H}start(X){if(this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},P.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader)this.xhr.setRequestHeader("Content-Type","application/json");this.xhr.send(X)}close(){if(this.unloader)P.removeUnloadListener(this.unloader),this.unloader=null;if(this.xhr)this.hooks.abortRequest(this.xhr),this.xhr=null}onChunk(X,Z){while(!0){let H=this.advanceBuffer(Z);if(H)this.emit("chunk",{status:X,data:H});else break}if(this.isBufferTooLong(Z))this.emit("buffer_too_long")}advanceBuffer(X){let Z=X.slice(this.position),H=Z.indexOf(`
`);if(H!==-1)return this.position+=H+1,Z.slice(0,H);else return null}isBufferTooLong(X){return this.position===X.length&&X.length>iZ}},zX=function(X){return X[X.CONNECTING=0]="CONNECTING",X[X.OPEN=1]="OPEN",X[X.CLOSED=3]="CLOSED",X}(zX||{}),$=zX,sZ=1,nZ=class{hooks;session;location;readyState;stream;createRequest;onopen;onerror;onclose;onmessage;onactivity;constructor(X,Z,H){this.hooks=X,this.createRequest=H,this.session=SX(1000)+"/"+X6(8),this.location=aZ(Z),this.readyState=$.CONNECTING,this.openStream()}send(X){return this.sendRaw(JSON.stringify([X]))}ping(){this.hooks.sendHeartbeat(this)}close(X,Z){this.onClose(X,Z,!0)}sendRaw(X){if(this.readyState===$.OPEN)try{return this.createRequest("POST",KX(tZ(this.location,this.session))).start(X),!0}catch{return!1}else return!1}reconnect(){this.closeStream(),this.openStream()}onClose(X,Z,H){if(this.closeStream(),this.readyState=$.CLOSED,this.onclose)this.onclose({code:X,reason:Z,wasClean:H})}onChunk(X){if(X.status!==200)return;if(this.readyState===$.OPEN)this.onActivity();let Z;switch(X.data.slice(0,1)){case"o":Z=JSON.parse(X.data.slice(1)||"{}"),this.onOpen(Z);break;case"a":Z=JSON.parse(X.data.slice(1)||"[]");for(let H=0;H<Z.length;H++)this.onEvent(Z[H]);break;case"m":Z=JSON.parse(X.data.slice(1)||"null"),this.onEvent(Z);break;case"h":this.hooks.onHeartbeat(this);break;case"c":Z=JSON.parse(X.data.slice(1)||"[]"),this.onClose(Z[0],Z[1],!0);break}}onOpen(X){if(this.readyState===$.CONNECTING){if(X&&X.hostname)this.location.base=eZ(this.location.base,X.hostname);if(this.readyState=$.OPEN,this.onopen)this.onopen()}else this.onClose(1006,"Server lost session",!0)}onEvent(X){if(this.readyState===$.OPEN&&this.onmessage)this.onmessage({data:X})}onActivity(){if(this.onactivity)this.onactivity()}onError(X){if(this.onerror)this.onerror(X)}openStream(){this.stream=this.createRequest("POST",KX(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",(X)=>{this.onChunk(X)}),this.stream.bind("finished",(X)=>{this.hooks.onFinished(this,X)}),this.stream.bind("buffer_too_long",()=>{this.reconnect()});try{this.stream.start()}catch(X){T.defer(()=>{this.onError(X),this.onClose(1006,"Could not start streaming",!1)})}}closeStream(){if(this.stream)this.stream.unbind_all(),this.stream.close(),this.stream=null}};function aZ(X){let Z=/([^?]*)\/*(\??.*)/.exec(X);return{base:Z[1],queryString:Z[2]}}function tZ(X,Z){return X.base+"/"+Z+"/xhr_send"}function KX(X){return X+(X.indexOf("?")===-1?"?":"&")+"t="+ +new Date+"&n="+sZ++}function eZ(X,Z){let H=/(https?:\/\/)([^/:]+)((\/|:)?.*)/.exec(X);return H[1]+Z+H[3]}function SX(X){if(!Number.isFinite(X)||X<=0)return 0;let Z=globalThis.crypto;if(Z?.getRandomValues){let H=Z.getRandomValues(new Uint32Array(1))[0];return Math.floor(H/4294967296*X)}return Math.floor(Math.random()*X)}function X6(X){let Z=[];for(let H=0;H<X;H++)Z.push(SX(32).toString(32));return Z.join("")}var Z6=nZ,H6={getReceiveURL:function(X,Z){return X.base+"/"+Z+"/xhr_streaming"+X.queryString},onHeartbeat:function(X){X.sendRaw("[]")},sendHeartbeat:function(X){X.sendRaw("[]")},onFinished:function(X,Z){X.onClose(1006,"Connection interrupted ("+Z+")",!1)}},Q6={getReceiveURL:function(X,Z){return X.base+"/"+Z+"/xhr"+X.queryString},onHeartbeat:function(){},sendHeartbeat:function(X){X.sendRaw("[]")},onFinished:function(X,Z){if(Z===200)X.reconnect();else X.onClose(1006,"Connection interrupted ("+Z+")",!1)}},W6=()=>{return globalThis.XMLHttpRequest},G6={getRequest:function(X){let Z=W6();if(!Z)throw Error("XMLHttpRequest is not available in this environment.");let H=new Z;return H.onreadystatechange=H.onprogress=function(){switch(H.readyState){case 3:if(H.responseText&&H.responseText.length>0)X.onChunk(H.status,H.responseText);break;case 4:if(H.responseText&&H.responseText.length>0)X.onChunk(H.status,H.responseText);X.emit("finished",H.status),X.close();break}},H},abortRequest:function(X){X.onreadystatechange=null,X.abort()}},P={getDefaultStrategy:lZ,Transports:AZ,transportConnectionInitializer:oZ,HTTPFactory:{createStreamingSocket(X){return this.createSocket(H6,X)},createPollingSocket(X){return this.createSocket(Q6,X)},createSocket(X,Z){return new Z6(X,Z,(H,Q)=>this.createXHR(H,Q))},createXHR(X,Z){return this.createRequest(G6,X,Z)},createRequest(X,Z,H){return new rZ(X,Z,H)}},TimelineTransport:UZ,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(X){window.Pusher=X,this.onDocumentBody(X.ready)},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{fetch:JX,ajax:JX}},onDocumentBody(X){if(document.body){X();return}setTimeout(()=>{this.onDocumentBody(X)},0)},getLocalStorage(){try{return window.localStorage}catch{return}},createXHR(){return this.createXMLHttpRequest()},createXMLHttpRequest(){let X=this.getXHRAPI();if(!X)throw Error("XMLHttpRequest is not available in this environment.");return new X},getNetwork(){return BZ},createWebSocket(X){return new(this.getWebSocketAPI())(X)},isXHRSupported(){let X=this.getXHRAPI();return Boolean(X)&&new X().withCredentials!==void 0},addUnloadListener(X){if(window.addEventListener!==void 0)window.addEventListener("unload",X,!1);else if(window.attachEvent!==void 0)window.attachEvent("onunload",X)},removeUnloadListener(X){if(window.addEventListener!==void 0)window.removeEventListener("unload",X,!1);else if(window.detachEvent!==void 0)window.detachEvent("onunload",X)},randomInt(X){if(!Number.isFinite(X)||X<=0)return 0;let Z=window.crypto||window.msCrypto;if(Z?.getRandomValues){let H=Z.getRandomValues(new Uint32Array(1))[0];return Math.floor(H/4294967296*X)}return Math.floor(Math.random()*X)}},NX=function(X){return X[X.ERROR=3]="ERROR",X[X.INFO=6]="INFO",X[X.DEBUG=7]="DEBUG",X}(NX||{}),u=NX,J6=class{key;session;events;options;sent;uniqueID;constructor(X,Z,H){this.key=X,this.session=Z,this.events=[],this.options=H||{},this.sent=0,this.uniqueID=0}log(X,Z){if(X<=this.options.level){if(this.events.push(N({},Z,{timestamp:T.now()})),this.options.limit&&this.events.length>this.options.limit)this.events.shift()}}error(X){this.log(u.ERROR,X)}info(X){this.log(u.INFO,X)}debug(X){this.log(u.DEBUG,X)}isEmpty(){return this.events.length===0}send(X,Z){let H=N({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],X(H,(Q,W)=>{if(!Q)this.sent++;if(Z)Z(Q,W)}),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}},R6=class{name;priority;transport;options;constructor(X,Z,H,Q){this.name=X,this.priority=Z,this.transport=H,this.options=Q||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(X,Z){if(!this.isSupported())return VX(new OX,Z);else if(this.priority<X)return VX(new vX,Z);let H=!1,Q=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),W=null,G=function(){Q.unbind("initialized",G),Q.connect()},J=function(){W=D.createHandshake(Q,function(F){H=!0,K(),Z(null,F)})},R=function(F){K(),Z(F)},Y=function(){K();let F;F=l(Q),Z(new hX(F))},K=function(){Q.unbind("initialized",G),Q.unbind("open",J),Q.unbind("error",R),Q.unbind("closed",Y)};return Q.bind("initialized",G),Q.bind("open",J),Q.bind("error",R),Q.bind("closed",Y),Q.initialize(),{abort:()=>{if(H)return;if(K(),W)W.close();else Q.close()},forceMinPriority:(F)=>{if(H)return;if(this.priority<F)if(W)W.close();else Q.close()}}}};function VX(X,Z){return T.defer(function(){Z(X)}),{abort:function(){},forceMinPriority:function(){}}}var{Transports:Y6}=P,U6=function(X,Z,H,Q,W,G){let J=Y6[H];if(!J)throw new pX(H);let R=(!X.enabledTransports||RX(X.enabledTransports,Z)!==-1)&&(!X.disabledTransports||RX(X.disabledTransports,Z)===-1),Y;if(R)W=Object.assign({ignoreNullOrigin:X.ignoreNullOrigin},W),Y=new R6(Z,Q,G?G.getAssistant(J):J,W);else Y=K6;return Y},K6={isSupported:function(){return!1},connect:function(X,Z){let H=T.defer(function(){Z(new OX)});return{abort:function(){H.ensureAborted()},forceMinPriority:function(){}}}};function V6(X){if(X==null)throw"You must pass an options object";if(X.cluster==null)throw"Options object must provide a cluster";if("disableStats"in X)w.warn("The disableStats option is deprecated in favor of enableStats")}var $X=function(X){return X.UserAuthentication="user-authentication",X.ChannelAuthorization="channel-authorization",X}({}),F6=(X,Z)=>{let H="socket_id="+encodeURIComponent(X.socketId);for(let Q in Z.params)H+="&"+encodeURIComponent(Q)+"="+encodeURIComponent(Z.params[Q]);if(Z.paramsProvider!=null){let Q=Z.paramsProvider();for(let W in Q)H+="&"+encodeURIComponent(W)+"="+encodeURIComponent(Q[W])}return H},j6=(X)=>{if(typeof P.getAuthorizers()[X.transport]>"u")throw`'${X.transport}' is not a recognized auth transport`;return(Z,H)=>{let Q=F6(Z,X);P.getAuthorizers()[X.transport](P,Q,X,$X.UserAuthentication,H)}},q6=j6,C6=(X,Z)=>{let H="socket_id="+encodeURIComponent(X.socketId);H+="&channel_name="+encodeURIComponent(X.channelName);for(let Q in Z.params)H+="&"+encodeURIComponent(Q)+"="+encodeURIComponent(Z.params[Q]);if(Z.paramsProvider!=null){let Q=Z.paramsProvider();for(let W in Q)H+="&"+encodeURIComponent(W)+"="+encodeURIComponent(Q[W])}return H},A6=(X)=>{if(typeof P.getAuthorizers()[X.transport]>"u")throw`'${X.transport}' is not a recognized auth transport`;return(Z,H)=>{let Q=C6(Z,X);P.getAuthorizers()[X.transport](P,Q,X,$X.ChannelAuthorization,H)}},w6=A6,B6=(X,Z,H)=>{let Q={authTransport:Z.transport,authEndpoint:Z.endpoint,auth:{params:Z.params,headers:Z.headers}};return(W,G)=>{H(X.channel(W.channelName),Q).authorize(W.socketId,G)}};function O6(X,Z){let H={activityTimeout:X.activityTimeout||_.activityTimeout,cluster:X.cluster,httpPath:X.httpPath||_.httpPath,httpPort:X.httpPort||_.httpPort,httpsPort:X.httpsPort||_.httpsPort,pongTimeout:X.pongTimeout||_.pongTimeout,statsHost:X.statsHost||_.stats_host,unavailableTimeout:X.unavailableTimeout||_.unavailableTimeout,wsPath:X.wsPath||_.wsPath,wsPort:X.wsPort||_.wsPort,wssPort:X.wssPort||_.wssPort,enableStats:M6(X),httpHost:P6(X),useTLS:T6(X),wsHost:L6(X),userAuthenticator:E6(X),channelAuthorizer:D6(X,Z)};if("disabledTransports"in X)H.disabledTransports=X.disabledTransports;if("enabledTransports"in X)H.enabledTransports=X.enabledTransports;if("ignoreNullOrigin"in X)H.ignoreNullOrigin=X.ignoreNullOrigin;if("timelineParams"in X)H.timelineParams=X.timelineParams;if("nacl"in X)H.nacl=X.nacl;return H}function P6(X){if(X.httpHost)return X.httpHost;if(X.cluster)return`sockjs-${X.cluster}.pusher.com`;return _.httpHost}function L6(X){if(X.wsHost)return X.wsHost;return _6(X.cluster)}function _6(X){return`ws-${X}.pusher.com`}function T6(X){if(P.getProtocol()==="https:")return!0;else if(X.forceTLS===!1)return!1;return!0}function M6(X){if("enableStats"in X)return X.enableStats;if("disableStats"in X)return!X.disableStats;return!1}function E6(X){let Z={..._.userAuthentication,...X.userAuthentication};if("customHandler"in Z&&Z.customHandler!=null)return Z.customHandler;return q6(Z)}function I6(X,Z){let H;if("channelAuthorization"in X)H={..._.channelAuthorization,...X.channelAuthorization};else{if(H={transport:X.authTransport||_.authTransport,endpoint:X.authEndpoint||_.authEndpoint},"auth"in X){if("params"in X.auth)H.params=X.auth.params;if("headers"in X.auth)H.headers=X.auth.headers}if("authorizer"in X)H.customHandler=B6(Z,H,X.authorizer)}return H}function D6(X,Z){let H=I6(X,Z);if("customHandler"in H&&H.customHandler!=null)return H.customHandler;return w6(H)}var z6=class extends S{pusher;constructor(X){super(function(Z,H){w.debug(`No callbacks on watchlist events for ${Z}`)});this.pusher=X,this.bindWatchlistInternalEvent()}handleEvent(X){X.data.events.forEach((Z)=>{this.emit(Z.name,Z)})}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",(X)=>{if(X.event==="pusher_internal:watchlist_events")this.handleEvent(X)})}};function S6(){let X,Z;return{promise:new Promise((H,Q)=>{X=H,Z=Q}),resolve:X,reject:Z}}var N6=S6,$6=class extends S{pusher;signin_requested=!1;user_data=null;serverToUserChannel=null;signinDonePromise=null;watchlist;_signinDoneResolve=null;constructor(X){super(function(Z,H){w.debug("No callbacks on user for "+Z)});this.pusher=X,this.pusher.connection.bind("state_change",({previous:Z,current:H})=>{if(Z!=="connected"&&H==="connected")this._signin();if(Z==="connected"&&H!=="connected")this._cleanup(),this._newSigninPromiseIfNeeded()}),this.watchlist=new z6(X),this.pusher.connection.bind("message",(Z)=>{if(Z.event==="pusher:signin_success")this._onSigninSuccess(Z.data);if(this.serverToUserChannel&&this.serverToUserChannel.name===Z.channel)this.serverToUserChannel.handleEvent(Z)})}signin(){if(this.signin_requested)return;this.signin_requested=!0,this._signin()}_signin(){if(!this.signin_requested)return;if(this._newSigninPromiseIfNeeded(),this.pusher.connection.state!=="connected")return;this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize)}_onAuthorize=(X,Z)=>{if(X){w.warn(`Error during signin: ${X}`),this._cleanup();return}this.pusher.send_event("pusher:signin",{auth:Z.auth,user_data:Z.user_data})};_onSigninSuccess(X){try{this.user_data=JSON.parse(X.user_data)}catch{w.error(`Failed parsing user data after signin: ${X.user_data}`),this._cleanup();return}if(typeof this.user_data.id!=="string"||this.user_data.id===""){w.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),this._cleanup();return}this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){let X=(Z)=>{if(Z.subscriptionPending&&Z.subscriptionCancelled)Z.reinstateSubscription();else if(!Z.subscriptionPending&&this.pusher.connection.state==="connected")Z.subscribe()};this.serverToUserChannel=new XX(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global((Z,H)=>{if(Z.indexOf("pusher_internal:")===0||Z.indexOf("pusher:")===0)return;this.emit(Z,H)}),X(this.serverToUserChannel)}_cleanup(){if(this.user_data=null,this.serverToUserChannel)this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null;if(this.signin_requested)this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested)return;if(this.signinDonePromise&&!this.signinDonePromise.done)return;let{promise:X,resolve:Z,reject:H}=N6();X.done=!1;let Q=()=>{X.done=!0};X.then(Q).catch(Q),this.signinDonePromise=X,this._signinDoneResolve=Z}},FX=class{channelName;conflationKey;maxMessagesPerKey;conflationCaches;baseMessage;baseSequence;lastSequence;deltaCount;fullMessageCount;constructor(X){this.channelName=X,this.conflationKey=null,this.maxMessagesPerKey=30,this.conflationCaches=new Map,this.baseMessage=null,this.baseSequence=null,this.lastSequence=null,this.deltaCount=0,this.fullMessageCount=0}initializeFromCacheSync(X){if(this.conflationKey=X.conflation_key||null,this.maxMessagesPerKey=Math.max(X.max_messages_per_key||10,30),this.conflationCaches.clear(),X.states)for(let[Z,H]of Object.entries(X.states)){let Q=H.map((W)=>({content:W.content,sequence:W.seq}));this.conflationCaches.set(Z,Q)}}setBase(X,Z){this.baseMessage=X,this.baseSequence=Z,this.lastSequence=Z}getBaseMessage(X,Z){if(!this.conflationKey)return this.baseMessage;let H=X||"",Q=this.conflationCaches.get(H);if(!Q||Z===void 0)return console.error("[ChannelState] No cache or baseIndex undefined",{hasCache:!!Q,baseIndex:Z,key:H,allCacheKeys:Array.from(this.conflationCaches.keys())}),null;let W=Q.find((G)=>G.sequence===Z);if(!W)return console.error("[ChannelState] Could not find message with sequence",{searchingFor:Z,cacheSize:Q.length,cacheSequences:Q.map((G)=>G.sequence),key:X}),null;return W.content}updateConflationCache(X,Z,H){let Q=X||"",W=this.conflationCaches.get(Q);if(!W)W=[],this.conflationCaches.set(Q,W);W.push({content:Z,sequence:H});while(W.length>this.maxMessagesPerKey)W.shift()}hasBase(){if(this.conflationKey)return this.conflationCaches.size>0;return this.baseMessage!==null&&this.baseSequence!==null}isValidSequence(X){if(this.lastSequence===null)return!0;return X>this.lastSequence}updateSequence(X){this.lastSequence=X}recordDelta(){this.deltaCount++}recordFullMessage(){this.fullMessageCount++}getStats(){return{channelName:this.channelName,conflationKey:this.conflationKey,conflationGroupCount:this.conflationCaches.size,deltaCount:this.deltaCount,fullMessageCount:this.fullMessageCount,totalMessages:this.deltaCount+this.fullMessageCount}}},x6="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(X){return X.charCodeAt(0)}),f6=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1],k6=class{a;pos;constructor(X){this.a=X,this.pos=0}haveBytes(){return this.pos<this.a.length}getByte(){let X=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw RangeError("out of bounds");return X}getChar(){return String.fromCharCode(this.getByte())}getInt(){let X=0,Z;while(this.haveBytes()&&(Z=f6[127&this.getByte()])>=0)X=(X<<6)+Z;return this.pos--,X>>>0}},y6=class{a=[];toByteArray(X){if(Array.isArray(X))return this.a;return new Uint8Array(this.a)}putByte(X){this.a.push(X&255)}putChar(X){this.putByte(X.charCodeAt(0))}putInt(X){let Z=[];if(X===0){this.putChar("0");return}let H=0;for(;X>0;H++,X>>>=6)Z.push(x6[X&63]);for(let Q=H-1;Q>=0;Q--)this.putByte(Z[Q])}putArray(X,Z,H){for(let Q=Z;Q<H;Q++)this.a.push(X[Q])}};function b6(X){let Z=0,H=0,Q=0,W=0,G=0,J=X.length;while(J>=16)Z=Z+X[G+0]|0,H=H+X[G+1]|0,Q=Q+X[G+2]|0,W=W+X[G+3]|0,Z=Z+X[G+4]|0,H=H+X[G+5]|0,Q=Q+X[G+6]|0,W=W+X[G+7]|0,Z=Z+X[G+8]|0,H=H+X[G+9]|0,Q=Q+X[G+10]|0,W=W+X[G+11]|0,Z=Z+X[G+12]|0,H=H+X[G+13]|0,Q=Q+X[G+14]|0,W=W+X[G+15]|0,G+=16,J-=16;while(J>=4)Z=Z+X[G+0]|0,H=H+X[G+1]|0,Q=Q+X[G+2]|0,W=W+X[G+3]|0,G+=4,J-=4;switch(W=((W+(Q<<8)|0)+(H<<16)|0)+(Z<<24)|0,J){case 3:W=W+(X[G+2]<<8)|0;case 2:W=W+(X[G+1]<<16)|0;case 1:W=W+(X[G+0]<<24)|0}return W>>>0}function s(X,Z,H){let Q,W=0,G=new k6(Z),J=X.length,R=Z.length;if(Q=G.getInt(),G.getChar()!==`
`)throw Error("size integer not terminated by '\\n'");let Y=new y6;while(G.haveBytes()){let K=G.getInt(),F;switch(G.getChar()){case"@":if(F=G.getInt(),G.haveBytes()&&G.getChar()!==",")throw Error("copy command not terminated by ','");if(W+=K,W>Q)throw Error("copy exceeds output file size");if(F+K>J)throw Error("copy extends past end of input");Y.putArray(X,F,F+K);break;case":":if(W+=K,W>Q)throw Error("insert command gives an output larger than predicted");if(K>R)throw Error("insert count exceeds size of delta");Y.putArray(G.a,G.pos,G.pos+K),G.pos+=K;break;case";":let C=Y.toByteArray(X);if((!H||H.verifyChecksum!==!1)&&K!==b6(C))throw Error("bad checksum");if(W!==Q)throw Error("generated size does not match predicted size");return C;default:throw Error("unknown delta operator")}}throw Error("unterminated delta")}function g6(X){let Z={};return X.forEach((H)=>{let Q=function(G){var J=Error.apply(this,arguments);J.name=this.name=H,this.stack=J.stack,this.message=J.message,this.name=H,this.message=G};Q.prototype=Object.create(Error.prototype,{constructor:{value:Q,writable:!0,configurable:!0}}),Z[H]=Q}),Z}var h=g6(["NotImplemented","InvalidDelta"]),jX=class{constructor(){this.typedArrays=[],this.startIndexes=[],this.length=0}add(X){if([Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array].filter((H)=>X instanceof H).length<1)throw Error("Given "+typeof X+" when expected a TypedArray");let Z;if(this.typedArrays.length===0)Z=0;else{let H=this.startIndexes.length-1;Z=this.startIndexes[H]+this.typedArrays[H].length}this.startIndexes.push(Z),this.typedArrays.push(X),this.length+=Z+X.length}get(X){let Z=qX(this.startIndexes,X),H=X-this.startIndexes[Z];return this.typedArrays[Z][H]}set(X,Z){if(typeof X!=="number"||isNaN(X))throw Error("Given non-number index: "+X);let H=qX(this.startIndexes,X),Q=X-this.startIndexes[H];this.typedArrays[H][Q]=Z}};function qX(X,Z){if(X.length===2)return Z<X[1]?0:1;let H=0,Q=X.length-1;while(H<Q){let W=Math.floor((H+Q)/2);if(X[W]===Z)return W;else if(X[W]<Z)H=W+1;else Q=W-1}if(X[Q]>Z)return Q-1;else return Q}function L(X,Z){let H={position:Z,value:0};do if(H.value=H.value<<7|X[H.position]&127,H.value<0)throw Error("RFC 3284 Integer conversion: Buffer overflow");while(X[H.position++]&128);return H}var v6=class{constructor(X){this.size=X}name="ADD";execute(X){for(let Z=0;Z<this.size;Z++)X.U.set(X.UTargetPosition+Z,X.data[X.dataPosition+Z]);X.dataPosition+=this.size,X.UTargetPosition+=this.size}},h6=class{constructor(X,Z){this.size=X,this.mode=Z}name="COPY";execute(X){let Z,H,Q;if(this.mode===0)Z=X.getNextAddressInteger();else if(this.mode===1)Q=X.getNextAddressInteger(),Z=X.UTargetPosition-Q;else if((H=this.mode-2)>=0&&H<X.nearCache.size)Q=X.getNextAddressInteger(),Z=X.nearCache.get(H,Q);else H=this.mode-(2+X.nearCache.size),Q=X.getNextAddressByte(),Z=X.sameCache.get(H,Q);X.nearCache.update(Z),X.sameCache.update(Z);for(let W=0;W<this.size;W++)X.U.set(X.UTargetPosition+W,X.U.get(Z+W));X.UTargetPosition+=this.size}},p6=class{constructor(X){this.size=X}name="RUN";execute(X){for(let Z=0;Z<this.size;Z++)X.U.set(X.UTargetPosition+Z,X.data[X.dataPosition]);X.dataPosition++,X.UTargetPosition+=this.size}},A={ADD:v6,COPY:h6,RUN:p6};function m6(X){let Z=[],H=0;while(H<X.length){let Q=X[H++],W,G,J;if(Q===0)({value:J,position:H}=L(X,H)),Z.push(new A.RUN(J));else if(Q===1)({value:J,position:H}=L(X,H)),Z.push(new A.ADD(J));else if(Q<19)Z.push(new A.ADD(Q-1));else if(Q===19)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,0));else if(Q<35)Z.push(new A.COPY(Q-16,0));else if(Q===35)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,1));else if(Q<51)Z.push(new A.COPY(Q-32,1));else if(Q===51)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,2));else if(Q<67)Z.push(new A.COPY(Q-48,2));else if(Q===67)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,3));else if(Q<83)Z.push(new A.COPY(Q-64,3));else if(Q===83)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,4));else if(Q<99)Z.push(new A.COPY(Q-80,4));else if(Q===99)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,5));else if(Q<115)Z.push(new A.COPY(Q-96,5));else if(Q===115)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,6));else if(Q<131)Z.push(new A.COPY(Q-112,6));else if(Q===131)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,7));else if(Q<147)Z.push(new A.COPY(Q-128,7));else if(Q===147)({value:J,position:H}=L(X,H)),Z.push(new A.COPY(J,8));else if(Q<163)Z.push(new A.COPY(Q-144,8));else if(Q<175)({addSize:W,copySize:G}=k(Q,163)),Z.push(new A.ADD(W)),Z.push(new A.COPY(G,0));else if(Q<187)({addSize:W,copySize:G}=k(Q,175)),Z.push(new A.ADD(W)),Z.push(new A.COPY(G,1));else if(Q<199)({addSize:W,copySize:G}=k(Q,187)),Z.push(new A.ADD(W)),Z.push(new A.COPY(G,2));else if(Q<211)({addSize:W,copySize:G}=k(Q,199)),Z.push(new A.ADD(W)),Z.push(new A.COPY(G,3));else if(Q<223)({addSize:W,copySize:G}=k(Q,211)),Z.push(new A.ADD(W)),Z.push(new A.COPY(G,4));else if(Q<235)({addSize:W,copySize:G}=k(Q,223)),Z.push(new A.ADD(W)),Z.push(new A.COPY(G,5));else if(Q<239)Z.push(new A.ADD(Q-235+1)),Z.push(new A.COPY(4,6));else if(Q<243)Z.push(new A.ADD(Q-239+1)),Z.push(new A.COPY(4,7));else if(Q<247)Z.push(new A.ADD(Q-243+1)),Z.push(new A.COPY(4,8));else if(Q<256)Z.push(new A.COPY(4,Q-247)),Z.push(new A.ADD(1));else throw Error("Should not get here")}return Z}function k(X,Z){let H=X-Z;return{addSize:Math.floor(H/3)+1,copySize:H%3+4}}function d6(X,Z){let H,Q,W,G;if({value:H,position:Z}=L(X,Z),X[Z]!==0)throw new h.NotImplemented("VCD_DECOMPRESS is not supported, Delta_Indicator must be zero at byte "+Z+" and not "+X[Z]);Z++,{value:Q,position:Z}=L(X,Z),{value:W,position:Z}=L(X,Z),{value:G,position:Z}=L(X,Z);let J=Z+Q,R=X.slice(Z,J),Y=J+W,K=m6(X.slice(J,Y)),F=Y+G,C=X.slice(Y,F);return Z=F,{targetWindowLength:H,position:Z,data:R,instructions:K,addresses:C}}var u6=class{constructor(X){this.size=X,this.near=Array(this.size).fill(0),this.nextSlot=0}update(X){if(this.near.length>0)this.near[this.nextSlot]=X,this.nextSlot=(this.nextSlot+1)%this.near.length}get(X,Z){return this.near[X]+Z}},c6=class{constructor(X){this.size=X,this.same=Array(this.size*256).fill(0)}update(X){if(this.same.length>0)this.same[X%(this.size*256)]=X}get(X,Z){return this.same[X*256+Z]}},l6=class{constructor(X,Z){this.delta=X,this.position=0,this.source=Z,this.targetWindows=new jX}decode(){this._consumeHeader();while(this._consumeWindow());let X=this.targetWindows.typedArrays.reduce((Q,W)=>W.length+Q,0),Z=new Uint8Array(X),H=0;for(let Q=0;Q<this.targetWindows.typedArrays.length;Q++){let W=this.targetWindows.typedArrays[Q],G=W.length;Z.set(W,H),H+=G}return Z}_consumeHeader(){if(!(this.delta[0]===214&&this.delta[1]===195&&this.delta[2]===196&&this.delta[3]===0))throw new h.InvalidDelta("first 3 bytes not VCD");let X=this.delta[4],Z=1&X,H=1&X>>1;if(Z||H)throw new h.NotImplemented("non-zero Hdr_Indicator (VCD_DECOMPRESS or VCD_CODETABLE bit is set)");this.position+=5}_consumeWindow(){let X=this.delta[this.position++],Z=1&X,H=1&X>>1;if(Z&&H)throw new h.InvalidDelta("VCD_SOURCE and VCD_TARGET cannot both be set in Win_Indicator");else if(Z){let Q,W,G;({value:Q,position:this.position}=L(this.delta,this.position)),{value:W,position:this.position}=L(this.delta,this.position),{value:G,position:this.position}=L(this.delta,this.position);let J=this.source.slice(W,W+Q);this._buildTargetWindow(this.position,J),this.position+=G}else if(H)throw new h.NotImplemented("non-zero VCD_TARGET in Win_Indicator");else{let Q;({value:Q,position:this.position}=L(this.delta,this.position)),this._buildTargetWindow(this.position),this.position+=Q}return this.position<this.delta.length}_buildTargetWindow(X,Z){let H=d6(this.delta,X),Q=new Uint8Array(H.targetWindowLength),W=new jX,G=0;if(Z)W.add(Z),G=Z.length;W.add(Q),this.source.length;let J=new o6(W,G,H.data,H.addresses);H.instructions.forEach((R)=>{R.execute(J)}),this.targetWindows.add(Q)}},o6=class{constructor(X,Z,H,Q){this.U=X,this.UTargetPosition=Z,this.data=H,this.dataPosition=0,this.addresses=Q,this.addressesPosition=0,this.nearCache=new u6(4),this.sameCache=new c6(3)}getNextAddressInteger(){let X;return{value:X,position:this.addressesPosition}=L(this.addresses,this.addressesPosition),X}getNextAddressByte(){return this.addresses[this.addressesPosition++]}};function n(X,Z){return new l6(X,Z).decode()}var b=typeof window<"u"?window.fossilDelta:void 0,g=typeof window<"u"?window.vcdiff:void 0;function i6(X){let Z=atob(X),H=new Uint8Array(Z.length);for(let Q=0;Q<Z.length;Q++)H[Q]=Z.charCodeAt(Q);return H}function xX(X){if(Array.isArray(X)||!(X instanceof Uint8Array))X=new Uint8Array(X);return new TextDecoder().decode(X)}function c(X){return new TextEncoder().encode(X)}var CX=class{static isAvailable(){return typeof s<"u"||typeof b<"u"&&b.apply}static apply(X,Z){if(!this.isAvailable())throw Error("Fossil Delta library not loaded");let H=typeof X==="string"?c(X):X,Q=typeof Z==="string"?c(Z):Z;try{let W;if(typeof s<"u")W=s(H,Q);else if(b&&b.apply)W=b.apply(H,Q);else throw Error("No fossil-delta implementation found");return xX(W)}catch(W){throw Error(`Fossil delta decode failed: ${W.message} (base=${H.length}B delta=${Q.length}B)`)}}},AX=class{static isAvailable(){return typeof n<"u"||typeof g<"u"&&g.decode}static apply(X,Z){if(!this.isAvailable())throw Error("Xdelta3/VCDIFF library not loaded");let H=typeof X==="string"?c(X):X,Q=typeof Z==="string"?c(Z):Z;try{let W;if(typeof n<"u")W=n(Q,H);else if(g&&g.decode)W=g.decode(Q,H);else throw Error("No VCDIFF decoder implementation found");return xX(W)}catch(W){throw Error(`Xdelta3 decode failed: ${W.message} (base=${H.length}B delta=${Q.length}B)`)}}},r6=class{options;enabled;channelStates;stats;availableAlgorithms;sendEventCallback;defaultAlgorithm="fossil";constructor(X={},Z){if(this.options={enabled:X.enabled!==!1,algorithms:X.algorithms||["fossil","xdelta3"],debug:X.debug||!1,onStats:X.onStats||null,onError:X.onError||null},this.enabled=!1,this.channelStates=new Map,this.stats={totalMessages:0,deltaMessages:0,fullMessages:0,totalBytesWithoutCompression:0,totalBytesWithCompression:0,errors:0},this.sendEventCallback=Z,this.availableAlgorithms=this.detectAvailableAlgorithms(),this.availableAlgorithms.length===0)w.warn("[DeltaCompression] No delta algorithms available. Please include fossil-delta or vcdiff-decoder libraries.")}detectAvailableAlgorithms(){let X=[];if(CX.isAvailable())X.push("fossil"),this.log("Fossil Delta decoder available");if(AX.isAvailable())X.push("xdelta3"),this.log("Xdelta3 decoder available");return X}enable(){if(this.enabled||!this.options.enabled)return;if(this.availableAlgorithms.length===0){this.log("No delta algorithms available, cannot enable");return}let X=this.availableAlgorithms.filter((Z)=>this.options.algorithms.includes(Z));if(X.length===0){this.log("No mutually supported algorithms");return}this.log("Sending enable request",X),this.sendEventCallback("pusher:enable_delta_compression",{algorithms:X})}disable(){this.enabled=!1}handleEnabled(X){if(this.enabled=X.enabled||!0,X.algorithm)this.defaultAlgorithm=X.algorithm;this.log("Delta compression enabled",X)}handleCacheSync(X,Z){this.log("Received cache sync",{channel:X,conflationKey:Z.conflation_key,groupCount:Object.keys(Z.states||{}).length});let H=this.channelStates.get(X);if(!H)H=new FX(X),this.channelStates.set(X,H);H.initializeFromCacheSync(Z),this.log("Cache initialized",H.getStats())}handleDeltaMessage(X,Z){let H=null;try{let{event:Q,delta:W,seq:G}=Z,J=Z.algorithm||this.defaultAlgorithm||"fossil",R=Z.conflation_key,Y=Z.base_index;this.log("Received delta message",{channel:X,event:Q,sequence:G,algorithm:J,conflationKey:R,baseIndex:Y,deltaSize:W.length});let K=this.channelStates.get(X);if(!K)return this.log(`Ignoring delta for unsubscribed channel: ${X}`),null;let F;if(K.conflationKey){if(F=K.getBaseMessage(R,Y),!F){if(this.error(`No base message for channel ${X}, key ${R}, index ${Y}`),this.options.debug)this.log("Current conflation cache snapshot",{channel:X,conflationKey:K.conflationKey,cacheSizes:Array.from(K.conflationCaches.entries()).map(([U,V])=>({key:U,size:V.length}))});return this.requestResync(X),null}}else if(F=K.baseMessage,!F){if(this.error(`No base message for channel ${X}`),this.options.debug)this.log("Channel state missing base",{channel:X,lastSequence:K.lastSequence});return this.requestResync(X),null}H=i6(W);let C;if(J==="fossil")C=CX.apply(F,H);else if(J==="xdelta3")C=AX.apply(F,H);else throw Error(`Unknown algorithm: ${J}`);if(K.conflationKey)K.updateConflationCache(R,C,G);else K.setBase(C,G);K.updateSequence(G),K.recordDelta(),this.stats.totalMessages++,this.stats.deltaMessages++,this.stats.totalBytesWithCompression+=H.length,this.stats.totalBytesWithoutCompression+=C.length,this.updateStats(),this.log("Delta applied successfully",{channel:X,event:Q,conflationKey:R,originalSize:C.length,deltaSize:H.length,compressionRatio:(H.length/C.length*100).toFixed(1)+"%"});try{let U=JSON.parse(C);return{event:Q,channel:X,data:U.data||U}}catch{return{event:Q,channel:X,data:C}}}catch(Q){return this.error("Delta decode failed",{channel:X,event:Z.event,sequence:Z.seq,algorithm:Z.algorithm,conflationKey:Z.conflation_key,baseIndex:Z.base_index,deltaSize:Z.delta?.length,decodedDeltaBytes:H?H.length:"n/a",message:Q.message}),this.stats.errors++,null}}handleFullMessage(X,Z,H,Q){if(!H&&H!==0)try{let R=JSON.parse(Z),Y=typeof R.data==="string"?JSON.parse(R.data).__delta_seq??R.__delta_seq:R.data?.__delta_seq??R.__delta_seq;if(Y===0||Y)H=Y;else{this.log("handleFullMessage missing sequence, skipping",{channel:X,hasSequence:!1});return}}catch{this.log("handleFullMessage missing sequence and parse failed",{channel:X,hasSequence:!1});return}let W=Z.length,G=this.channelStates.get(X);if(!G)G=new FX(X),this.channelStates.set(X,G);let J=Q;if(J!==void 0&&!G.conflationKey)G.conflationKey="enabled";if(G.conflationKey&&J!==void 0)G.updateConflationCache(J,Z,H),this.log("Stored full message (conflation)",{channel:X,conflationKey:J,sequence:H,size:W});else G.setBase(Z,H),this.log("Stored full message",{channel:X,sequence:H,size:W});G.recordFullMessage(),this.stats.totalMessages++,this.stats.fullMessages++,this.stats.totalBytesWithoutCompression+=W,this.stats.totalBytesWithCompression+=W,this.updateStats()}requestResync(X){this.log("Requesting resync for channel",X),this.sendEventCallback("pusher:delta_sync_error",{channel:X}),this.channelStates.delete(X)}updateStats(){if(this.options.onStats)this.options.onStats(this.getStats())}getStats(){let X=this.stats.totalBytesWithoutCompression-this.stats.totalBytesWithCompression,Z=this.stats.totalBytesWithoutCompression>0?X/this.stats.totalBytesWithoutCompression*100:0,H=Array.from(this.channelStates.values()).map((Q)=>Q.getStats());return{...this.stats,bandwidthSaved:X,bandwidthSavedPercent:Z,channelCount:this.channelStates.size,channels:H}}resetStats(){this.stats={totalMessages:0,deltaMessages:0,fullMessages:0,totalBytesWithoutCompression:0,totalBytesWithCompression:0,errors:0},this.updateStats()}clearChannelState(X){if(X)this.channelStates.delete(X);else this.channelStates.clear()}isEnabled(){return this.enabled}getAvailableAlgorithms(){return this.availableAlgorithms}log(...X){if(this.options.debug)w.debug("[DeltaCompression]",...X)}error(...X){if(w.error("[DeltaCompression]",...X),this.options.onError)this.options.onError(X)}},fX=class X{static instances=[];static isReady=!1;static _logToConsole=!1;static _log;static get logToConsole(){return this._logToConsole}static set logToConsole(Z){this._logToConsole=Z,YX({logToConsole:Z,log:this._log})}static get log(){return this._log}static set log(Z){this._log=Z,YX({logToConsole:this._logToConsole,log:Z})}static Runtime=P;static ready(){X.isReady=!0;for(let Z=0,H=X.instances.length;Z<H;Z++)X.instances[Z].connect()}static getClientFeatures(){return LX(MX({ws:P.Transports.ws},function(Z){return Z.isSupported({})}))}key;config;channels;global_emitter;sessionID;timeline;timelineSender;connection;timelineSenderTimer;user;deltaCompression;constructor(Z,H){if(s6(Z),V6(H),this.key=Z,this.config=O6(H,this),this.channels=D.createChannels(),this.global_emitter=new S,this.sessionID=P.randomInt(1e9),this.timeline=new J6(this.key,this.sessionID,{cluster:this.config.cluster,features:X.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:u.INFO,version:_.VERSION}),this.config.enableStats)this.timelineSender=D.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+P.TimelineTransport.name});let Q=(W)=>{return P.getDefaultStrategy(this.config,W,U6)};if(this.connection=D.createConnectionManager(this.key,{getStrategy:Q,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:Boolean(this.config.useTLS)}),H.deltaCompression!==void 0)this.deltaCompression=new r6(H.deltaCompression||{},(W,G)=>this.send_event(W,G));if(this.connection.bind("connected",()=>{if(this.subscribeAll(),this.timelineSender)this.timelineSender.send(this.connection.isUsingTLS());if(this.deltaCompression&&H.deltaCompression?.enabled===!0)this.deltaCompression.enable()}),this.connection.bind("message",(W)=>{let G=W.event,J=G.indexOf("pusher_internal:")===0;if(this.deltaCompression){if(G==="pusher:delta_compression_enabled")this.deltaCompression.handleEnabled(W.data);else if(G==="pusher:delta_cache_sync"&&W.channel){this.deltaCompression.handleCacheSync(W.channel,W.data);return}else if(G==="pusher:delta"&&W.channel){let R=this.channel(W.channel);if(!R)return;let Y=this.deltaCompression.handleDeltaMessage(W.channel,W.data);if(Y){if(R)R.handleEvent(Y);this.global_emitter.emit(Y.event,Y.data)}return}}if(W.channel){let R=this.channel(W.channel);if(R)R.handleEvent(W);if(this.deltaCompression&&W.event&&!W.event.startsWith("pusher:")&&!W.event.startsWith("pusher_internal:")){let Y;if(typeof W.sequence==="number")Y=W.sequence;let K;if(typeof W.conflation_key==="string")K=W.conflation_key;let F=W.rawMessage||"";if(F&&Y!==void 0)F=F.replace(/,"__delta_seq":\d+/g,""),F=F.replace(/"__delta_seq":\d+,/g,""),F=F.replace(/,"__conflation_key":"[^"]*"/g,""),F=F.replace(/"__conflation_key":"[^"]*",/g,"");this.deltaCompression.handleFullMessage(W.channel,F,Y,K)}}if(!J)this.global_emitter.emit(W.event,W.data)}),this.connection.bind("connecting",()=>{this.channels.disconnect()}),this.connection.bind("disconnected",()=>{this.channels.disconnect()}),this.connection.bind("error",(W)=>{w.warn(W)}),X.instances.push(this),this.timeline.info({instances:X.instances.length}),this.user=new $6(this),X.isReady)this.connect()}channel(Z){return this.channels.find(Z)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender){if(!this.timelineSenderTimer){let Z=this.connection.isUsingTLS(),H=this.timelineSender;this.timelineSenderTimer=new tX(60000,function(){H.send(Z)})}}}disconnect(){if(this.connection.disconnect(),this.timelineSenderTimer)this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null}bind(Z,H,Q){return this.global_emitter.bind(Z,H,Q),this}unbind(Z,H,Q){return this.global_emitter.unbind(Z,H,Q),this}bind_global(Z){return this.global_emitter.bind_global(Z),this}unbind_global(Z){return this.global_emitter.unbind_global(Z),this}unbind_all(Z){return this.global_emitter.unbind_all(),this}subscribeAll(){let Z;for(Z in this.channels.channels)if(this.channels.channels.hasOwnProperty(Z))this.subscribe(Z)}subscribe(Z,H){let Q=this.channels.add(Z,this);if(H)if(typeof H==="object"&&(("filter"in H)||("delta"in H))){if(H.filter)Q.tagsFilter=H.filter;if(H.delta)Q.setDeltaSettings(H.delta)}else Q.tagsFilter=H;if(Q.subscriptionPending&&Q.subscriptionCancelled)Q.reinstateSubscription();else if(!Q.subscriptionPending&&this.connection.state==="connected")Q.subscribe();return Q}unsubscribe(Z){let H=this.channels.find(Z);if(H&&H.subscriptionPending)H.cancelSubscription();else if(H=this.channels.remove(Z),H&&H.subscribed)H.unsubscribe();if(this.deltaCompression)this.deltaCompression.clearChannelState(Z)}send_event(Z,H,Q){return this.connection.send_event(Z,H,Q)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}getDeltaStats(){if(!this.deltaCompression)return null;return this.deltaCompression.getStats()}resetDeltaStats(){if(this.deltaCompression)this.deltaCompression.resetStats()}};function s6(X){if(X===null||X===void 0)throw"You must pass your app key when you instantiate Pusher."}P.setup(fX);var kX=fX;var E={eq:(X,Z)=>({key:X,cmp:"eq",val:Z}),neq:(X,Z)=>({key:X,cmp:"neq",val:Z}),in:(X,Z)=>({key:X,cmp:"in",vals:Z}),nin:(X,Z)=>({key:X,cmp:"nin",vals:Z}),exists:(X)=>({key:X,cmp:"ex"}),notExists:(X)=>({key:X,cmp:"nex"}),startsWith:(X,Z)=>({key:X,cmp:"sw",val:Z}),endsWith:(X,Z)=>({key:X,cmp:"ew",val:Z}),contains:(X,Z)=>({key:X,cmp:"ct",val:Z}),gt:(X,Z)=>({key:X,cmp:"gt",val:Z}),gte:(X,Z)=>({key:X,cmp:"gte",val:Z}),lt:(X,Z)=>({key:X,cmp:"lt",val:Z}),lte:(X,Z)=>({key:X,cmp:"lte",val:Z}),and:(...X)=>({op:"and",nodes:X}),or:(...X)=>({op:"or",nodes:X}),not:(X)=>({op:"not",nodes:[X]})};var QX={eventType:(X)=>E.eq("event_type",X),eventTypes:(X)=>E.in("event_type",X),range:(X,Z,H)=>E.and(E.gte(X,Z),E.lte(X,H)),importantEvents:(X)=>E.or(E.eq("event_type","goal"),E.and(E.eq("event_type","shot"),E.gte("xG",X)))};document.addEventListener("DOMContentLoaded",()=>{let X={configDisplay:document.getElementById("config-display"),connectBtn:document.getElementById("connect-btn"),disconnectBtn:document.getElementById("disconnect-btn"),connectionStatus:document.getElementById("connection-status"),statusDot:document.getElementById("status-dot"),channelNameInput:document.getElementById("channel-name"),subscribeBtn:document.getElementById("subscribe-btn"),subscribedChannels:document.getElementById("subscribed-channels"),channelCount:document.getElementById("channel-count"),enableTagFilter:document.getElementById("enable-tag-filter"),tagFilterControls:document.getElementById("tag-filter-controls"),filterPreset:document.getElementById("filter-preset"),filterJson:document.getElementById("filter-json"),serverEventChannel:document.getElementById("server-event-channel"),serverEventName:document.getElementById("server-event-name"),serverEventData:document.getElementById("server-event-data"),serverEventTags:document.getElementById("server-event-tags"),conflationKey:document.getElementById("conflation-key"),sendServerEventBtn:document.getElementById("send-server-event-btn"),sendBatchEventsBtn:document.getElementById("send-batch-events-btn"),clientEventChannel:document.getElementById("client-event-channel"),clientEventName:document.getElementById("client-event-name"),clientEventData:document.getElementById("client-event-data"),sendClientEventBtn:document.getElementById("send-client-event-btn"),eventsLog:document.getElementById("events-log"),clearEventsBtn:document.getElementById("clear-events-btn"),exportEventsBtn:document.getElementById("export-events-btn"),presenceChannelName:document.getElementById("presence-channel-name"),presenceCount:document.getElementById("presence-count"),presenceMembers:document.getElementById("presence-members"),totalEvents:document.getElementById("total-events"),totalChannels:document.getElementById("total-channels"),connectionTime:document.getElementById("connection-time"),webhookCount:document.getElementById("webhook-count"),webhooksLog:document.getElementById("webhooks-log"),fetchWebhooksBtn:document.getElementById("fetch-webhooks-btn"),clearWebhooksBtn:document.getElementById("clear-webhooks-btn"),deltaCompressionToggle:document.getElementById("delta-compression-toggle"),deltaEnabled:document.getElementById("delta-enabled"),deltaMessages:document.getElementById("delta-messages"),fullMessages:document.getElementById("full-messages"),bandwidthSaved:document.getElementById("bandwidth-saved")},Z={pusher:null,config:null,channels:new Map,currentPresenceChannel:null,events:[],webhooks:[],stats:{totalEvents:0,connectionStartTime:null,connectionTimer:null},currentEventFilter:"all",tagFiltering:{enabled:!1,currentFilter:null},deltaCompression:{enabled:!1,channelStates:new Map,stats:{deltaMessages:0,fullMessages:0,totalBytesWithoutCompression:0,totalBytesWithCompression:0}}},H={formatTime(U){return new Date(U).toLocaleTimeString()},formatJSON(U){try{return JSON.stringify(U,null,2)}catch(V){return String(U)}},getChannelType(U){if(U.startsWith("presence-"))return"presence";if(U.startsWith("private-"))return"private";return"public"},exportEvents(){let U=JSON.stringify(Z.events,null,2),V=new Blob([U],{type:"application/json"}),j=URL.createObjectURL(V),q=document.createElement("a");q.href=j,q.download=`pusher-events-${Date.now()}.json`,q.click(),URL.revokeObjectURL(j)},updateConnectionTimer(){if(Z.stats.connectionStartTime){let U=Date.now()-Z.stats.connectionStartTime,V=Math.floor(U/60000),j=Math.floor(U%60000/1000);X.connectionTime.textContent=`${V.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`}},addAnimation(U,V="fade-in"){U.classList.add(V),setTimeout(()=>U.classList.remove(V),300)}},Q={add(U){if(U.id=Date.now()+Math.random(),Z.events.unshift(U),Z.stats.totalEvents++,Z.events.length>500)Z.events=Z.events.slice(0,500);Q.render(),Q.updateStats()},render(){let U=Z.events.filter((V)=>{if(Z.currentEventFilter==="all")return!0;return V.type===Z.currentEventFilter});X.eventsLog.innerHTML="",U.forEach((V)=>{let j=document.createElement("li");j.className="event-item",j.innerHTML=`
          <div class="event-header">
            <div>
              <span class="event-type ${V.type}">${V.type}</span>
              <span class="event-title">${V.title}</span>
            </div>
            <span class="event-timestamp">${H.formatTime(V.timestamp)}</span>
          </div>
          ${V.data?`<div class="event-data">${H.formatJSON(V.data)}</div>`:""}
        `,H.addAnimation(j),X.eventsLog.appendChild(j)})},updateStats(){X.totalEvents.textContent=Z.stats.totalEvents,X.totalChannels.textContent=Z.channels.size},clear(){Z.events=[],Z.stats.totalEvents=0,Q.render(),Q.updateStats()}},W={subscribe(U){if(!Z.pusher||Z.pusher.connection.state!=="connected"){Q.add({type:"error",title:"Cannot subscribe: Not connected",timestamp:Date.now()});return}if(Z.channels.has(U)){Q.add({type:"system",title:`Already subscribed to ${U}`,timestamp:Date.now()});return}let V=null;if(Z.tagFiltering.enabled&&Z.tagFiltering.currentFilter)V=Z.tagFiltering.currentFilter,Q.add({type:"system",title:`Subscribing to ${U} with tag filter`,timestamp:Date.now(),data:V});let j=Z.pusher.subscribe(U,V);Z.channels.set(U,{channel:j,filter:V}),W.bindChannelEvents(j,U),W.render(),W.updateDropdowns()},unsubscribe(U){if(Z.channels.has(U)){if(Z.pusher.unsubscribe(U),Z.channels.delete(U),Z.currentPresenceChannel&&Z.currentPresenceChannel.name===U)G.clear();W.render(),W.updateDropdowns()}},bindChannelEvents(U,V){if(U.bind("pusher:subscription_succeeded",(j)=>{if(Q.add({type:"system",title:` Subscribed to ${V}`,timestamp:Date.now(),data:j}),V.startsWith("presence-"))Z.currentPresenceChannel=U,G.update(U.members)}),U.bind("pusher:subscription_error",(j)=>{Q.add({type:"error",title:` Subscription failed: ${V}`,timestamp:Date.now(),data:{status:j,channelName:V}})}),V.startsWith("presence-"))U.bind("pusher:member_added",(j)=>{if(Q.add({type:"member",title:`\uD83D\uDC4B Member joined ${V}`,timestamp:Date.now(),data:j}),Z.currentPresenceChannel===U)G.update(U.members)}),U.bind("pusher:member_removed",(j)=>{if(Q.add({type:"member",title:`\uD83D\uDC4B Member left ${V}`,timestamp:Date.now(),data:j}),Z.currentPresenceChannel===U)G.update(U.members)});U.bind_global((j,q)=>{if(!j.startsWith("pusher:")){console.log(`[Event] "${j}" on ${V}:`,q);let B=j.startsWith("client-")?"client":"custom";Q.add({type:B,title:`\uD83D\uDCE1 ${j} on ${V}`,timestamp:Date.now(),data:q})}})},render(){X.subscribedChannels.innerHTML="",Z.channels.forEach((U,V)=>{let j=document.createElement("div");j.className="channel-item";let q=H.getChannelType(V),B=U.filter?' <i class="fas fa-filter" title="Filtered"></i>':"";j.innerHTML=`
          <div>
            <span class="channel-name">${V}${B}</span>
            <span class="channel-type ${q}">${q}</span>
          </div>
          <button class="btn btn-small btn-danger" onclick="channelManager.unsubscribe('${V}')">
            <i class="fas fa-times"></i> Unsubscribe
          </button>
        `,H.addAnimation(j),X.subscribedChannels.appendChild(j)}),X.channelCount.textContent=Z.channels.size},updateDropdowns(){[X.serverEventChannel,X.clientEventChannel].forEach((j)=>{let q=j.value;j.innerHTML='<option value="">Select channel...</option>',Z.channels.forEach((B,O)=>{let M=document.createElement("option");if(M.value=O,M.textContent=O,O===q)M.selected=!0;j.appendChild(M)})});let U=X.clientEventChannel.value!=="",V=Z.pusher?.connection?.state==="connected";X.sendClientEventBtn.disabled=!U||!V}},G={update(U){if(!U){G.clear();return}if(X.presenceChannelName.textContent=Z.currentPresenceChannel?.name||"None",X.presenceCount.textContent=U.count||0,X.presenceMembers.innerHTML="",U.count>0)U.each((V)=>{let j=document.createElement("div");j.className="member-item",console.log("Member:",V);let q=V.id===U.me?.id;j.innerHTML=`
            <img src="${V.info.user_info?.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(V.info.user_info.name)}&background=random`}" alt="${V.info.user_info.name}" class="member-avatar">
            <div class="member-info">
              <div class="member-name">${V.info.user_info.name}</div>
              <div class="member-id">${V.info.user_id}</div>
            </div>
            ${q?'<span class="member-badge">You</span>':""}
          `,H.addAnimation(j),X.presenceMembers.appendChild(j)});else X.presenceMembers.innerHTML='<div class="member-item">No members present</div>'},clear(){X.presenceChannelName.textContent="None",X.presenceCount.textContent="0",X.presenceMembers.innerHTML='<div class="member-item">Not subscribed to a presence channel</div>',Z.currentPresenceChannel=null}},J={async connect(){if(!Z.config){Q.add({type:"error",title:"Configuration not loaded",timestamp:Date.now()});return}if(Z.pusher&&Z.pusher.connection.state!=="disconnected"){Q.add({type:"system",title:"Already connected or connecting",timestamp:Date.now()});return}J.updateStatus("connecting","Connecting...");let U={cluster:Z.config.pusherCluster||"mt1",wsHost:Z.config.pusherHost||"localhost",wsPort:Z.config.pusherPort||6001,forceTLS:!1,disableStats:!0,enabledTransports:["ws"],authEndpoint:Z.config.authEndpoint,authTransport:"ajax",deltaCompression:{enabled:!0,algorithms:["fossil","xdelta3"],debug:!1,onStats:(V)=>{console.log("Delta Stats Update:",V),X.deltaMessages.textContent=V.deltaMessages,X.fullMessages.textContent=V.fullMessages,X.bandwidthSaved.textContent=V.bandwidthSavedPercent.toFixed(1)+"%"},onError:(V)=>{console.error("Delta Compression Error:",V)}}};Z.pusher=new Pusher(Z.config.pusherKey,U),J.bindConnectionEvents()},disconnect(){if(Z.pusher)Z.pusher.disconnect()},bindConnectionEvents(){Z.pusher.connection.bind("connected",()=>{if(Z.stats.connectionStartTime=Date.now(),Z.stats.connectionTimer=setInterval(H.updateConnectionTimer,1000),J.updateStatus("connected",`Connected (${Z.pusher.connection.socket_id})`),Q.add({type:"system",title:"\uD83D\uDE80 Connected to WebSocket server",timestamp:Date.now(),data:{socketId:Z.pusher.connection.socket_id}}),X.deltaCompressionToggle.disabled=!1,Z.pusher.deltaCompression)Z.pusher.deltaCompression.disable(),X.deltaEnabled.textContent="No";X.connectBtn.disabled=!0,X.disconnectBtn.disabled=!1,X.subscribeBtn.disabled=!1,W.updateDropdowns()}),Z.pusher.connection.bind("disconnected",()=>{if(Z.stats.connectionTimer)clearInterval(Z.stats.connectionTimer),Z.stats.connectionTimer=null;J.updateStatus("disconnected","Disconnected"),Q.add({type:"system",title:"\uD83D\uDD0C Disconnected from server",timestamp:Date.now()}),X.connectBtn.disabled=!1,X.disconnectBtn.disabled=!0,X.subscribeBtn.disabled=!0,Z.channels.clear(),W.render(),W.updateDropdowns(),G.clear()}),Z.pusher.connection.bind("connecting",()=>{J.updateStatus("connecting","Connecting...")}),Z.pusher.connection.bind("error",(U)=>{let V="Connection Error";if(U.error?.data)V+=`: ${U.error.data.code} - ${U.error.data.message}`;else if(U.message)V+=`: ${U.message}`;Q.add({type:"error",title:V,timestamp:Date.now(),data:U}),J.updateStatus("error","Connection Error")}),Z.pusher.connection.bind("failed",()=>{Q.add({type:"error",title:" Connection failed permanently",timestamp:Date.now()}),J.updateStatus("failed","Connection Failed"),X.disconnectBtn.disabled=!0}),Z.pusher.bind_global((U,V,j)=>{if(console.log(`[Delta] Global event: ${U}, metadata:`,j),U==="pusher:delta_compression_enabled")Z.deltaCompression.enabled=!0,Q.add({type:"system",title:" Delta compression enabled by server",timestamp:Date.now(),data:V})}),Z.pusher.connection.bind("pusher:error",(U)=>{if(U.data?.message?.includes("delta"))Q.add({type:"error",title:`Delta compression error: ${U.data.message}`,timestamp:Date.now(),data:U})})},updateStatus(U,V){X.connectionStatus.textContent=V,X.statusDot.className=`status-dot ${U}`}},R={async send(){let U=X.serverEventChannel.value,V=X.serverEventName.value.trim(),j=X.serverEventData.value.trim(),q=X.serverEventTags.value.trim(),B=X.conflationKey.value.trim();if(!U||!V){Q.add({type:"error",title:"Channel and event name are required",timestamp:Date.now()});return}let O={};if(j)try{O=JSON.parse(j)}catch(I){Q.add({type:"error",title:`Invalid JSON data: ${I.message}`,timestamp:Date.now()});return}let M=null;if(q)try{M=JSON.parse(q)}catch(I){Q.add({type:"error",title:`Invalid JSON tags: ${I.message}`,timestamp:Date.now()});return}try{let I={channel:U,event:V,data:O};if(M)I.tags=M;if(B)I.conflation_key=B;let WX=await(await fetch("/trigger-event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)})).json();if(WX.success){let d=[];if(M)d.push("tags");if(B)d.push(`conflation: ${B}`);let yX=d.length?` (${d.join(", ")})`:"";Q.add({type:"system",title:`\uD83D\uDCE4 Server event sent: ${V}  ${U}${yX}`,timestamp:Date.now(),data:{eventData:O,tags:M,conflation_key:B}}),X.serverEventName.value="",X.serverEventData.value="",X.serverEventTags.value="",X.conflationKey.value=""}else throw Error(WX.error||"Failed to send event")}catch(I){Q.add({type:"error",title:`Failed to send server event: ${I.message}`,timestamp:Date.now()})}},async sendBatch(){let U=X.serverEventChannel.value;if(!U){Q.add({type:"error",title:"Channel is required for batch events",timestamp:Date.now()});return}try{let j=await(await fetch("/trigger-batch-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channel:U,count:5,delay:500})})).json();if(j.success)Q.add({type:"system",title:`\uD83D\uDCE4 Batch events triggered on ${U}`,timestamp:Date.now(),data:{message:j.message}});else throw Error(j.error||"Failed to trigger batch events")}catch(V){Q.add({type:"error",title:`Failed to trigger batch events: ${V.message}`,timestamp:Date.now()})}}},Y={send(){let U=X.clientEventChannel.value,V=X.clientEventName.value.trim(),j=X.clientEventData.value.trim();if(!U||!V){Q.add({type:"error",title:"Channel and event name are required",timestamp:Date.now()});return}if(!V.startsWith("client-")){Q.add({type:"error",title:'Client event names must start with "client-"',timestamp:Date.now()});return}let q={};if(j)try{q=JSON.parse(j)}catch(O){Q.add({type:"error",title:`Invalid JSON data: ${O.message}`,timestamp:Date.now()});return}let B=Z.channels.get(U);if(!B){Q.add({type:"error",title:`Not subscribed to channel: ${U}`,timestamp:Date.now()});return}try{if(B.channel.trigger(V,q))Q.add({type:"client",title:`\uD83D\uDCF1 Client event sent: ${V}  ${U}`,timestamp:Date.now(),data:q}),X.clientEventName.value="",X.clientEventData.value="";else throw Error("Failed to trigger client event")}catch(O){Q.add({type:"error",title:`Failed to send client event: ${O.message}`,timestamp:Date.now()})}}},K={async fetch(){try{let V=await(await fetch("/webhooks-log")).json();if(X.webhooksLog.innerHTML="",X.webhookCount.textContent=V.length,V.length===0){X.webhooksLog.innerHTML='<li class="webhook-item">No webhooks received yet</li>';return}V.forEach((j)=>{let q=document.createElement("li");q.className="webhook-item";let B=j.body?.events?.map((O)=>`${O.name} (${O.channel||"N/A"})`).join(", ")||"No events";q.innerHTML=`
            <div class="event-header">
              <div class="event-title">\uD83E\uDE9D ${B}</div>
              <div class="event-timestamp">${H.formatTime(j.timestamp)}</div>
            </div>
            <div class="event-data">${H.formatJSON(j.body)}</div>
          `,H.addAnimation(q),X.webhooksLog.appendChild(q)})}catch(U){Q.add({type:"error",title:`Failed to fetch webhooks: ${U.message}`,timestamp:Date.now()})}},clear(){X.webhooksLog.innerHTML="",X.webhookCount.textContent="0"}},F=async()=>{try{let U=await fetch("/config");if(!U.ok)throw Error(`HTTP error! status: ${U.status}`);Z.config=await U.json(),X.configDisplay.textContent=H.formatJSON(Z.config),X.connectBtn.disabled=!1,Q.add({type:"system",title:" Configuration loaded successfully",timestamp:Date.now()})}catch(U){X.configDisplay.textContent=`Error loading config: ${U.message}`,X.connectBtn.disabled=!0,Q.add({type:"error",title:`Configuration load failed: ${U.message}`,timestamp:Date.now()})}},C={enable(){if(!Z.pusher){console.error("Pusher not initialized"),Q.add({type:"error",title:"Cannot enable delta compression: Not connected",timestamp:Date.now()});return}if(!Z.pusher.deltaCompression){console.error("Delta compression not available on Pusher instance"),Q.add({type:"error",title:"Delta compression not available. Make sure deltaCompression config is set.",timestamp:Date.now()});return}Z.pusher.deltaCompression.enable(),Z.deltaCompression.enabled=!0,X.deltaEnabled.textContent="Yes",Q.add({type:"system",title:"\uD83D\uDDDC Delta compression enabled",timestamp:Date.now()})},disable(){if(!Z.pusher||!Z.pusher.deltaCompression)return;Z.pusher.deltaCompression.disable(),Z.deltaCompression.enabled=!1,X.deltaEnabled.textContent="No",Q.add({type:"system",title:"Delta compression disabled",timestamp:Date.now()})}};X.connectBtn.addEventListener("click",J.connect),X.disconnectBtn.addEventListener("click",J.disconnect),X.subscribeBtn.addEventListener("click",()=>{let U=X.channelNameInput.value.trim();if(U)W.subscribe(U),X.channelNameInput.value=""}),X.deltaCompressionToggle.addEventListener("change",(U)=>{if(U.target.checked)C.enable();else C.disable()}),X.enableTagFilter.addEventListener("change",(U)=>{if(Z.tagFiltering.enabled=U.target.checked,X.tagFilterControls.style.display=U.target.checked?"block":"none",!U.target.checked)Z.tagFiltering.currentFilter=null,X.filterJson.value=""}),X.filterPreset.addEventListener("change",(U)=>{let V=U.target.value,j=null,q=window.Filter;if(!q){console.error("Filter class not available");return}switch(V){case"goals":j=q.eq("event_type","goal");break;case"goals-shots":j=q.in("event_type",["goal","shot"]);break;case"high-xg":j=q.gte("xG","0.8");break;case"goals-high-xg":j=q.or(q.eq("event_type","goal"),q.and(q.eq("event_type","shot"),q.gte("xG","0.8")));break}if(j)X.filterJson.value=JSON.stringify(j,null,2),Z.tagFiltering.currentFilter=j}),X.filterJson.addEventListener("input",(U)=>{try{if(U.target.value.trim()){let V=JSON.parse(U.target.value);Z.tagFiltering.currentFilter=V}else Z.tagFiltering.currentFilter=null}catch(V){}}),X.channelNameInput.addEventListener("keypress",(U)=>{if(U.key==="Enter")X.subscribeBtn.click()}),X.sendServerEventBtn.addEventListener("click",R.send),X.sendBatchEventsBtn.addEventListener("click",R.sendBatch),X.sendClientEventBtn.addEventListener("click",Y.send),X.clientEventChannel.addEventListener("change",W.updateDropdowns),X.clearEventsBtn.addEventListener("click",Q.clear),X.exportEventsBtn.addEventListener("click",H.exportEvents),X.fetchWebhooksBtn.addEventListener("click",K.fetch),X.clearWebhooksBtn.addEventListener("click",K.clear),document.querySelectorAll(".filter-btn").forEach((U)=>{U.addEventListener("click",()=>{document.querySelectorAll(".filter-btn").forEach((V)=>{V.classList.remove("active")}),U.classList.add("active"),Z.currentEventFilter=U.dataset.filter,Q.render()})}),window.channelManager=W,F(),Q.render(),G.clear(),K.fetch(),setInterval(K.fetch,30000)});window.Pusher=kX;window.Filter=E;window.FilterExamples=QX;window.FilterExamples=QX;
