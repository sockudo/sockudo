class _Q{constructor(Q,Z){this.lastId=0,this.prefix=Q,this.name=Z}create(Q){this.lastId++;var Z=this.lastId,Y=this.prefix+Z,$=this.name+"["+Z+"]",H=!1,J=function(){if(!H)Q.apply(null,arguments),H=!0};return this[Z]=J,{number:Z,id:Y,name:$,callback:J}}remove(Q){delete this[Q.number]}}var GQ=new _Q("_pusher_script_","Pusher.ScriptReceivers"),w={VERSION:"8.4.0",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:120000,pongTimeout:30000,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"//js.pusher.com/",cdn_https:"//js.pusher.com/",dependency_suffix:""};class lQ{constructor(Q){this.options=Q,this.receivers=Q.receivers||GQ,this.loading={}}load(Q,Z,Y){var $=this;if($.loading[Q]&&$.loading[Q].length>0)$.loading[Q].push(Y);else{$.loading[Q]=[Y];var H=q.createScriptRequest($.getPath(Q,Z)),J=$.receivers.create(function(G){if($.receivers.remove(J),$.loading[Q]){var R=$.loading[Q];delete $.loading[Q];var V=function(U){if(!U)H.cleanup()};for(var E=0;E<R.length;E++)R[E](G,V)}});H.send(J)}}getRoot(Q){var Z,Y=q.getDocument().location.protocol;if(Q&&Q.useTLS||Y==="https:")Z=this.options.cdn_https;else Z=this.options.cdn_http;return Z.replace(/\/*$/,"")+"/"+this.options.version}getPath(Q,Z){return this.getRoot(Z)+"/"+Q+this.options.suffix+".js"}}var DQ=new _Q("_pusher_dependencies","Pusher.DependenciesReceivers"),WQ=new lQ({cdn_http:w.cdn_http,cdn_https:w.cdn_https,version:w.VERSION,suffix:w.dependency_suffix,receivers:DQ}),vQ={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}},Q6=function(Q){let Y=vQ.urls[Q];if(!Y)return"";let $;if(Y.fullUrl)$=Y.fullUrl;else if(Y.path)$=vQ.baseUrl+Y.path;if(!$)return"";return`See: ${$}`},t={buildLogSuffix:Q6},c;(function(Q){Q.UserAuthentication="user-authentication",Q.ChannelAuthorization="channel-authorization"})(c||(c={}));class oQ extends Error{constructor(Q){super(Q);Object.setPrototypeOf(this,new.target.prototype)}}class iQ extends Error{constructor(Q){super(Q);Object.setPrototypeOf(this,new.target.prototype)}}class rQ extends Error{constructor(Q){super(Q);Object.setPrototypeOf(this,new.target.prototype)}}class sQ extends Error{constructor(Q){super(Q);Object.setPrototypeOf(this,new.target.prototype)}}class aQ extends Error{constructor(Q){super(Q);Object.setPrototypeOf(this,new.target.prototype)}}class IQ extends Error{constructor(Q){super(Q);Object.setPrototypeOf(this,new.target.prototype)}}class nQ extends Error{constructor(Q){super(Q);Object.setPrototypeOf(this,new.target.prototype)}}var tQ=class extends Error{constructor(Z){super(Z);Object.setPrototypeOf(this,new.target.prototype)}};class JQ extends Error{constructor(Q,Z){super(Z);this.status=Q,Object.setPrototypeOf(this,new.target.prototype)}}var eQ=function(Q,Z,Y,$,H){let J=q.createXHR();J.open("POST",Y.endpoint,!0),J.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var G in Y.headers)J.setRequestHeader(G,Y.headers[G]);if(Y.headersProvider!=null){let R=Y.headersProvider();for(var G in R)J.setRequestHeader(G,R[G])}return J.onreadystatechange=function(){if(J.readyState===4)if(J.status===200){let R,V=!1;try{R=JSON.parse(J.responseText),V=!0}catch(E){H(new JQ(200,`JSON returned from ${$.toString()} endpoint was invalid, yet status code was 200. Data was: ${J.responseText}`),null)}if(V)H(null,R)}else{let R="";switch($){case c.UserAuthentication:R=t.buildLogSuffix("authenticationEndpoint");break;case c.ChannelAuthorization:R=`Clients must be authorized to join private or presence channels. ${t.buildLogSuffix("authorizationEndpoint")}`;break}H(new JQ(J.status,`Unable to retrieve auth string from ${$.toString()} endpoint - received status: ${J.status} from ${Y.endpoint}. ${R}`),null)}},J.send(Z),J};function Z6(Q){return J6($6(Q))}var l=String.fromCharCode,YQ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y6=function(Q){var Z=Q.charCodeAt(0);return Z<128?Q:Z<2048?l(192|Z>>>6)+l(128|Z&63):l(224|Z>>>12&15)+l(128|Z>>>6&63)+l(128|Z&63)},$6=function(Q){return Q.replace(/[^\x00-\x7F]/g,Y6)},H6=function(Q){var Z=[0,2,1][Q.length%3],Y=Q.charCodeAt(0)<<16|(Q.length>1?Q.charCodeAt(1):0)<<8|(Q.length>2?Q.charCodeAt(2):0),$=[YQ.charAt(Y>>>18),YQ.charAt(Y>>>12&63),Z>=2?"=":YQ.charAt(Y>>>6&63),Z>=1?"=":YQ.charAt(Y&63)];return $.join("")},J6=window.btoa||function(Q){return Q.replace(/[\s\S]{1,3}/g,H6)};class PQ{constructor(Q,Z,Y,$){this.clear=Z,this.timer=Q(()=>{if(this.timer)this.timer=$(this.timer)},Y)}isRunning(){return this.timer!==null}ensureAborted(){if(this.timer)this.clear(this.timer),this.timer=null}}function X6(Q){window.clearTimeout(Q)}function G6(Q){window.clearInterval(Q)}class v extends PQ{constructor(Q,Z){super(setTimeout,X6,Q,function(Y){return Z(),null})}}class QZ extends PQ{constructor(Q,Z){super(setInterval,G6,Q,function(Y){return Z(),Y})}}var I={now(){if(Date.now)return Date.now();else return new Date().valueOf()},defer(Q){return new v(0,Q)},method(Q,...Z){var Y=Array.prototype.slice.call(arguments,1);return function($){return $[Q].apply($,Y.concat(arguments))}}};function N(Q,...Z){for(var Y=0;Y<Z.length;Y++){var $=Z[Y];for(var H in $)if($[H]&&$[H].constructor&&$[H].constructor===Object)Q[H]=N(Q[H]||{},$[H]);else Q[H]=$[H]}return Q}function W6(){var Q=["Pusher"];for(var Z=0;Z<arguments.length;Z++)if(typeof arguments[Z]==="string")Q.push(arguments[Z]);else Q.push(RQ(arguments[Z]));return Q.join(" : ")}function gQ(Q,Z){var Y=Array.prototype.indexOf;if(Q===null)return-1;if(Y&&Q.indexOf===Y)return Q.indexOf(Z);for(var $=0,H=Q.length;$<H;$++)if(Q[$]===Z)return $;return-1}function f(Q,Z){for(var Y in Q)if(Object.prototype.hasOwnProperty.call(Q,Y))Z(Q[Y],Y,Q)}function ZZ(Q){var Z=[];return f(Q,function(Y,$){Z.push($)}),Z}function R6(Q){var Z=[];return f(Q,function(Y){Z.push(Y)}),Z}function e(Q,Z,Y){for(var $=0;$<Q.length;$++)Z.call(Y||window,Q[$],$,Q)}function YZ(Q,Z){var Y=[];for(var $=0;$<Q.length;$++)Y.push(Z(Q[$],$,Q,Y));return Y}function V6(Q,Z){var Y={};return f(Q,function($,H){Y[H]=Z($)}),Y}function $Z(Q,Z){Z=Z||function(H){return!!H};var Y=[];for(var $=0;$<Q.length;$++)if(Z(Q[$],$,Q,Y))Y.push(Q[$]);return Y}function HZ(Q,Z){var Y={};return f(Q,function($,H){if(Z&&Z($,H,Q,Y)||Boolean($))Y[H]=$}),Y}function U6(Q){var Z=[];return f(Q,function(Y,$){Z.push([$,Y])}),Z}function JZ(Q,Z){for(var Y=0;Y<Q.length;Y++)if(Z(Q[Y],Y,Q))return!0;return!1}function j6(Q,Z){for(var Y=0;Y<Q.length;Y++)if(!Z(Q[Y],Y,Q))return!1;return!0}function K6(Q){return V6(Q,function(Z){if(typeof Z==="object")Z=RQ(Z);return encodeURIComponent(Z6(Z.toString()))})}function E6(Q){var Z=HZ(Q,function($){return $!==void 0}),Y=YZ(U6(K6(Z)),I.method("join","=")).join("&");return Y}function A6(Q){var Z=[],Y=[];return function $(H,J){var G,R,V;switch(typeof H){case"object":if(!H)return null;for(G=0;G<Z.length;G+=1)if(Z[G]===H)return{$ref:Y[G]};if(Z.push(H),Y.push(J),Object.prototype.toString.apply(H)==="[object Array]"){V=[];for(G=0;G<H.length;G+=1)V[G]=$(H[G],J+"["+G+"]")}else{V={};for(R in H)if(Object.prototype.hasOwnProperty.call(H,R))V[R]=$(H[R],J+"["+JSON.stringify(R)+"]")}return V;case"number":case"string":case"boolean":return H}}(Q,"$")}function RQ(Q){try{return JSON.stringify(Q)}catch(Z){return JSON.stringify(A6(Q))}}var n={logToConsole:!1};function pQ(Q){n=Object.assign(Object.assign({},n),Q)}class XZ{constructor(){this.globalLog=(Q)=>{if(window.console&&window.console.log)window.console.log(Q)}}debug(...Q){this.log(this.globalLog,Q)}warn(...Q){this.log(this.globalLogWarn,Q)}error(...Q){this.log(this.globalLogError,Q)}globalLogWarn(Q){if(window.console&&window.console.warn)window.console.warn(Q);else this.globalLog(Q)}globalLogError(Q){if(window.console&&window.console.error)window.console.error(Q);else this.globalLogWarn(Q)}log(Q,...Z){var Y=W6.apply(this,arguments);if(n.log)n.log(Y);else if(n.logToConsole)Q.bind(this)(Y)}}var B=new XZ,GZ=function(Q,Z,Y,$,H){if(Y.headers!==void 0||Y.headersProvider!=null)B.warn(`To send headers with the ${$.toString()} request, you must use AJAX, rather than JSONP.`);var J=Q.nextAuthCallbackID.toString();Q.nextAuthCallbackID++;var G=Q.getDocument(),R=G.createElement("script");Q.auth_callbacks[J]=function(U){H(null,U)};var V="Pusher.auth_callbacks['"+J+"']";R.src=Y.endpoint+"?callback="+encodeURIComponent(V)+"&"+Z;var E=G.getElementsByTagName("head")[0]||G.documentElement;E.insertBefore(R,E.firstChild)};class NQ{constructor(Q){this.src=Q}send(Q){var Z=this,Y="Error loading "+Z.src;if(Z.script=document.createElement("script"),Z.script.id=Q.id,Z.script.src=Z.src,Z.script.type="text/javascript",Z.script.charset="UTF-8",Z.script.addEventListener)Z.script.onerror=function(){Q.callback(Y)},Z.script.onload=function(){Q.callback(null)};else Z.script.onreadystatechange=function(){if(Z.script.readyState==="loaded"||Z.script.readyState==="complete")Q.callback(null)};if(Z.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent))Z.errorScript=document.createElement("script"),Z.errorScript.id=Q.id+"_error",Z.errorScript.text=Q.name+"('"+Y+"');",Z.script.async=Z.errorScript.async=!1;else Z.script.async=!0;var $=document.getElementsByTagName("head")[0];if($.insertBefore(Z.script,$.firstChild),Z.errorScript)$.insertBefore(Z.errorScript,Z.script.nextSibling)}cleanup(){if(this.script)this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null;if(this.script&&this.script.parentNode)this.script.parentNode.removeChild(this.script);if(this.errorScript&&this.errorScript.parentNode)this.errorScript.parentNode.removeChild(this.errorScript);this.script=null,this.errorScript=null}}var F6=function(Q,Z){return function(Y,$){var H="http"+(Z?"s":"")+"://",J=H+(Q.host||Q.options.host)+Q.options.path,G=q.createJSONPRequest(J,Y),R=q.ScriptReceivers.create(function(V,E){if(GQ.remove(R),G.cleanup(),E&&E.host)Q.host=E.host;if($)$(V,E)});G.send(R)}},WZ={name:"jsonp",getAgent:F6};function MQ(Q,Z,Y){var $=Q+(Z.useTLS?"s":""),H=Z.useTLS?Z.hostTLS:Z.hostNonTLS;return $+"://"+H+Y}function SQ(Q,Z){var Y="/app/"+Q,$="?protocol="+w.PROTOCOL+"&client=js&version="+w.VERSION+(Z?"&"+Z:"");return Y+$}var q6={getInitial:function(Q,Z){var Y=(Z.httpPath||"")+SQ(Q,"flash=false");return MQ("ws",Z,Y)}},L6={getInitial:function(Q,Z){var Y=(Z.httpPath||"/pusher")+SQ(Q);return MQ("http",Z,Y)}},C6={getInitial:function(Q,Z){return MQ("http",Z,Z.httpPath||"/pusher")},getPath:function(Q,Z){return SQ(Q)}};class RZ{constructor(){this._callbacks={}}get(Q){return this._callbacks[EQ(Q)]}add(Q,Z,Y){var $=EQ(Q);this._callbacks[$]=this._callbacks[$]||[],this._callbacks[$].push({fn:Z,context:Y})}remove(Q,Z,Y){if(!Q&&!Z&&!Y){this._callbacks={};return}var $=Q?[EQ(Q)]:ZZ(this._callbacks);if(Z||Y)this.removeCallback($,Z,Y);else this.removeAllCallbacks($)}removeCallback(Q,Z,Y){e(Q,function($){if(this._callbacks[$]=$Z(this._callbacks[$]||[],function(H){return Z&&Z!==H.fn||Y&&Y!==H.context}),this._callbacks[$].length===0)delete this._callbacks[$]},this)}removeAllCallbacks(Q){e(Q,function(Z){delete this._callbacks[Z]},this)}}function EQ(Q){return"_"+Q}class z{constructor(Q){this.callbacks=new RZ,this.global_callbacks=[],this.failThrough=Q}bind(Q,Z,Y){return this.callbacks.add(Q,Z,Y),this}bind_global(Q){return this.global_callbacks.push(Q),this}unbind(Q,Z,Y){return this.callbacks.remove(Q,Z,Y),this}unbind_global(Q){if(!Q)return this.global_callbacks=[],this;return this.global_callbacks=$Z(this.global_callbacks||[],(Z)=>Z!==Q),this}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(Q,Z,Y){for(var $=0;$<this.global_callbacks.length;$++)this.global_callbacks[$](Q,Z);var H=this.callbacks.get(Q),J=[];if(Y)J.push(Z,Y);else if(Z)J.push(Z);if(H&&H.length>0)for(var $=0;$<H.length;$++)H[$].fn.apply(H[$].context||window,J);else if(this.failThrough)this.failThrough(Q,Z);return this}}class VZ extends z{constructor(Q,Z,Y,$,H){super();this.initialize=q.transportConnectionInitializer,this.hooks=Q,this.name=Z,this.priority=Y,this.key=$,this.options=H,this.state="new",this.timeline=H.timeline,this.activityTimeout=H.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return Boolean(this.hooks.handlesActivityChecks)}supportsPing(){return Boolean(this.hooks.supportsPing)}connect(){if(this.socket||this.state!=="initialized")return!1;var Q=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(Q,this.options)}catch(Z){return I.defer(()=>{this.onError(Z),this.changeState("closed")}),!1}return this.bindListeners(),B.debug("Connecting",{transport:this.name,url:Q}),this.changeState("connecting"),!0}close(){if(this.socket)return this.socket.close(),!0;else return!1}send(Q){if(this.state==="open")return I.defer(()=>{if(this.socket)this.socket.send(Q)}),!0;else return!1}ping(){if(this.state==="open"&&this.supportsPing())this.socket.ping()}onOpen(){if(this.hooks.beforeOpen)this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options));this.changeState("open"),this.socket.onopen=void 0}onError(Q){this.emit("error",{type:"WebSocketError",error:Q}),this.timeline.error(this.buildTimelineMessage({error:Q.toString()}))}onClose(Q){if(Q)this.changeState("closed",{code:Q.code,reason:Q.reason,wasClean:Q.wasClean});else this.changeState("closed");this.unbindListeners(),this.socket=void 0}onMessage(Q){this.emit("message",Q)}onActivity(){this.emit("activity")}bindListeners(){if(this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=(Q)=>{this.onError(Q)},this.socket.onclose=(Q)=>{this.onClose(Q)},this.socket.onmessage=(Q)=>{this.onMessage(Q)},this.supportsPing())this.socket.onactivity=()=>{this.onActivity()}}unbindListeners(){if(this.socket){if(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing())this.socket.onactivity=void 0}}changeState(Q,Z){this.state=Q,this.timeline.info(this.buildTimelineMessage({state:Q,params:Z})),this.emit(Q,Z)}buildTimelineMessage(Q){return N({cid:this.id},Q)}}class m{constructor(Q){this.hooks=Q}isSupported(Q){return this.hooks.isSupported(Q)}createConnection(Q,Z,Y,$){return new VZ(this.hooks,Q,Z,Y,$)}}var B6=new m({urls:q6,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(q.getWebSocketAPI())},isSupported:function(){return Boolean(q.getWebSocketAPI())},getSocket:function(Q){return q.createWebSocket(Q)}}),UZ={urls:L6,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},jZ=N({getSocket:function(Q){return q.HTTPFactory.createStreamingSocket(Q)}},UZ),KZ=N({getSocket:function(Q){return q.HTTPFactory.createPollingSocket(Q)}},UZ),EZ={isSupported:function(){return q.isXHRSupported()}},w6=new m(N({},jZ,EZ)),O6=new m(N({},KZ,EZ)),QQ={ws:B6,xhr_streaming:w6,xhr_polling:O6},T6=new m({file:"sockjs",urls:C6,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return window.SockJS!==void 0},getSocket:function(Q,Z){return new window.SockJS(Q,null,{js_path:WQ.getPath("sockjs",{useTLS:Z.useTLS}),ignore_null_origin:Z.ignoreNullOrigin})},beforeOpen:function(Q,Z){Q.send(JSON.stringify({path:Z}))}}),AZ={isSupported:function(Q){var Z=q.isXDRSupported(Q.useTLS);return Z}},_6=new m(N({},jZ,AZ)),D6=new m(N({},KZ,AZ));QQ.xdr_streaming=_6;QQ.xdr_polling=D6;QQ.sockjs=T6;class FZ extends z{constructor(){super();var Q=this;if(window.addEventListener!==void 0)window.addEventListener("online",function(){Q.emit("online")},!1),window.addEventListener("offline",function(){Q.emit("offline")},!1)}isOnline(){if(window.navigator.onLine===void 0)return!0;else return window.navigator.onLine}}var qZ=new FZ;class LZ{constructor(Q,Z,Y){this.manager=Q,this.transport=Z,this.minPingDelay=Y.minPingDelay,this.maxPingDelay=Y.maxPingDelay,this.pingDelay=void 0}createConnection(Q,Z,Y,$){$=N({},$,{activityTimeout:this.pingDelay});var H=this.transport.createConnection(Q,Z,Y,$),J=null,G=function(){H.unbind("open",G),H.bind("closed",R),J=I.now()},R=(V)=>{if(H.unbind("closed",R),V.code===1002||V.code===1003)this.manager.reportDeath();else if(!V.wasClean&&J){var E=I.now()-J;if(E<2*this.maxPingDelay)this.manager.reportDeath(),this.pingDelay=Math.max(E/2,this.minPingDelay)}};return H.bind("open",G),H}isSupported(Q){return this.manager.isAlive()&&this.transport.isSupported(Q)}}var g={decodeMessage:function(Q){var Z,Y;try{var $=JSON.parse(Q.data),H=$.data;if(typeof H==="string")try{H=JSON.parse($.data)}catch(V){}var J={event:$.event,channel:$.channel,data:H,rawMessage:Q.data};if($.user_id)J.user_id=$.user_id;let G=(Z=$.__delta_seq)!==null&&Z!==void 0?Z:$.sequence,R=(Y=$.__conflation_key)!==null&&Y!==void 0?Y:$.conflation_key;if(typeof G==="number")J.sequence=G;if(R!==void 0)J.conflation_key=R;return J}catch(G){throw{type:"MessageParseError",error:G,data:Q.data}}},encodeMessage:function(Q){return JSON.stringify(Q)},processHandshake:function(Q){var Z=g.decodeMessage(Q);if(Z.event==="pusher:connection_established"){if(!Z.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:Z.data.socket_id,activityTimeout:Z.data.activity_timeout*1000}}else if(Z.event==="pusher:error")return{action:this.getCloseAction(Z.data),error:this.getCloseError(Z.data)};else throw"Invalid handshake"},getCloseAction:function(Q){if(Q.code<4000)if(Q.code>=1002&&Q.code<=1004)return"backoff";else return null;else if(Q.code===4000)return"tls_only";else if(Q.code<4100)return"refused";else if(Q.code<4200)return"backoff";else if(Q.code<4300)return"retry";else return"refused"},getCloseError:function(Q){if(Q.code!==1000&&Q.code!==1001)return{type:"PusherError",data:{code:Q.code,message:Q.reason||Q.message}};else return null}};class CZ extends z{constructor(Q,Z){super();this.id=Q,this.transport=Z,this.activityTimeout=Z.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(Q){return this.transport.send(Q)}send_event(Q,Z,Y){var $={event:Q,data:Z};if(Y)$.channel=Y;return B.debug("Event sent",$),this.send(g.encodeMessage($))}ping(){if(this.transport.supportsPing())this.transport.ping();else this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var Q={message:(Y)=>{var $;try{$=g.decodeMessage(Y)}catch(H){this.emit("error",{type:"MessageParseError",error:H,data:Y.data})}if($!==void 0){switch(B.debug("Event recd",$),$.event){case"pusher:error":this.emit("error",{type:"PusherError",data:$.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong");break}this.emit("message",$)}},activity:()=>{this.emit("activity")},error:(Y)=>{this.emit("error",Y)},closed:(Y)=>{if(Z(),Y&&Y.code)this.handleCloseEvent(Y);this.transport=null,this.emit("closed")}},Z=()=>{f(Q,(Y,$)=>{this.transport.unbind($,Y)})};f(Q,(Y,$)=>{this.transport.bind($,Y)})}handleCloseEvent(Q){var Z=g.getCloseAction(Q),Y=g.getCloseError(Q);if(Y)this.emit("error",Y);if(Z)this.emit(Z,{action:Z,error:Y})}}class BZ{constructor(Q,Z){this.transport=Q,this.callback=Z,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=(Q)=>{this.unbindListeners();var Z;try{Z=g.processHandshake(Q)}catch(Y){this.finish("error",{error:Y}),this.transport.close();return}if(Z.action==="connected")this.finish("connected",{connection:new CZ(Z.id,this.transport),activityTimeout:Z.activityTimeout});else this.finish(Z.action,{error:Z.error}),this.transport.close()},this.onClosed=(Q)=>{this.unbindListeners();var Z=g.getCloseAction(Q)||"backoff",Y=g.getCloseError(Q);this.finish(Z,{error:Y})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(Q,Z){this.callback(N({transport:this.transport,action:Q},Z))}}class wZ{constructor(Q,Z){this.timeline=Q,this.options=Z||{}}send(Q,Z){if(this.timeline.isEmpty())return;this.timeline.send(q.TimelineTransport.getAgent(this,Q),Z)}}class VQ extends z{constructor(Q,Z){super(function(Y,$){B.debug("No callbacks on "+Q+" for "+Y)});this.name=Q,this.pusher=Z,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1,this.tagsFilter=null}authorize(Q,Z){return Z(null,{auth:""})}trigger(Q,Z){if(Q.indexOf("client-")!==0)throw new oQ("Event '"+Q+"' does not start with 'client-'");if(!this.subscribed){var Y=t.buildLogSuffix("triggeringClientEvents");B.warn(`Client event triggered before channel 'subscription_succeeded' event . ${Y}`)}return this.pusher.send_event(Q,Z,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(Q){var{event:Z,data:Y}=Q;if(Z==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(Q);else if(Z==="pusher_internal:subscription_count")this.handleSubscriptionCountEvent(Q);else if(Z.indexOf("pusher_internal:")!==0){var $={};this.emit(Z,Y,$)}}handleSubscriptionSucceededEvent(Q){if(this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled)this.pusher.unsubscribe(this.name);else this.emit("pusher:subscription_succeeded",Q.data)}handleSubscriptionCountEvent(Q){if(Q.data.subscription_count)this.subscriptionCount=Q.data.subscription_count;this.emit("pusher:subscription_count",Q.data)}subscribe(){if(this.subscribed)return;this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,(Q,Z)=>{if(Q)this.subscriptionPending=!1,B.error(Q.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:Q.message},Q instanceof JQ?{status:Q.status}:{}));else{let Y={auth:Z.auth,channel_data:Z.channel_data,channel:this.name};if(this.tagsFilter)Y.tags_filter=this.tagsFilter;this.pusher.send_event("pusher:subscribe",Y)}})}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}}class UQ extends VQ{authorize(Q,Z){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:Q},Z)}}class OZ{constructor(){this.reset()}get(Q){if(Object.prototype.hasOwnProperty.call(this.members,Q))return{id:Q,info:this.members[Q]};else return null}each(Q){f(this.members,(Z,Y)=>{Q(this.get(Y))})}setMyID(Q){this.myID=Q}onSubscription(Q){this.members=Q.presence.hash,this.count=Q.presence.count,this.me=this.get(this.myID)}addMember(Q){if(this.get(Q.user_id)===null)this.count++;return this.members[Q.user_id]=Q.user_info,this.get(Q.user_id)}removeMember(Q){var Z=this.get(Q.user_id);if(Z)delete this.members[Q.user_id],this.count--;return Z}reset(){this.members={},this.count=0,this.myID=null,this.me=null}}var I6=function(Q,Z,Y,$){function H(J){return J instanceof Y?J:new Y(function(G){G(J)})}return new(Y||(Y=Promise))(function(J,G){function R(U){try{E($.next(U))}catch(j){G(j)}}function V(U){try{E($.throw(U))}catch(j){G(j)}}function E(U){U.done?J(U.value):H(U.value).then(R,V)}E(($=$.apply(Q,Z||[])).next())})};class TZ extends UQ{constructor(Q,Z){super(Q,Z);this.members=new OZ}authorize(Q,Z){super.authorize(Q,(Y,$)=>I6(this,void 0,void 0,function*(){if(!Y)if($=$,$.channel_data!=null){var H=JSON.parse($.channel_data);this.members.setMyID(H.user_id)}else if(yield this.pusher.user.signinDonePromise,this.pusher.user.user_data!=null)this.members.setMyID(this.pusher.user.user_data.id);else{let J=t.buildLogSuffix("authorizationEndpoint");B.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${J}, or the user should be signed in.`),Z("Invalid auth response");return}Z(Y,$)}))}handleEvent(Q){var Z=Q.event;if(Z.indexOf("pusher_internal:")===0)this.handleInternalEvent(Q);else{var Y=Q.data,$={};if(Q.user_id)$.user_id=Q.user_id;this.emit(Z,Y,$)}}handleInternalEvent(Q){var{event:Z,data:Y}=Q;switch(Z){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(Q);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(Q);break;case"pusher_internal:member_added":var $=this.members.addMember(Y);this.emit("pusher:member_added",$);break;case"pusher_internal:member_removed":var H=this.members.removeMember(Y);if(H)this.emit("pusher:member_removed",H);break}}handleSubscriptionSucceededEvent(Q){if(this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled)this.pusher.unsubscribe(this.name);else this.members.onSubscription(Q.data),this.emit("pusher:subscription_succeeded",this.members)}disconnect(){this.members.reset(),super.disconnect()}}var h={},mQ;function P6(){if(mQ)return h;mQ=1,Object.defineProperty(h,"__esModule",{value:!0});var Q="utf8: invalid string",Z="utf8: invalid source encoding";function Y(J){var G=new Uint8Array($(J)),R=0;for(var V=0;V<J.length;V++){var E=J.charCodeAt(V);if(E<128)G[R++]=E;else if(E<2048)G[R++]=192|E>>6,G[R++]=128|E&63;else if(E<55296)G[R++]=224|E>>12,G[R++]=128|E>>6&63,G[R++]=128|E&63;else V++,E=(E&1023)<<10,E|=J.charCodeAt(V)&1023,E+=65536,G[R++]=240|E>>18,G[R++]=128|E>>12&63,G[R++]=128|E>>6&63,G[R++]=128|E&63}return G}h.encode=Y;function $(J){var G=0;for(var R=0;R<J.length;R++){var V=J.charCodeAt(R);if(V<128)G+=1;else if(V<2048)G+=2;else if(V<55296)G+=3;else if(V<=57343){if(R>=J.length-1)throw Error(Q);R++,G+=4}else throw Error(Q)}return G}h.encodedLength=$;function H(J){var G=[];for(var R=0;R<J.length;R++){var V=J[R];if(V&128){var E=void 0;if(V<224){if(R>=J.length)throw Error(Z);var U=J[++R];if((U&192)!==128)throw Error(Z);V=(V&31)<<6|U&63,E=128}else if(V<240){if(R>=J.length-1)throw Error(Z);var U=J[++R],j=J[++R];if((U&192)!==128||(j&192)!==128)throw Error(Z);V=(V&15)<<12|(U&63)<<6|j&63,E=2048}else if(V<248){if(R>=J.length-2)throw Error(Z);var U=J[++R],j=J[++R],X=J[++R];if((U&192)!==128||(j&192)!==128||(X&192)!==128)throw Error(Z);V=(V&15)<<18|(U&63)<<12|(j&63)<<6|X&63,E=65536}else throw Error(Z);if(V<E||V>=55296&&V<=57343)throw Error(Z);if(V>=65536){if(V>1114111)throw Error(Z);V-=65536,G.push(String.fromCharCode(55296|V>>10)),V=56320|V&1023}}G.push(String.fromCharCode(V))}return G.join("")}return h.decode=H,h}var N6=P6(),P={},hQ;function M6(){if(hQ)return P;hQ=1;var Q=P&&P.__extends||function(){var U=function(j,X){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,K){W.__proto__=K}||function(W,K){for(var A in K)if(K.hasOwnProperty(A))W[A]=K[A]},U(j,X)};return function(j,X){U(j,X);function W(){this.constructor=j}j.prototype=X===null?Object.create(X):(W.prototype=X.prototype,new W)}}();Object.defineProperty(P,"__esModule",{value:!0});var Z=256,Y=function(){function U(j){if(j===void 0)j="=";this._paddingCharacter=j}return U.prototype.encodedLength=function(j){if(!this._paddingCharacter)return(j*8+5)/6|0;return(j+2)/3*4|0},U.prototype.encode=function(j){var X="",W=0;for(;W<j.length-2;W+=3){var K=j[W]<<16|j[W+1]<<8|j[W+2];X+=this._encodeByte(K>>>18&63),X+=this._encodeByte(K>>>12&63),X+=this._encodeByte(K>>>6&63),X+=this._encodeByte(K>>>0&63)}var A=j.length-W;if(A>0){var K=j[W]<<16|(A===2?j[W+1]<<8:0);if(X+=this._encodeByte(K>>>18&63),X+=this._encodeByte(K>>>12&63),A===2)X+=this._encodeByte(K>>>6&63);else X+=this._paddingCharacter||"";X+=this._paddingCharacter||""}return X},U.prototype.maxDecodedLength=function(j){if(!this._paddingCharacter)return(j*6+7)/8|0;return j/4*3|0},U.prototype.decodedLength=function(j){return this.maxDecodedLength(j.length-this._getPaddingLength(j))},U.prototype.decode=function(j){if(j.length===0)return new Uint8Array(0);var X=this._getPaddingLength(j),W=j.length-X,K=new Uint8Array(this.maxDecodedLength(W)),A=0,L=0,C=0,O=0,T=0,x=0,M=0;for(;L<W-4;L+=4)O=this._decodeChar(j.charCodeAt(L+0)),T=this._decodeChar(j.charCodeAt(L+1)),x=this._decodeChar(j.charCodeAt(L+2)),M=this._decodeChar(j.charCodeAt(L+3)),K[A++]=O<<2|T>>>4,K[A++]=T<<4|x>>>2,K[A++]=x<<6|M,C|=O&Z,C|=T&Z,C|=x&Z,C|=M&Z;if(L<W-1)O=this._decodeChar(j.charCodeAt(L)),T=this._decodeChar(j.charCodeAt(L+1)),K[A++]=O<<2|T>>>4,C|=O&Z,C|=T&Z;if(L<W-2)x=this._decodeChar(j.charCodeAt(L+2)),K[A++]=T<<4|x>>>2,C|=x&Z;if(L<W-3)M=this._decodeChar(j.charCodeAt(L+3)),K[A++]=x<<6|M,C|=M&Z;if(C!==0)throw Error("Base64Coder: incorrect characters for decoding");return K},U.prototype._encodeByte=function(j){var X=j;return X+=65,X+=25-j>>>8&6,X+=51-j>>>8&-75,X+=61-j>>>8&-15,X+=62-j>>>8&3,String.fromCharCode(X)},U.prototype._decodeChar=function(j){var X=Z;return X+=(42-j&j-44)>>>8&-Z+j-43+62,X+=(46-j&j-48)>>>8&-Z+j-47+63,X+=(47-j&j-58)>>>8&-Z+j-48+52,X+=(64-j&j-91)>>>8&-Z+j-65+0,X+=(96-j&j-123)>>>8&-Z+j-97+26,X},U.prototype._getPaddingLength=function(j){var X=0;if(this._paddingCharacter){for(var W=j.length-1;W>=0;W--){if(j[W]!==this._paddingCharacter)break;X++}if(j.length<4||X>2)throw Error("Base64Coder: incorrect padding")}return X},U}();P.Coder=Y;var $=new Y;function H(U){return $.encode(U)}P.encode=H;function J(U){return $.decode(U)}P.decode=J;var G=function(U){Q(j,U);function j(){return U!==null&&U.apply(this,arguments)||this}return j.prototype._encodeByte=function(X){var W=X;return W+=65,W+=25-X>>>8&6,W+=51-X>>>8&-75,W+=61-X>>>8&-13,W+=62-X>>>8&49,String.fromCharCode(W)},j.prototype._decodeChar=function(X){var W=Z;return W+=(44-X&X-46)>>>8&-Z+X-45+62,W+=(94-X&X-96)>>>8&-Z+X-95+63,W+=(47-X&X-58)>>>8&-Z+X-48+52,W+=(64-X&X-91)>>>8&-Z+X-65+0,W+=(96-X&X-123)>>>8&-Z+X-97+26,W},j}(Y);P.URLSafeCoder=G;var R=new G;function V(U){return R.encode(U)}P.encodeURLSafe=V;function E(U){return R.decode(U)}return P.decodeURLSafe=E,P.encodedLength=function(U){return $.encodedLength(U)},P.maxDecodedLength=function(U){return $.maxDecodedLength(U)},P.decodedLength=function(U){return $.decodedLength(U)},P}var AQ=M6();class _Z extends UQ{constructor(Q,Z,Y){super(Q,Z);this.key=null,this.nacl=Y}authorize(Q,Z){super.authorize(Q,(Y,$)=>{if(Y){Z(Y,$);return}let H=$.shared_secret;if(!H){Z(Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null);return}this.key=AQ.decode(H),delete $.shared_secret,Z(null,$)})}trigger(Q,Z){throw new IQ("Client events are not currently supported for encrypted channels")}handleEvent(Q){var{event:Z,data:Y}=Q;if(Z.indexOf("pusher_internal:")===0||Z.indexOf("pusher:")===0){super.handleEvent(Q);return}this.handleEncryptedEvent(Z,Y)}handleEncryptedEvent(Q,Z){if(!this.key){B.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!Z.ciphertext||!Z.nonce){B.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+Z);return}let Y=AQ.decode(Z.ciphertext);if(Y.length<this.nacl.secretbox.overheadLength){B.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${Y.length}`);return}let $=AQ.decode(Z.nonce);if($.length<this.nacl.secretbox.nonceLength){B.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${$.length}`);return}let H=this.nacl.secretbox.open(Y,$,this.key);if(H===null){B.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),this.authorize(this.pusher.connection.socket_id,(J,G)=>{if(J){B.error(`Failed to make a request to the authEndpoint: ${G}. Unable to fetch new key, so dropping encrypted event`);return}if(H=this.nacl.secretbox.open(Y,$,this.key),H===null){B.error("Failed to decrypt event with new key. Dropping encrypted event");return}this.emit(Q,this.getDataToEmit(H));return});return}this.emit(Q,this.getDataToEmit(H))}getDataToEmit(Q){let Z=N6.decode(Q);try{return JSON.parse(Z)}catch(Y){return Z}}}class DZ extends z{constructor(Q,Z){super();this.state="initialized",this.connection=null,this.key=Q,this.options=Z,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var Y=q.getNetwork();Y.bind("online",()=>{if(this.timeline.info({netinfo:"online"}),this.state==="connecting"||this.state==="unavailable")this.retryIn(0)}),Y.bind("offline",()=>{if(this.timeline.info({netinfo:"offline"}),this.connection)this.sendActivityCheck()}),this.updateStrategy()}connect(){if(this.connection||this.runner)return;if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}send(Q){if(this.connection)return this.connection.send(Q);else return!1}send_event(Q,Z,Y){if(this.connection)return this.connection.send_event(Q,Z,Y);else return!1}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var Q=(Z,Y)=>{if(Z)this.runner=this.strategy.connect(0,Q);else if(Y.action==="error")this.emit("error",{type:"HandshakeError",error:Y.error}),this.timeline.error({handshakeError:Y.error});else this.abortConnecting(),this.handshakeCallbacks[Y.action](Y)};this.runner=this.strategy.connect(0,Q)}abortConnecting(){if(this.runner)this.runner.abort(),this.runner=null}disconnectInternally(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var Q=this.abandonConnection();Q.close()}}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(Q){if(this.timeline.info({action:"retry",delay:Q}),Q>0)this.emit("connecting_in",Math.round(Q/1000));this.retryTimer=new v(Q||0,()=>{this.disconnectInternally(),this.connect()})}clearRetryTimer(){if(this.retryTimer)this.retryTimer.ensureAborted(),this.retryTimer=null}setUnavailableTimer(){this.unavailableTimer=new v(this.options.unavailableTimeout,()=>{this.updateState("unavailable")})}clearUnavailableTimer(){if(this.unavailableTimer)this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new v(this.options.pongTimeout,()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)})}resetActivityCheck(){if(this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks())this.activityTimer=new v(this.activityTimeout,()=>{this.sendActivityCheck()})}stopActivityCheck(){if(this.activityTimer)this.activityTimer.ensureAborted()}buildConnectionCallbacks(Q){return N({},Q,{message:(Z)=>{this.resetActivityCheck(),this.emit("message",Z)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:(Z)=>{this.emit("error",Z)},closed:()=>{if(this.abandonConnection(),this.shouldRetry())this.retryIn(1000)}})}buildHandshakeCallbacks(Q){return N({},Q,{connected:(Z)=>{this.activityTimeout=Math.min(this.options.activityTimeout,Z.activityTimeout,Z.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(Z.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let Q=(Z)=>{return(Y)=>{if(Y.error)this.emit("error",{type:"WebSocketError",error:Y.error});Z(Y)}};return{tls_only:Q(()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)}),refused:Q(()=>{this.disconnect()}),backoff:Q(()=>{this.retryIn(1000)}),retry:Q(()=>{this.retryIn(0)})}}setConnection(Q){this.connection=Q;for(var Z in this.connectionCallbacks)this.connection.bind(Z,this.connectionCallbacks[Z]);this.resetActivityCheck()}abandonConnection(){if(!this.connection)return;this.stopActivityCheck();for(var Q in this.connectionCallbacks)this.connection.unbind(Q,this.connectionCallbacks[Q]);var Z=this.connection;return this.connection=null,Z}updateState(Q,Z){var Y=this.state;if(this.state=Q,Y!==Q){var $=Q;if($==="connected")$+=" with new socket ID "+Z.socket_id;B.debug("State changed",Y+" -> "+$),this.timeline.info({state:Q,params:Z}),this.emit("state_change",{previous:Y,current:Q}),this.emit(Q,Z)}}shouldRetry(){return this.state==="connecting"||this.state==="connected"}}class IZ{constructor(){this.channels={}}add(Q,Z){if(!this.channels[Q])this.channels[Q]=S6(Q,Z);return this.channels[Q]}all(){return R6(this.channels)}find(Q){return this.channels[Q]}remove(Q){var Z=this.channels[Q];return delete this.channels[Q],Z}disconnect(){f(this.channels,function(Q){Q.disconnect()})}}function S6(Q,Z){if(Q.indexOf("private-encrypted-")===0){if(Z.config.nacl)return k.createEncryptedChannel(Q,Z,Z.config.nacl);let Y="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",$=t.buildLogSuffix("encryptedChannelSupport");throw new IQ(`${Y}. ${$}`)}else if(Q.indexOf("private-")===0)return k.createPrivateChannel(Q,Z);else if(Q.indexOf("presence-")===0)return k.createPresenceChannel(Q,Z);else if(Q.indexOf("#")===0)throw new iQ('Cannot create a channel with name "'+Q+'".');else return k.createChannel(Q,Z)}var k={createChannels(){return new IZ},createConnectionManager(Q,Z){return new DZ(Q,Z)},createChannel(Q,Z){return new VQ(Q,Z)},createPrivateChannel(Q,Z){return new UQ(Q,Z)},createPresenceChannel(Q,Z){return new TZ(Q,Z)},createEncryptedChannel(Q,Z,Y){return new _Z(Q,Z,Y)},createTimelineSender(Q,Z){return new wZ(Q,Z)},createHandshake(Q,Z){return new BZ(Q,Z)},createAssistantToTheTransportManager(Q,Z,Y){return new LZ(Q,Z,Y)}};class LQ{constructor(Q){this.options=Q||{},this.livesLeft=this.options.lives||1/0}getAssistant(Q){return k.createAssistantToTheTransportManager(this,Q,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class y{constructor(Q,Z){this.strategies=Q,this.loop=Boolean(Z.loop),this.failFast=Boolean(Z.failFast),this.timeout=Z.timeout,this.timeoutLimit=Z.timeoutLimit}isSupported(){return JZ(this.strategies,I.method("isSupported"))}connect(Q,Z){var Y=this.strategies,$=0,H=this.timeout,J=null,G=(R,V)=>{if(V)Z(null,V);else{if($=$+1,this.loop)$=$%Y.length;if($<Y.length){if(H){if(H=H*2,this.timeoutLimit)H=Math.min(H,this.timeoutLimit)}J=this.tryStrategy(Y[$],Q,{timeout:H,failFast:this.failFast},G)}else Z(!0)}};return J=this.tryStrategy(Y[$],Q,{timeout:H,failFast:this.failFast},G),{abort:function(){J.abort()},forceMinPriority:function(R){if(Q=R,J)J.forceMinPriority(R)}}}tryStrategy(Q,Z,Y,$){var H=null,J=null;if(Y.timeout>0)H=new v(Y.timeout,function(){J.abort(),$(!0)});return J=Q.connect(Z,function(G,R){if(G&&H&&H.isRunning()&&!Y.failFast)return;if(H)H.ensureAborted();$(G,R)}),{abort:function(){if(H)H.ensureAborted();J.abort()},forceMinPriority:function(G){J.forceMinPriority(G)}}}}class $Q{constructor(Q){this.strategies=Q}isSupported(){return JZ(this.strategies,I.method("isSupported"))}connect(Q,Z){return x6(this.strategies,Q,function(Y,$){return function(H,J){if($[Y].error=H,H){if(z6($))Z(!0);return}e($,function(G){G.forceMinPriority(J.transport.priority)}),Z(null,J)}})}}function x6(Q,Z,Y){var $=YZ(Q,function(H,J,G,R){return H.connect(Z,Y(J,R))});return{abort:function(){e($,b6)},forceMinPriority:function(H){e($,function(J){J.forceMinPriority(H)})}}}function z6(Q){return j6(Q,function(Z){return Boolean(Z.error)})}function b6(Q){if(!Q.error&&!Q.aborted)Q.abort(),Q.aborted=!0}class PZ{constructor(Q,Z,Y){this.strategy=Q,this.transports=Z,this.ttl=Y.ttl||1800000,this.usingTLS=Y.useTLS,this.timeline=Y.timeline}isSupported(){return this.strategy.isSupported()}connect(Q,Z){var Y=this.usingTLS,$=k6(Y),H=$&&$.cacheSkipCount?$.cacheSkipCount:0,J=[this.strategy];if($&&$.timestamp+this.ttl>=I.now()){var G=this.transports[$.transport];if(G)if(["ws","wss"].includes($.transport)||H>3)this.timeline.info({cached:!0,transport:$.transport,latency:$.latency}),J.push(new y([G],{timeout:$.latency*2+1000,failFast:!0}));else H++}var R=I.now(),V=J.pop().connect(Q,function E(U,j){if(U)if(NZ(Y),J.length>0)R=I.now(),V=J.pop().connect(Q,E);else Z(U);else f6(Y,j.transport.name,I.now()-R,H),Z(null,j)});return{abort:function(){V.abort()},forceMinPriority:function(E){if(Q=E,V)V.forceMinPriority(E)}}}}function xQ(Q){return"pusherTransport"+(Q?"TLS":"NonTLS")}function k6(Q){var Z=q.getLocalStorage();if(Z)try{var Y=Z[xQ(Q)];if(Y)return JSON.parse(Y)}catch($){NZ(Q)}return null}function f6(Q,Z,Y,$){var H=q.getLocalStorage();if(H)try{H[xQ(Q)]=RQ({timestamp:I.now(),transport:Z,latency:Y,cacheSkipCount:$})}catch(J){}}function NZ(Q){var Z=q.getLocalStorage();if(Z)try{delete Z[xQ(Q)]}catch(Y){}}class s{constructor(Q,{delay:Z}){this.strategy=Q,this.options={delay:Z}}isSupported(){return this.strategy.isSupported()}connect(Q,Z){var Y=this.strategy,$,H=new v(this.options.delay,function(){$=Y.connect(Q,Z)});return{abort:function(){if(H.ensureAborted(),$)$.abort()},forceMinPriority:function(J){if(Q=J,$)$.forceMinPriority(J)}}}}class d{constructor(Q,Z,Y){this.test=Q,this.trueBranch=Z,this.falseBranch=Y}isSupported(){var Q=this.test()?this.trueBranch:this.falseBranch;return Q.isSupported()}connect(Q,Z){var Y=this.test()?this.trueBranch:this.falseBranch;return Y.connect(Q,Z)}}class MZ{constructor(Q){this.strategy=Q}isSupported(){return this.strategy.isSupported()}connect(Q,Z){var Y=this.strategy.connect(Q,function($,H){if(H)Y.abort();Z($,H)});return Y}}function o(Q){return function(){return Q.isSupported()}}var SZ=function(Q,Z,Y){var $={};function H(fQ,aZ,nZ,tZ,eZ){var yQ=Y(Q,fQ,aZ,nZ,tZ,eZ);return $[fQ]=yQ,yQ}var J=Object.assign({},Z,{hostNonTLS:Q.wsHost+":"+Q.wsPort,hostTLS:Q.wsHost+":"+Q.wssPort,httpPath:Q.wsPath}),G=Object.assign({},J,{useTLS:!0}),R=Object.assign({},Z,{hostNonTLS:Q.httpHost+":"+Q.httpPort,hostTLS:Q.httpHost+":"+Q.httpsPort,httpPath:Q.httpPath}),V={loop:!0,timeout:15000,timeoutLimit:60000},E=new LQ({minPingDelay:1e4,maxPingDelay:Q.activityTimeout}),U=new LQ({lives:2,minPingDelay:1e4,maxPingDelay:Q.activityTimeout}),j=H("ws","ws",3,J,E),X=H("wss","ws",3,G,E),W=H("sockjs","sockjs",1,R),K=H("xhr_streaming","xhr_streaming",1,R,U),A=H("xdr_streaming","xdr_streaming",1,R,U),L=H("xhr_polling","xhr_polling",1,R),C=H("xdr_polling","xdr_polling",1,R),O=new y([j],V),T=new y([X],V),x=new y([W],V),M=new y([new d(o(K),K,A)],V),p=new y([new d(o(L),L,C)],V),ZQ=new y([new d(o(M),new $Q([M,new s(p,{delay:4000})]),p)],V),jQ=new d(o(ZQ),ZQ,x),KQ;if(Z.useTLS)KQ=new $Q([O,new s(jQ,{delay:2000})]);else KQ=new $Q([O,new s(T,{delay:2000}),new s(jQ,{delay:5000})]);return new PZ(new MZ(new d(o(j),KQ,jQ)),$,{ttl:1800000,timeline:Z.timeline,useTLS:Z.useTLS})};function xZ(){var Q=this;if(Q.timeline.info(Q.buildTimelineMessage({transport:Q.name+(Q.options.useTLS?"s":"")})),Q.hooks.isInitialized())Q.changeState("initialized");else if(Q.hooks.file)Q.changeState("initializing"),WQ.load(Q.hooks.file,{useTLS:Q.options.useTLS},function(Z,Y){if(Q.hooks.isInitialized())Q.changeState("initialized"),Y(!0);else{if(Z)Q.onError(Z);Q.onClose(),Y(!1)}});else Q.onClose()}var y6={getRequest:function(Q){var Z=new window.XDomainRequest;return Z.ontimeout=function(){Q.emit("error",new rQ),Q.close()},Z.onerror=function(Y){Q.emit("error",Y),Q.close()},Z.onprogress=function(){if(Z.responseText&&Z.responseText.length>0)Q.onChunk(200,Z.responseText)},Z.onload=function(){if(Z.responseText&&Z.responseText.length>0)Q.onChunk(200,Z.responseText);Q.emit("finished",200),Q.close()},Z},abortRequest:function(Q){Q.ontimeout=Q.onerror=Q.onprogress=Q.onload=null,Q.abort()}},v6=262144;class zZ extends z{constructor(Q,Z,Y){super();this.hooks=Q,this.method=Z,this.url=Y}start(Q){if(this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},q.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader)this.xhr.setRequestHeader("Content-Type","application/json");this.xhr.send(Q)}close(){if(this.unloader)q.removeUnloadListener(this.unloader),this.unloader=null;if(this.xhr)this.hooks.abortRequest(this.xhr),this.xhr=null}onChunk(Q,Z){while(!0){var Y=this.advanceBuffer(Z);if(Y)this.emit("chunk",{status:Q,data:Y});else break}if(this.isBufferTooLong(Z))this.emit("buffer_too_long")}advanceBuffer(Q){var Z=Q.slice(this.position),Y=Z.indexOf(`
`);if(Y!==-1)return this.position+=Y+1,Z.slice(0,Y);else return null}isBufferTooLong(Q){return this.position===Q.length&&Q.length>v6}}var b;(function(Q){Q[Q.CONNECTING=0]="CONNECTING",Q[Q.OPEN=1]="OPEN",Q[Q.CLOSED=3]="CLOSED"})(b||(b={}));var g6=1;class bZ{constructor(Q,Z){this.hooks=Q,this.session=kZ(1000)+"/"+u6(8),this.location=p6(Z),this.readyState=b.CONNECTING,this.openStream()}send(Q){return this.sendRaw(JSON.stringify([Q]))}ping(){this.hooks.sendHeartbeat(this)}close(Q,Z){this.onClose(Q,Z,!0)}sendRaw(Q){if(this.readyState===b.OPEN)try{return q.createSocketRequest("POST",uQ(m6(this.location,this.session))).start(Q),!0}catch(Z){return!1}else return!1}reconnect(){this.closeStream(),this.openStream()}onClose(Q,Z,Y){if(this.closeStream(),this.readyState=b.CLOSED,this.onclose)this.onclose({code:Q,reason:Z,wasClean:Y})}onChunk(Q){if(Q.status!==200)return;if(this.readyState===b.OPEN)this.onActivity();var Z,Y=Q.data.slice(0,1);switch(Y){case"o":Z=JSON.parse(Q.data.slice(1)||"{}"),this.onOpen(Z);break;case"a":Z=JSON.parse(Q.data.slice(1)||"[]");for(var $=0;$<Z.length;$++)this.onEvent(Z[$]);break;case"m":Z=JSON.parse(Q.data.slice(1)||"null"),this.onEvent(Z);break;case"h":this.hooks.onHeartbeat(this);break;case"c":Z=JSON.parse(Q.data.slice(1)||"[]"),this.onClose(Z[0],Z[1],!0);break}}onOpen(Q){if(this.readyState===b.CONNECTING){if(Q&&Q.hostname)this.location.base=h6(this.location.base,Q.hostname);if(this.readyState=b.OPEN,this.onopen)this.onopen()}else this.onClose(1006,"Server lost session",!0)}onEvent(Q){if(this.readyState===b.OPEN&&this.onmessage)this.onmessage({data:Q})}onActivity(){if(this.onactivity)this.onactivity()}onError(Q){if(this.onerror)this.onerror(Q)}openStream(){this.stream=q.createSocketRequest("POST",uQ(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",(Q)=>{this.onChunk(Q)}),this.stream.bind("finished",(Q)=>{this.hooks.onFinished(this,Q)}),this.stream.bind("buffer_too_long",()=>{this.reconnect()});try{this.stream.start()}catch(Q){I.defer(()=>{this.onError(Q),this.onClose(1006,"Could not start streaming",!1)})}}closeStream(){if(this.stream)this.stream.unbind_all(),this.stream.close(),this.stream=null}}function p6(Q){var Z=/([^\?]*)\/*(\??.*)/.exec(Q);return{base:Z[1],queryString:Z[2]}}function m6(Q,Z){return Q.base+"/"+Z+"/xhr_send"}function uQ(Q){var Z=Q.indexOf("?")===-1?"?":"&";return Q+Z+"t="+ +new Date+"&n="+g6++}function h6(Q,Z){var Y=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(Q);return Y[1]+Z+Y[3]}function kZ(Q){return q.randomInt(Q)}function u6(Q){var Z=[];for(var Y=0;Y<Q;Y++)Z.push(kZ(32).toString(32));return Z.join("")}var d6={getReceiveURL:function(Q,Z){return Q.base+"/"+Z+"/xhr_streaming"+Q.queryString},onHeartbeat:function(Q){Q.sendRaw("[]")},sendHeartbeat:function(Q){Q.sendRaw("[]")},onFinished:function(Q,Z){Q.onClose(1006,"Connection interrupted ("+Z+")",!1)}},c6={getReceiveURL:function(Q,Z){return Q.base+"/"+Z+"/xhr"+Q.queryString},onHeartbeat:function(){},sendHeartbeat:function(Q){Q.sendRaw("[]")},onFinished:function(Q,Z){if(Z===200)Q.reconnect();else Q.onClose(1006,"Connection interrupted ("+Z+")",!1)}},l6={getRequest:function(Q){var Z=q.getXHRAPI(),Y=new Z;return Y.onreadystatechange=Y.onprogress=function(){switch(Y.readyState){case 3:if(Y.responseText&&Y.responseText.length>0)Q.onChunk(Y.status,Y.responseText);break;case 4:if(Y.responseText&&Y.responseText.length>0)Q.onChunk(Y.status,Y.responseText);Q.emit("finished",Y.status),Q.close();break}},Y},abortRequest:function(Q){Q.onreadystatechange=null,Q.abort()}},zQ={createStreamingSocket(Q){return this.createSocket(d6,Q)},createPollingSocket(Q){return this.createSocket(c6,Q)},createSocket(Q,Z){return new bZ(Q,Z)},createXHR(Q,Z){return this.createRequest(l6,Q,Z)},createRequest(Q,Z,Y){return new zZ(Q,Z,Y)}};zQ.createXDR=function(Q,Z){return this.createRequest(y6,Q,Z)};var o6={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:GQ,DependenciesReceivers:DQ,getDefaultStrategy:SZ,Transports:QQ,transportConnectionInitializer:xZ,HTTPFactory:zQ,TimelineTransport:WZ,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(Q){window.Pusher=Q;var Z=()=>{this.onDocumentBody(Q.ready)};if(!window.JSON)WQ.load("json2",{},Z);else Z()},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{ajax:eQ,jsonp:GZ}},onDocumentBody(Q){if(document.body)Q();else setTimeout(()=>{this.onDocumentBody(Q)},0)},createJSONPRequest(Q,Z){return new bQ(Q,Z)},createScriptRequest(Q){return new NQ(Q)},getLocalStorage(){try{return window.localStorage}catch(Q){return}},createXHR(){if(this.getXHRAPI())return this.createXMLHttpRequest();else return this.createMicrosoftXHR()},createXMLHttpRequest(){var Q=this.getXHRAPI();return new Q},createMicrosoftXHR(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork(){return qZ},createWebSocket(Q){var Z=this.getWebSocketAPI();return new Z(Q)},createSocketRequest(Q,Z){if(this.isXHRSupported())return this.HTTPFactory.createXHR(Q,Z);else if(this.isXDRSupported(Z.indexOf("https:")===0))return this.HTTPFactory.createXDR(Q,Z);else throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var Q=this.getXHRAPI();return Boolean(Q)&&new Q().withCredentials!==void 0},isXDRSupported(Q){var Z=Q?"https:":"http:",Y=this.getProtocol();return Boolean(window.XDomainRequest)&&Y===Z},addUnloadListener(Q){if(window.addEventListener!==void 0)window.addEventListener("unload",Q,!1);else if(window.attachEvent!==void 0)window.attachEvent("onunload",Q)},removeUnloadListener(Q){if(window.addEventListener!==void 0)window.removeEventListener("unload",Q,!1);else if(window.detachEvent!==void 0)window.detachEvent("onunload",Q)},randomInt(Q){return Math.floor(function(){return(window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)}()*Q)}};class bQ{constructor(Q,Z){this.url=Q,this.data=Z}send(Q){if(this.request)return;var Z=E6(this.data),Y=this.url+"/"+Q.number+"?"+Z;this.request=o6.createScriptRequest(Y),this.request.send(Q)}cleanup(){if(this.request)this.request.cleanup()}}var q={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:GQ,DependenciesReceivers:DQ,getDefaultStrategy:SZ,Transports:QQ,transportConnectionInitializer:xZ,HTTPFactory:zQ,TimelineTransport:WZ,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(Q){window.Pusher=Q;var Z=()=>{this.onDocumentBody(Q.ready)};if(!window.JSON)WQ.load("json2",{},Z);else Z()},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{ajax:eQ,jsonp:GZ}},onDocumentBody(Q){if(document.body)Q();else setTimeout(()=>{this.onDocumentBody(Q)},0)},createJSONPRequest(Q,Z){return new bQ(Q,Z)},createScriptRequest(Q){return new NQ(Q)},getLocalStorage(){try{return window.localStorage}catch(Q){return}},createXHR(){if(this.getXHRAPI())return this.createXMLHttpRequest();else return this.createMicrosoftXHR()},createXMLHttpRequest(){var Q=this.getXHRAPI();return new Q},createMicrosoftXHR(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork(){return qZ},createWebSocket(Q){var Z=this.getWebSocketAPI();return new Z(Q)},createSocketRequest(Q,Z){if(this.isXHRSupported())return this.HTTPFactory.createXHR(Q,Z);else if(this.isXDRSupported(Z.indexOf("https:")===0))return this.HTTPFactory.createXDR(Q,Z);else throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var Q=this.getXHRAPI();return Boolean(Q)&&new Q().withCredentials!==void 0},isXDRSupported(Q){var Z=Q?"https:":"http:",Y=this.getProtocol();return Boolean(window.XDomainRequest)&&Y===Z},addUnloadListener(Q){if(window.addEventListener!==void 0)window.addEventListener("unload",Q,!1);else if(window.attachEvent!==void 0)window.attachEvent("onunload",Q)},removeUnloadListener(Q){if(window.addEventListener!==void 0)window.removeEventListener("unload",Q,!1);else if(window.detachEvent!==void 0)window.detachEvent("onunload",Q)},randomInt(Q){return Math.floor(function(){return(window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/4294967296}()*Q)}},CQ;(function(Q){Q[Q.ERROR=3]="ERROR",Q[Q.INFO=6]="INFO",Q[Q.DEBUG=7]="DEBUG"})(CQ||(CQ={}));var HQ=CQ;class fZ{constructor(Q,Z,Y){this.key=Q,this.session=Z,this.events=[],this.options=Y||{},this.sent=0,this.uniqueID=0}log(Q,Z){if(Q<=this.options.level){if(this.events.push(N({},Z,{timestamp:I.now()})),this.options.limit&&this.events.length>this.options.limit)this.events.shift()}}error(Q){this.log(HQ.ERROR,Q)}info(Q){this.log(HQ.INFO,Q)}debug(Q){this.log(HQ.DEBUG,Q)}isEmpty(){return this.events.length===0}send(Q,Z){var Y=N({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],Q(Y,($,H)=>{if(!$)this.sent++;if(Z)Z($,H)}),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}}class yZ{constructor(Q,Z,Y,$){this.name=Q,this.priority=Z,this.transport=Y,this.options=$||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(Q,Z){if(!this.isSupported())return dQ(new tQ,Z);else if(this.priority<Q)return dQ(new sQ,Z);var Y=!1,$=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),H=null,J=function(){$.unbind("initialized",J),$.connect()},G=function(){H=k.createHandshake($,function(U){Y=!0,E(),Z(null,U)})},R=function(U){E(),Z(U)},V=function(){E();var U=RQ($);Z(new aQ(U))},E=function(){$.unbind("initialized",J),$.unbind("open",G),$.unbind("error",R),$.unbind("closed",V)};return $.bind("initialized",J),$.bind("open",G),$.bind("error",R),$.bind("closed",V),$.initialize(),{abort:()=>{if(Y)return;if(E(),H)H.close();else $.close()},forceMinPriority:(U)=>{if(Y)return;if(this.priority<U)if(H)H.close();else $.close()}}}}function dQ(Q,Z){return I.defer(function(){Z(Q)}),{abort:function(){},forceMinPriority:function(){}}}var{Transports:i6}=q,r6=function(Q,Z,Y,$,H,J){var G=i6[Y];if(!G)throw new nQ(Y);var R=(!Q.enabledTransports||gQ(Q.enabledTransports,Z)!==-1)&&(!Q.disabledTransports||gQ(Q.disabledTransports,Z)===-1),V;if(R)H=Object.assign({ignoreNullOrigin:Q.ignoreNullOrigin},H),V=new yZ(Z,$,J?J.getAssistant(G):G,H);else V=s6;return V},s6={isSupported:function(){return!1},connect:function(Q,Z){var Y=I.defer(function(){Z(new tQ)});return{abort:function(){Y.ensureAborted()},forceMinPriority:function(){}}}};function a6(Q){if(Q==null)throw"You must pass an options object";if(Q.cluster==null)throw"Options object must provide a cluster";if("disableStats"in Q)B.warn("The disableStats option is deprecated in favor of enableStats")}var n6=(Q,Z)=>{var Y="socket_id="+encodeURIComponent(Q.socketId);for(var $ in Z.params)Y+="&"+encodeURIComponent($)+"="+encodeURIComponent(Z.params[$]);if(Z.paramsProvider!=null){let H=Z.paramsProvider();for(var $ in H)Y+="&"+encodeURIComponent($)+"="+encodeURIComponent(H[$])}return Y},t6=(Q)=>{if(typeof q.getAuthorizers()[Q.transport]>"u")throw`'${Q.transport}' is not a recognized auth transport`;return(Z,Y)=>{let $=n6(Z,Q);q.getAuthorizers()[Q.transport](q,$,Q,c.UserAuthentication,Y)}},e6=(Q,Z)=>{var Y="socket_id="+encodeURIComponent(Q.socketId);Y+="&channel_name="+encodeURIComponent(Q.channelName);for(var $ in Z.params)Y+="&"+encodeURIComponent($)+"="+encodeURIComponent(Z.params[$]);if(Z.paramsProvider!=null){let H=Z.paramsProvider();for(var $ in H)Y+="&"+encodeURIComponent($)+"="+encodeURIComponent(H[$])}return Y},Q8=(Q)=>{if(typeof q.getAuthorizers()[Q.transport]>"u")throw`'${Q.transport}' is not a recognized auth transport`;return(Z,Y)=>{let $=e6(Z,Q);q.getAuthorizers()[Q.transport](q,$,Q,c.ChannelAuthorization,Y)}},Z8=(Q,Z,Y)=>{let $={authTransport:Z.transport,authEndpoint:Z.endpoint,auth:{params:Z.params,headers:Z.headers}};return(H,J)=>{let G=Q.channel(H.channelName);Y(G,$).authorize(H.socketId,J)}};function Y8(Q,Z){let Y={activityTimeout:Q.activityTimeout||w.activityTimeout,cluster:Q.cluster,httpPath:Q.httpPath||w.httpPath,httpPort:Q.httpPort||w.httpPort,httpsPort:Q.httpsPort||w.httpsPort,pongTimeout:Q.pongTimeout||w.pongTimeout,statsHost:Q.statsHost||w.stats_host,unavailableTimeout:Q.unavailableTimeout||w.unavailableTimeout,wsPath:Q.wsPath||w.wsPath,wsPort:Q.wsPort||w.wsPort,wssPort:Q.wssPort||w.wssPort,enableStats:G8(Q),httpHost:$8(Q),useTLS:X8(Q),wsHost:H8(Q),userAuthenticator:W8(Q),channelAuthorizer:V8(Q,Z)};if("disabledTransports"in Q)Y.disabledTransports=Q.disabledTransports;if("enabledTransports"in Q)Y.enabledTransports=Q.enabledTransports;if("ignoreNullOrigin"in Q)Y.ignoreNullOrigin=Q.ignoreNullOrigin;if("timelineParams"in Q)Y.timelineParams=Q.timelineParams;if("nacl"in Q)Y.nacl=Q.nacl;return Y}function $8(Q){if(Q.httpHost)return Q.httpHost;if(Q.cluster)return`sockjs-${Q.cluster}.pusher.com`;return w.httpHost}function H8(Q){if(Q.wsHost)return Q.wsHost;return J8(Q.cluster)}function J8(Q){return`ws-${Q}.pusher.com`}function X8(Q){if(q.getProtocol()==="https:")return!0;else if(Q.forceTLS===!1)return!1;return!0}function G8(Q){if("enableStats"in Q)return Q.enableStats;if("disableStats"in Q)return!Q.disableStats;return!1}function W8(Q){let Z=Object.assign(Object.assign({},w.userAuthentication),Q.userAuthentication);if("customHandler"in Z&&Z.customHandler!=null)return Z.customHandler;return t6(Z)}function R8(Q,Z){let Y;if("channelAuthorization"in Q)Y=Object.assign(Object.assign({},w.channelAuthorization),Q.channelAuthorization);else{if(Y={transport:Q.authTransport||w.authTransport,endpoint:Q.authEndpoint||w.authEndpoint},"auth"in Q){if("params"in Q.auth)Y.params=Q.auth.params;if("headers"in Q.auth)Y.headers=Q.auth.headers}if("authorizer"in Q)Y.customHandler=Z8(Z,Y,Q.authorizer)}return Y}function V8(Q,Z){let Y=R8(Q,Z);if("customHandler"in Y&&Y.customHandler!=null)return Y.customHandler;return Q8(Y)}class vZ extends z{constructor(Q){super(function(Z,Y){B.debug(`No callbacks on watchlist events for ${Z}`)});this.pusher=Q,this.bindWatchlistInternalEvent()}handleEvent(Q){Q.data.events.forEach((Z)=>{this.emit(Z.name,Z)})}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",(Q)=>{var Z=Q.event;if(Z==="pusher_internal:watchlist_events")this.handleEvent(Q)})}}function U8(){let Q,Z;return{promise:new Promise(($,H)=>{Q=$,Z=H}),resolve:Q,reject:Z}}class gZ extends z{constructor(Q){super(function(Z,Y){B.debug("No callbacks on user for "+Z)});this.signin_requested=!1,this.user_data=null,this.serverToUserChannel=null,this.signinDonePromise=null,this._signinDoneResolve=null,this._onAuthorize=(Z,Y)=>{if(Z){B.warn(`Error during signin: ${Z}`),this._cleanup();return}this.pusher.send_event("pusher:signin",{auth:Y.auth,user_data:Y.user_data})},this.pusher=Q,this.pusher.connection.bind("state_change",({previous:Z,current:Y})=>{if(Z!=="connected"&&Y==="connected")this._signin();if(Z==="connected"&&Y!=="connected")this._cleanup(),this._newSigninPromiseIfNeeded()}),this.watchlist=new vZ(Q),this.pusher.connection.bind("message",(Z)=>{var Y=Z.event;if(Y==="pusher:signin_success")this._onSigninSuccess(Z.data);if(this.serverToUserChannel&&this.serverToUserChannel.name===Z.channel)this.serverToUserChannel.handleEvent(Z)})}signin(){if(this.signin_requested)return;this.signin_requested=!0,this._signin()}_signin(){if(!this.signin_requested)return;if(this._newSigninPromiseIfNeeded(),this.pusher.connection.state!=="connected")return;this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize)}_onSigninSuccess(Q){try{this.user_data=JSON.parse(Q.user_data)}catch(Z){B.error(`Failed parsing user data after signin: ${Q.user_data}`),this._cleanup();return}if(typeof this.user_data.id!=="string"||this.user_data.id===""){B.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),this._cleanup();return}this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){let Q=(Z)=>{if(Z.subscriptionPending&&Z.subscriptionCancelled)Z.reinstateSubscription();else if(!Z.subscriptionPending&&this.pusher.connection.state==="connected")Z.subscribe()};this.serverToUserChannel=new VQ(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global((Z,Y)=>{if(Z.indexOf("pusher_internal:")===0||Z.indexOf("pusher:")===0)return;this.emit(Z,Y)}),Q(this.serverToUserChannel)}_cleanup(){if(this.user_data=null,this.serverToUserChannel)this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null;if(this.signin_requested)this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested)return;if(this.signinDonePromise&&!this.signinDonePromise.done)return;let{promise:Q,resolve:Z}=U8();Q.done=!1;let Y=()=>{Q.done=!0};Q.then(Y).catch(Y),this.signinDonePromise=Q,this._signinDoneResolve=Z}}class BQ{constructor(Q){this.channelName=Q,this.conflationKey=null,this.maxMessagesPerKey=30,this.conflationCaches=new Map,this.baseMessage=null,this.baseSequence=null,this.lastSequence=null,this.deltaCount=0,this.fullMessageCount=0}initializeFromCacheSync(Q){if(this.conflationKey=Q.conflation_key||null,this.maxMessagesPerKey=Math.max(Q.max_messages_per_key||10,30),this.conflationCaches.clear(),Q.states)for(let[Z,Y]of Object.entries(Q.states)){let $=Y.map((H)=>({content:H.content,sequence:H.seq}));this.conflationCaches.set(Z,$)}}setBase(Q,Z){this.baseMessage=Q,this.baseSequence=Z,this.lastSequence=Z}getBaseMessage(Q,Z){if(!this.conflationKey)return this.baseMessage;let Y=Q||"",$=this.conflationCaches.get(Y);if(!$||Z===void 0)return console.error("[ChannelState] No cache or baseIndex undefined",{hasCache:!!$,baseIndex:Z,key:Y,allCacheKeys:Array.from(this.conflationCaches.keys())}),null;let H=$.find((J)=>J.sequence===Z);if(!H)return console.error("[ChannelState] Could not find message with sequence",{searchingFor:Z,cacheSize:$.length,cacheSequences:$.map((J)=>J.sequence),key:Q}),null;return H.content}updateConflationCache(Q,Z,Y){let $=Q||"",H=this.conflationCaches.get($);if(!H)H=[],this.conflationCaches.set($,H);H.push({content:Z,sequence:Y});while(H.length>this.maxMessagesPerKey)H.shift()}hasBase(){if(this.conflationKey)return this.conflationCaches.size>0;return this.baseMessage!==null&&this.baseSequence!==null}isValidSequence(Q){if(this.lastSequence===null)return!0;return Q>this.lastSequence}updateSequence(Q){this.lastSequence=Q}recordDelta(){this.deltaCount++}recordFullMessage(){this.fullMessageCount++}getStats(){return{channelName:this.channelName,conflationKey:this.conflationKey,conflationGroupCount:this.conflationCaches.size,deltaCount:this.deltaCount,fullMessageCount:this.fullMessageCount,totalMessages:this.deltaCount+this.fullMessageCount}}}var j8="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(Q){return Q.charCodeAt(0)}),K8=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];class pZ{a;pos;constructor(Q){this.a=Q,this.pos=0}haveBytes(){return this.pos<this.a.length}getByte(){let Q=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw RangeError("out of bounds");return Q}getChar(){return String.fromCharCode(this.getByte())}getInt(){let Q=0,Z;while(this.haveBytes()&&(Z=K8[127&this.getByte()])>=0)Q=(Q<<6)+Z;return this.pos--,Q>>>0}}class mZ{a=[];toByteArray(Q){if(Array.isArray(Q))return this.a;return new Uint8Array(this.a)}putByte(Q){this.a.push(Q&255)}putChar(Q){this.putByte(Q.charCodeAt(0))}putInt(Q){let Z=[];if(Q===0){this.putChar("0");return}let Y=0;for(;Q>0;Y++,Q>>>=6)Z.push(j8[Q&63]);for(let $=Y-1;$>=0;$--)this.putByte(Z[$])}putArray(Q,Z,Y){for(let $=Z;$<Y;$++)this.a.push(Q[$])}}function E8(Q){let Z=0,Y=0,$=0,H=0,J=0,G=Q.length;while(G>=16)Z=Z+Q[J+0]|0,Y=Y+Q[J+1]|0,$=$+Q[J+2]|0,H=H+Q[J+3]|0,Z=Z+Q[J+4]|0,Y=Y+Q[J+5]|0,$=$+Q[J+6]|0,H=H+Q[J+7]|0,Z=Z+Q[J+8]|0,Y=Y+Q[J+9]|0,$=$+Q[J+10]|0,H=H+Q[J+11]|0,Z=Z+Q[J+12]|0,Y=Y+Q[J+13]|0,$=$+Q[J+14]|0,H=H+Q[J+15]|0,J+=16,G-=16;while(G>=4)Z=Z+Q[J+0]|0,Y=Y+Q[J+1]|0,$=$+Q[J+2]|0,H=H+Q[J+3]|0,J+=4,G-=4;switch(H=((H+($<<8)|0)+(Y<<16)|0)+(Z<<24)|0,G){case 3:H=H+(Q[J+2]<<8)|0;case 2:H=H+(Q[J+1]<<16)|0;case 1:H=H+(Q[J+0]<<24)|0}return H>>>0}function FQ(Q,Z,Y){let $,H=0,J=new pZ(Z),G=Q.length,R=Z.length;if($=J.getInt(),J.getChar()!==`
`)throw Error("size integer not terminated by '\\n'");let V=new mZ;while(J.haveBytes()){let E=J.getInt(),U;switch(J.getChar()){case"@":if(U=J.getInt(),J.haveBytes()&&J.getChar()!==",")throw Error("copy command not terminated by ','");if(H+=E,H>$)throw Error("copy exceeds output file size");if(U+E>G)throw Error("copy extends past end of input");V.putArray(Q,U,U+E);break;case":":if(H+=E,H>$)throw Error("insert command gives an output larger than predicted");if(E>R)throw Error("insert count exceeds size of delta");V.putArray(J.a,J.pos,J.pos+E),J.pos+=E;break;case";":let j=V.toByteArray(Q);if((!Y||Y.verifyChecksum!==!1)&&E!==E8(j))throw Error("bad checksum");if(H!==$)throw Error("generated size does not match predicted size");return j;default:throw Error("unknown delta operator")}}throw Error("unterminated delta")}function A8(Q){let Z={};return Q.forEach((Y)=>{let $=function(J){var G=Error.apply(this,arguments);G.name=this.name=Y,this.stack=G.stack,this.message=G.message,this.name=Y,this.message=J};$.prototype=Object.create(Error.prototype,{constructor:{value:$,writable:!0,configurable:!0}}),Z[Y]=$}),Z}var a=A8(["NotImplemented","InvalidDelta"]);class wQ{constructor(){this.typedArrays=[],this.startIndexes=[],this.length=0}add(Q){if([Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array].filter((H)=>Q instanceof H).length<1)throw Error("Given "+typeof Q+" when expected a TypedArray");let $;if(this.typedArrays.length===0)$=0;else{let H=this.startIndexes.length-1,J=this.startIndexes[H],G=this.typedArrays[H].length;$=J+G}this.startIndexes.push($),this.typedArrays.push(Q),this.length+=$+Q.length}get(Q){let Z=cQ(this.startIndexes,Q),Y=Q-this.startIndexes[Z];return this.typedArrays[Z][Y]}set(Q,Z){if(typeof Q!=="number"||isNaN(Q))throw Error("Given non-number index: "+Q);let Y=cQ(this.startIndexes,Q),$=Q-this.startIndexes[Y];this.typedArrays[Y][$]=Z}}function cQ(Q,Z){if(Q.length===2)return Z<Q[1]?0:1;let Y=0,$=Q.length-1;while(Y<$){let H=Math.floor((Y+$)/2);if(Q[H]===Z)return H;else if(Q[H]<Z)Y=H+1;else $=H-1}if(Q[$]>Z)return $-1;else return $}function _(Q,Z){let Y={position:Z,value:0};do if(Y.value=Y.value<<7|Q[Y.position]&127,Y.value<0)throw Error("RFC 3284 Integer conversion: Buffer overflow");while(Q[Y.position++]&128);return Y}class hZ{constructor(Q){this.size=Q}name="ADD";execute(Q){for(let Z=0;Z<this.size;Z++)Q.U.set(Q.UTargetPosition+Z,Q.data[Q.dataPosition+Z]);Q.dataPosition+=this.size,Q.UTargetPosition+=this.size}}class uZ{constructor(Q,Z){this.size=Q,this.mode=Z}name="COPY";execute(Q){let Z,Y,$;if(this.mode===0)Z=Q.getNextAddressInteger();else if(this.mode===1)$=Q.getNextAddressInteger(),Z=Q.UTargetPosition-$;else if((Y=this.mode-2)>=0&&Y<Q.nearCache.size)$=Q.getNextAddressInteger(),Z=Q.nearCache.get(Y,$);else Y=this.mode-(2+Q.nearCache.size),$=Q.getNextAddressByte(),Z=Q.sameCache.get(Y,$);Q.nearCache.update(Z),Q.sameCache.update(Z);for(let H=0;H<this.size;H++)Q.U.set(Q.UTargetPosition+H,Q.U.get(Z+H));Q.UTargetPosition+=this.size}}class dZ{constructor(Q){this.size=Q}name="RUN";execute(Q){for(let Z=0;Z<this.size;Z++)Q.U.set(Q.UTargetPosition+Z,Q.data[Q.dataPosition]);Q.dataPosition++,Q.UTargetPosition+=this.size}}var F={ADD:hZ,COPY:uZ,RUN:dZ};function F8(Q){let Z=[],Y=0;while(Y<Q.length){let $=Q[Y++],H,J,G;if($===0)({value:G,position:Y}=_(Q,Y)),Z.push(new F.RUN(G));else if($===1)({value:G,position:Y}=_(Q,Y)),Z.push(new F.ADD(G));else if($<19)Z.push(new F.ADD($-1));else if($===19)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,0));else if($<35)Z.push(new F.COPY($-16,0));else if($===35)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,1));else if($<51)Z.push(new F.COPY($-32,1));else if($===51)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,2));else if($<67)Z.push(new F.COPY($-48,2));else if($===67)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,3));else if($<83)Z.push(new F.COPY($-64,3));else if($===83)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,4));else if($<99)Z.push(new F.COPY($-80,4));else if($===99)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,5));else if($<115)Z.push(new F.COPY($-96,5));else if($===115)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,6));else if($<131)Z.push(new F.COPY($-112,6));else if($===131)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,7));else if($<147)Z.push(new F.COPY($-128,7));else if($===147)({value:G,position:Y}=_(Q,Y)),Z.push(new F.COPY(G,8));else if($<163)Z.push(new F.COPY($-144,8));else if($<175)({addSize:H,copySize:J}=u($,163)),Z.push(new F.ADD(H)),Z.push(new F.COPY(J,0));else if($<187)({addSize:H,copySize:J}=u($,175)),Z.push(new F.ADD(H)),Z.push(new F.COPY(J,1));else if($<199)({addSize:H,copySize:J}=u($,187)),Z.push(new F.ADD(H)),Z.push(new F.COPY(J,2));else if($<211)({addSize:H,copySize:J}=u($,199)),Z.push(new F.ADD(H)),Z.push(new F.COPY(J,3));else if($<223)({addSize:H,copySize:J}=u($,211)),Z.push(new F.ADD(H)),Z.push(new F.COPY(J,4));else if($<235)({addSize:H,copySize:J}=u($,223)),Z.push(new F.ADD(H)),Z.push(new F.COPY(J,5));else if($<239)Z.push(new F.ADD($-235+1)),Z.push(new F.COPY(4,6));else if($<243)Z.push(new F.ADD($-239+1)),Z.push(new F.COPY(4,7));else if($<247)Z.push(new F.ADD($-243+1)),Z.push(new F.COPY(4,8));else if($<256)Z.push(new F.COPY(4,$-247)),Z.push(new F.ADD(1));else throw Error("Should not get here")}return Z}function u(Q,Z){let Y=Q-Z,H=Math.floor(Y/3)+1,G=Y%3+4;return{addSize:H,copySize:G}}function q8(Q,Z){let Y,$,H,J;if({value:Y,position:Z}=_(Q,Z),Q[Z]!==0)throw new a.NotImplemented("VCD_DECOMPRESS is not supported, Delta_Indicator must be zero at byte "+Z+" and not "+Q[Z]);Z++,{value:$,position:Z}=_(Q,Z),{value:H,position:Z}=_(Q,Z),{value:J,position:Z}=_(Q,Z);let G=Z+$,R=Q.slice(Z,G),V=G+H,E=Q.slice(G,V),U=F8(E),j=V+J,X=Q.slice(V,j);return Z=j,{targetWindowLength:Y,position:Z,data:R,instructions:U,addresses:X}}class cZ{constructor(Q){this.size=Q,this.near=Array(this.size).fill(0),this.nextSlot=0}update(Q){if(this.near.length>0)this.near[this.nextSlot]=Q,this.nextSlot=(this.nextSlot+1)%this.near.length}get(Q,Z){return this.near[Q]+Z}}class lZ{constructor(Q){this.size=Q,this.same=Array(this.size*256).fill(0)}update(Q){if(this.same.length>0)this.same[Q%(this.size*256)]=Q}get(Q,Z){return this.same[Q*256+Z]}}class oZ{constructor(Q,Z){this.delta=Q,this.position=0,this.source=Z,this.targetWindows=new wQ}decode(){this._consumeHeader();while(this._consumeWindow());let Q=this.targetWindows.typedArrays.reduce(($,H)=>H.length+$,0),Z=new Uint8Array(Q),Y=0;for(let $=0;$<this.targetWindows.typedArrays.length;$++){let H=this.targetWindows.typedArrays[$],J=H.length;Z.set(H,Y),Y+=J}return Z}_consumeHeader(){if(!(this.delta[0]===214&&this.delta[1]===195&&this.delta[2]===196&&this.delta[3]===0))throw new a.InvalidDelta("first 3 bytes not VCD");let Z=this.delta[4],Y=1&Z,$=1&Z>>1;if(Y||$)throw new a.NotImplemented("non-zero Hdr_Indicator (VCD_DECOMPRESS or VCD_CODETABLE bit is set)");this.position+=5}_consumeWindow(){let Q=this.delta[this.position++],Z=1&Q,Y=1&Q>>1;if(Z&&Y)throw new a.InvalidDelta("VCD_SOURCE and VCD_TARGET cannot both be set in Win_Indicator");else if(Z){let $,H,J;({value:$,position:this.position}=_(this.delta,this.position)),{value:H,position:this.position}=_(this.delta,this.position),{value:J,position:this.position}=_(this.delta,this.position);let G=this.source.slice(H,H+$);this._buildTargetWindow(this.position,G),this.position+=J}else if(Y)throw new a.NotImplemented("non-zero VCD_TARGET in Win_Indicator");else{let $;({value:$,position:this.position}=_(this.delta,this.position)),this._buildTargetWindow(this.position),this.position+=$}return this.position<this.delta.length}_buildTargetWindow(Q,Z){let Y=q8(this.delta,Q),$=new Uint8Array(Y.targetWindowLength),H=new wQ,J=0;if(Z)H.add(Z),J=Z.length;H.add($),this.source.length;let G=new iZ(H,J,Y.data,Y.addresses);Y.instructions.forEach((R)=>{R.execute(G)}),this.targetWindows.add($)}}class iZ{constructor(Q,Z,Y,$){this.U=Q,this.UTargetPosition=Z,this.data=Y,this.dataPosition=0,this.addresses=$,this.addressesPosition=0,this.nearCache=new cZ(4),this.sameCache=new lZ(3)}getNextAddressInteger(){let Q;return{value:Q,position:this.addressesPosition}=_(this.addresses,this.addressesPosition),Q}getNextAddressByte(){return this.addresses[this.addressesPosition++]}}function qQ(Q,Z){return new oZ(Q,Z).decode()}var i=typeof window<"u"?window.fossilDelta:void 0,r=typeof window<"u"?window.vcdiff:void 0;function L8(Q){let Z=atob(Q),Y=new Uint8Array(Z.length);for(let $=0;$<Z.length;$++)Y[$]=Z.charCodeAt($);return Y}function rZ(Q){if(Array.isArray(Q)||!(Q instanceof Uint8Array))Q=new Uint8Array(Q);return new TextDecoder().decode(Q)}function XQ(Q){return new TextEncoder().encode(Q)}class OQ{static isAvailable(){return typeof FQ<"u"||typeof i<"u"&&i.apply}static apply(Q,Z){if(!this.isAvailable())throw Error("Fossil Delta library not loaded");let Y=typeof Q==="string"?XQ(Q):Q,$=typeof Z==="string"?XQ(Z):Z;try{let H;if(typeof FQ<"u")H=FQ(Y,$);else if(i&&i.apply)H=i.apply(Y,$);else throw Error("No fossil-delta implementation found");return rZ(H)}catch(H){throw Error(`Fossil delta decode failed: ${H.message} (base=${Y.length}B delta=${$.length}B)`)}}}class TQ{static isAvailable(){return typeof qQ<"u"||typeof r<"u"&&r.decode}static apply(Q,Z){if(!this.isAvailable())throw Error("Xdelta3/VCDIFF library not loaded");let Y=typeof Q==="string"?XQ(Q):Q,$=typeof Z==="string"?XQ(Z):Z;try{let H;if(typeof qQ<"u")H=qQ($,Y);else if(r&&r.decode)H=r.decode($,Y);else throw Error("No VCDIFF decoder implementation found");return rZ(H)}catch(H){throw Error(`Xdelta3 decode failed: ${H.message} (base=${Y.length}B delta=${$.length}B)`)}}}class sZ{constructor(Q={},Z){if(this.defaultAlgorithm="fossil",this.options={enabled:Q.enabled!==!1,algorithms:Q.algorithms||["fossil","xdelta3"],debug:Q.debug||!1,onStats:Q.onStats||null,onError:Q.onError||null},this.enabled=!1,this.channelStates=new Map,this.stats={totalMessages:0,deltaMessages:0,fullMessages:0,totalBytesWithoutCompression:0,totalBytesWithCompression:0,errors:0},this.sendEventCallback=Z,this.availableAlgorithms=this.detectAvailableAlgorithms(),this.availableAlgorithms.length===0)B.warn("[DeltaCompression] No delta algorithms available. Please include fossil-delta or vcdiff-decoder libraries.")}detectAvailableAlgorithms(){let Q=[];if(OQ.isAvailable())Q.push("fossil"),this.log("Fossil Delta decoder available");if(TQ.isAvailable())Q.push("xdelta3"),this.log("Xdelta3 decoder available");return Q}enable(){if(this.enabled||!this.options.enabled)return;if(this.availableAlgorithms.length===0){this.log("No delta algorithms available, cannot enable");return}let Q=this.availableAlgorithms.filter((Z)=>this.options.algorithms.includes(Z));if(Q.length===0){this.log("No mutually supported algorithms");return}this.log("Sending enable request",Q),this.sendEventCallback("pusher:enable_delta_compression",{algorithms:Q})}disable(){this.enabled=!1}handleEnabled(Q){if(this.enabled=Q.enabled||!0,Q.algorithm)this.defaultAlgorithm=Q.algorithm;this.log("Delta compression enabled",Q)}handleCacheSync(Q,Z){this.log("Received cache sync",{channel:Q,conflationKey:Z.conflation_key,groupCount:Object.keys(Z.states||{}).length});let Y=this.channelStates.get(Q);if(!Y)Y=new BQ(Q),this.channelStates.set(Q,Y);Y.initializeFromCacheSync(Z),this.log("Cache initialized",Y.getStats())}handleDeltaMessage(Q,Z){var Y;let $=null;try{let{event:H,delta:J,seq:G}=Z,R=Z.algorithm||this.defaultAlgorithm||"fossil",V=Z.conflation_key,E=Z.base_index;this.log("Received delta message",{channel:Q,event:H,sequence:G,algorithm:R,conflationKey:V,baseIndex:E,deltaSize:J.length});let U=this.channelStates.get(Q);if(!U)return this.log(`Ignoring delta for unsubscribed channel: ${Q}`),null;let j;if(U.conflationKey){if(j=U.getBaseMessage(V,E),!j){if(this.error(`No base message for channel ${Q}, key ${V}, index ${E}`),this.options.debug)this.log("Current conflation cache snapshot",{channel:Q,conflationKey:U.conflationKey,cacheSizes:Array.from(U.conflationCaches.entries()).map(([W,K])=>({key:W,size:K.length}))});return this.requestResync(Q),null}}else if(j=U.baseMessage,!j){if(this.error(`No base message for channel ${Q}`),this.options.debug)this.log("Channel state missing base",{channel:Q,lastSequence:U.lastSequence});return this.requestResync(Q),null}$=L8(J);let X;try{if(R==="fossil")X=OQ.apply(j,$);else if(R==="xdelta3")X=TQ.apply(j,$);else throw Error(`Unknown algorithm: ${R}`)}catch(W){throw W}if(U.conflationKey)U.updateConflationCache(V,X,G);else U.setBase(X,G);U.updateSequence(G),U.recordDelta(),this.stats.totalMessages++,this.stats.deltaMessages++,this.stats.totalBytesWithCompression+=$.length,this.stats.totalBytesWithoutCompression+=X.length,this.updateStats(),this.log("Delta applied successfully",{channel:Q,event:H,conflationKey:V,originalSize:X.length,deltaSize:$.length,compressionRatio:($.length/X.length*100).toFixed(1)+"%"});try{let W=JSON.parse(X);return{event:H,channel:Q,data:W.data||W}}catch(W){return{event:H,channel:Q,data:X}}}catch(H){return this.error("Delta decode failed",{channel:Q,event:Z.event,sequence:Z.seq,algorithm:Z.algorithm,conflationKey:Z.conflation_key,baseIndex:Z.base_index,deltaSize:(Y=Z.delta)===null||Y===void 0?void 0:Y.length,decodedDeltaBytes:$?$.length:"n/a",message:H.message}),this.stats.errors++,null}}handleFullMessage(Q,Z,Y,$){var H,J,G;if(!Y&&Y!==0)try{let U=JSON.parse(Z),j=typeof U.data==="string"?(H=JSON.parse(U.data).__delta_seq)!==null&&H!==void 0?H:U.__delta_seq:(G=(J=U.data)===null||J===void 0?void 0:J.__delta_seq)!==null&&G!==void 0?G:U.__delta_seq;if(j===0||j)Y=j;else{this.log("handleFullMessage missing sequence, skipping",{channel:Q,hasSequence:!1});return}}catch(U){this.log("handleFullMessage missing sequence and parse failed",{channel:Q,hasSequence:!1});return}let R=Z.length,V=this.channelStates.get(Q);if(!V)V=new BQ(Q),this.channelStates.set(Q,V);let E=$;if(E!==void 0&&!V.conflationKey)V.conflationKey="enabled";if(V.conflationKey&&E!==void 0)V.updateConflationCache(E,Z,Y),this.log("Stored full message (conflation)",{channel:Q,conflationKey:E,sequence:Y,size:R});else V.setBase(Z,Y),this.log("Stored full message",{channel:Q,sequence:Y,size:R});V.recordFullMessage(),this.stats.totalMessages++,this.stats.fullMessages++,this.stats.totalBytesWithoutCompression+=R,this.stats.totalBytesWithCompression+=R,this.updateStats()}requestResync(Q){this.log("Requesting resync for channel",Q),this.sendEventCallback("pusher:delta_sync_error",{channel:Q}),this.channelStates.delete(Q)}updateStats(){if(this.options.onStats)this.options.onStats(this.getStats())}getStats(){let Q=this.stats.totalBytesWithoutCompression-this.stats.totalBytesWithCompression,Z=this.stats.totalBytesWithoutCompression>0?Q/this.stats.totalBytesWithoutCompression*100:0,Y=Array.from(this.channelStates.values()).map(($)=>$.getStats());return Object.assign(Object.assign({},this.stats),{bandwidthSaved:Q,bandwidthSavedPercent:Z,channelCount:this.channelStates.size,channels:Y})}resetStats(){this.stats={totalMessages:0,deltaMessages:0,fullMessages:0,totalBytesWithoutCompression:0,totalBytesWithCompression:0,errors:0},this.updateStats()}clearChannelState(Q){if(Q)this.channelStates.delete(Q);else this.channelStates.clear()}isEnabled(){return this.enabled}getAvailableAlgorithms(){return this.availableAlgorithms}log(...Q){if(this.options.debug)B.debug("[DeltaCompression]",...Q)}error(...Q){if(B.error("[DeltaCompression]",...Q),this.options.onError)this.options.onError(Q)}}class D{static get logToConsole(){return this._logToConsole}static set logToConsole(Q){this._logToConsole=Q,pQ({logToConsole:Q,log:this._log})}static get log(){return this._log}static set log(Q){this._log=Q,pQ({logToConsole:this._logToConsole,log:Q})}static ready(){D.isReady=!0;for(var Q=0,Z=D.instances.length;Q<Z;Q++)D.instances[Q].connect()}static getClientFeatures(){return ZZ(HZ({ws:q.Transports.ws},function(Q){return Q.isSupported({})}))}constructor(Q,Z){if(C8(Q),a6(Z),this.key=Q,this.config=Y8(Z,this),this.channels=k.createChannels(),this.global_emitter=new z,this.sessionID=q.randomInt(1e9),this.timeline=new fZ(this.key,this.sessionID,{cluster:this.config.cluster,features:D.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:HQ.INFO,version:w.VERSION}),this.config.enableStats)this.timelineSender=k.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+q.TimelineTransport.name});var Y=($)=>{return q.getDefaultStrategy(this.config,$,r6)};if(this.connection=k.createConnectionManager(this.key,{getStrategy:Y,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:Boolean(this.config.useTLS)}),Z.deltaCompression!==void 0)this.deltaCompression=new sZ(Z.deltaCompression||{},($,H)=>this.send_event($,H));if(this.connection.bind("connected",()=>{var $;if(this.subscribeAll(),this.timelineSender)this.timelineSender.send(this.connection.isUsingTLS());if(this.deltaCompression&&(($=Z.deltaCompression)===null||$===void 0?void 0:$.enabled)===!0)this.deltaCompression.enable()}),this.connection.bind("message",($)=>{var H=$.event,J=H.indexOf("pusher_internal:")===0;if(this.deltaCompression){if(H==="pusher:delta_compression_enabled")this.deltaCompression.handleEnabled($.data);else if(H==="pusher:delta_cache_sync"&&$.channel){this.deltaCompression.handleCacheSync($.channel,$.data);return}else if(H==="pusher:delta"&&$.channel){var G=this.channel($.channel);if(!G)return;let R=this.deltaCompression.handleDeltaMessage($.channel,$.data);if(R){if(G)G.handleEvent(R);this.global_emitter.emit(R.event,R.data)}return}}if($.channel){var G=this.channel($.channel);if(G)G.handleEvent($);if(this.deltaCompression&&$.event&&!$.event.startsWith("pusher:")&&!$.event.startsWith("pusher_internal:")){let V;if(typeof $.sequence==="number")V=$.sequence;let E;if(typeof $.conflation_key==="string")E=$.conflation_key;let U=$.rawMessage||"";if(U&&V!==void 0)U=U.replace(/,"__delta_seq":\d+/g,""),U=U.replace(/"__delta_seq":\d+,/g,""),U=U.replace(/,"__conflation_key":"[^"]*"/g,""),U=U.replace(/"__conflation_key":"[^"]*",/g,"");this.deltaCompression.handleFullMessage($.channel,U,V,E)}}if(!J)this.global_emitter.emit($.event,$.data)}),this.connection.bind("connecting",()=>{this.channels.disconnect()}),this.connection.bind("disconnected",()=>{this.channels.disconnect()}),this.connection.bind("error",($)=>{B.warn($)}),D.instances.push(this),this.timeline.info({instances:D.instances.length}),this.user=new gZ(this),D.isReady)this.connect()}channel(Q){return this.channels.find(Q)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender){if(!this.timelineSenderTimer){var Q=this.connection.isUsingTLS(),Z=this.timelineSender;this.timelineSenderTimer=new QZ(60000,function(){Z.send(Q)})}}}disconnect(){if(this.connection.disconnect(),this.timelineSenderTimer)this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null}bind(Q,Z,Y){return this.global_emitter.bind(Q,Z,Y),this}unbind(Q,Z,Y){return this.global_emitter.unbind(Q,Z,Y),this}bind_global(Q){return this.global_emitter.bind_global(Q),this}unbind_global(Q){return this.global_emitter.unbind_global(Q),this}unbind_all(Q){return this.global_emitter.unbind_all(),this}subscribeAll(){var Q;for(Q in this.channels.channels)if(this.channels.channels.hasOwnProperty(Q))this.subscribe(Q)}subscribe(Q,Z){var Y=this.channels.add(Q,this);if(Z)Y.tagsFilter=Z;if(Y.subscriptionPending&&Y.subscriptionCancelled)Y.reinstateSubscription();else if(!Y.subscriptionPending&&this.connection.state==="connected")Y.subscribe();return Y}unsubscribe(Q){var Z=this.channels.find(Q);if(Z&&Z.subscriptionPending)Z.cancelSubscription();else if(Z=this.channels.remove(Q),Z&&Z.subscribed)Z.unsubscribe();if(this.deltaCompression)this.deltaCompression.clearChannelState(Q)}send_event(Q,Z,Y){return this.connection.send_event(Q,Z,Y)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}getDeltaStats(){if(!this.deltaCompression)return null;return this.deltaCompression.getStats()}resetDeltaStats(){if(this.deltaCompression)this.deltaCompression.resetStats()}}D.instances=[];D.isReady=!1;D._logToConsole=!1;D.Runtime=q;D.ScriptReceivers=q.ScriptReceivers;D.DependenciesReceivers=q.DependenciesReceivers;D.auth_callbacks=q.auth_callbacks;function C8(Q){if(Q===null||Q===void 0)throw"You must pass your app key when you instantiate Pusher."}q.setup(D);var S={eq:(Q,Z)=>({key:Q,cmp:"eq",val:Z}),neq:(Q,Z)=>({key:Q,cmp:"neq",val:Z}),in:(Q,Z)=>({key:Q,cmp:"in",vals:Z}),nin:(Q,Z)=>({key:Q,cmp:"nin",vals:Z}),exists:(Q)=>({key:Q,cmp:"ex"}),notExists:(Q)=>({key:Q,cmp:"nex"}),startsWith:(Q,Z)=>({key:Q,cmp:"sw",val:Z}),endsWith:(Q,Z)=>({key:Q,cmp:"ew",val:Z}),contains:(Q,Z)=>({key:Q,cmp:"ct",val:Z}),gt:(Q,Z)=>({key:Q,cmp:"gt",val:Z}),gte:(Q,Z)=>({key:Q,cmp:"gte",val:Z}),lt:(Q,Z)=>({key:Q,cmp:"lt",val:Z}),lte:(Q,Z)=>({key:Q,cmp:"lte",val:Z}),and:(...Q)=>({op:"and",nodes:Q}),or:(...Q)=>({op:"or",nodes:Q}),not:(Q)=>({op:"not",nodes:[Q]})};var kQ={eventType:(Q)=>S.eq("event_type",Q),eventTypes:(Q)=>S.in("event_type",Q),range:(Q,Z,Y)=>S.and(S.gte(Q,Z),S.lte(Q,Y)),importantEvents:(Q)=>S.or(S.eq("event_type","goal"),S.and(S.eq("event_type","shot"),S.gte("xG",Q)))};document.addEventListener("DOMContentLoaded",()=>{let Q={configDisplay:document.getElementById("config-display"),connectBtn:document.getElementById("connect-btn"),disconnectBtn:document.getElementById("disconnect-btn"),connectionStatus:document.getElementById("connection-status"),statusDot:document.getElementById("status-dot"),channelNameInput:document.getElementById("channel-name"),subscribeBtn:document.getElementById("subscribe-btn"),subscribedChannels:document.getElementById("subscribed-channels"),channelCount:document.getElementById("channel-count"),enableTagFilter:document.getElementById("enable-tag-filter"),tagFilterControls:document.getElementById("tag-filter-controls"),filterPreset:document.getElementById("filter-preset"),filterJson:document.getElementById("filter-json"),serverEventChannel:document.getElementById("server-event-channel"),serverEventName:document.getElementById("server-event-name"),serverEventData:document.getElementById("server-event-data"),serverEventTags:document.getElementById("server-event-tags"),conflationKey:document.getElementById("conflation-key"),sendServerEventBtn:document.getElementById("send-server-event-btn"),sendBatchEventsBtn:document.getElementById("send-batch-events-btn"),clientEventChannel:document.getElementById("client-event-channel"),clientEventName:document.getElementById("client-event-name"),clientEventData:document.getElementById("client-event-data"),sendClientEventBtn:document.getElementById("send-client-event-btn"),eventsLog:document.getElementById("events-log"),clearEventsBtn:document.getElementById("clear-events-btn"),exportEventsBtn:document.getElementById("export-events-btn"),presenceChannelName:document.getElementById("presence-channel-name"),presenceCount:document.getElementById("presence-count"),presenceMembers:document.getElementById("presence-members"),totalEvents:document.getElementById("total-events"),totalChannels:document.getElementById("total-channels"),connectionTime:document.getElementById("connection-time"),webhookCount:document.getElementById("webhook-count"),webhooksLog:document.getElementById("webhooks-log"),fetchWebhooksBtn:document.getElementById("fetch-webhooks-btn"),clearWebhooksBtn:document.getElementById("clear-webhooks-btn"),deltaCompressionToggle:document.getElementById("delta-compression-toggle"),deltaEnabled:document.getElementById("delta-enabled"),deltaMessages:document.getElementById("delta-messages"),fullMessages:document.getElementById("full-messages"),bandwidthSaved:document.getElementById("bandwidth-saved")},Z={pusher:null,config:null,channels:new Map,currentPresenceChannel:null,events:[],webhooks:[],stats:{totalEvents:0,connectionStartTime:null,connectionTimer:null},currentEventFilter:"all",tagFiltering:{enabled:!1,currentFilter:null},deltaCompression:{enabled:!1,channelStates:new Map,stats:{deltaMessages:0,fullMessages:0,totalBytesWithoutCompression:0,totalBytesWithCompression:0}}},Y={formatTime(X){return new Date(X).toLocaleTimeString()},formatJSON(X){try{return JSON.stringify(X,null,2)}catch(W){return String(X)}},getChannelType(X){if(X.startsWith("presence-"))return"presence";if(X.startsWith("private-"))return"private";return"public"},exportEvents(){let X=JSON.stringify(Z.events,null,2),W=new Blob([X],{type:"application/json"}),K=URL.createObjectURL(W),A=document.createElement("a");A.href=K,A.download=`pusher-events-${Date.now()}.json`,A.click(),URL.revokeObjectURL(K)},updateConnectionTimer(){if(Z.stats.connectionStartTime){let X=Date.now()-Z.stats.connectionStartTime,W=Math.floor(X/60000),K=Math.floor(X%60000/1000);Q.connectionTime.textContent=`${W.toString().padStart(2,"0")}:${K.toString().padStart(2,"0")}`}},addAnimation(X,W="fade-in"){X.classList.add(W),setTimeout(()=>X.classList.remove(W),300)}},$={add(X){if(X.id=Date.now()+Math.random(),Z.events.unshift(X),Z.stats.totalEvents++,Z.events.length>500)Z.events=Z.events.slice(0,500);$.render(),$.updateStats()},render(){let X=Z.events.filter((W)=>{if(Z.currentEventFilter==="all")return!0;return W.type===Z.currentEventFilter});Q.eventsLog.innerHTML="",X.forEach((W)=>{let K=document.createElement("li");K.className="event-item",K.innerHTML=`
          <div class="event-header">
            <div>
              <span class="event-type ${W.type}">${W.type}</span>
              <span class="event-title">${W.title}</span>
            </div>
            <span class="event-timestamp">${Y.formatTime(W.timestamp)}</span>
          </div>
          ${W.data?`<div class="event-data">${Y.formatJSON(W.data)}</div>`:""}
        `,Y.addAnimation(K),Q.eventsLog.appendChild(K)})},updateStats(){Q.totalEvents.textContent=Z.stats.totalEvents,Q.totalChannels.textContent=Z.channels.size},clear(){Z.events=[],Z.stats.totalEvents=0,$.render(),$.updateStats()}},H={subscribe(X){if(!Z.pusher||Z.pusher.connection.state!=="connected"){$.add({type:"error",title:"Cannot subscribe: Not connected",timestamp:Date.now()});return}if(Z.channels.has(X)){$.add({type:"system",title:`Already subscribed to ${X}`,timestamp:Date.now()});return}let W=null;if(Z.tagFiltering.enabled&&Z.tagFiltering.currentFilter)W=Z.tagFiltering.currentFilter,$.add({type:"system",title:`Subscribing to ${X} with tag filter`,timestamp:Date.now(),data:W});let K=Z.pusher.subscribe(X,W);Z.channels.set(X,{channel:K,filter:W}),H.bindChannelEvents(K,X),H.render(),H.updateDropdowns()},unsubscribe(X){if(Z.channels.has(X)){if(Z.pusher.unsubscribe(X),Z.channels.delete(X),Z.currentPresenceChannel&&Z.currentPresenceChannel.name===X)J.clear();H.render(),H.updateDropdowns()}},bindChannelEvents(X,W){if(X.bind("pusher:subscription_succeeded",(K)=>{if($.add({type:"system",title:` Subscribed to ${W}`,timestamp:Date.now(),data:K}),W.startsWith("presence-"))Z.currentPresenceChannel=X,J.update(X.members)}),X.bind("pusher:subscription_error",(K)=>{$.add({type:"error",title:` Subscription failed: ${W}`,timestamp:Date.now(),data:{status:K,channelName:W}})}),W.startsWith("presence-"))X.bind("pusher:member_added",(K)=>{if($.add({type:"member",title:`\uD83D\uDC4B Member joined ${W}`,timestamp:Date.now(),data:K}),Z.currentPresenceChannel===X)J.update(X.members)}),X.bind("pusher:member_removed",(K)=>{if($.add({type:"member",title:`\uD83D\uDC4B Member left ${W}`,timestamp:Date.now(),data:K}),Z.currentPresenceChannel===X)J.update(X.members)});X.bind_global((K,A)=>{if(!K.startsWith("pusher:")){console.log(`[Event] "${K}" on ${W}:`,A);let L=K.startsWith("client-")?"client":"custom";$.add({type:L,title:`\uD83D\uDCE1 ${K} on ${W}`,timestamp:Date.now(),data:A})}})},render(){Q.subscribedChannels.innerHTML="",Z.channels.forEach((X,W)=>{let K=document.createElement("div");K.className="channel-item";let A=Y.getChannelType(W),L=X.filter?' <i class="fas fa-filter" title="Filtered"></i>':"";K.innerHTML=`
          <div>
            <span class="channel-name">${W}${L}</span>
            <span class="channel-type ${A}">${A}</span>
          </div>
          <button class="btn btn-small btn-danger" onclick="channelManager.unsubscribe('${W}')">
            <i class="fas fa-times"></i> Unsubscribe
          </button>
        `,Y.addAnimation(K),Q.subscribedChannels.appendChild(K)}),Q.channelCount.textContent=Z.channels.size},updateDropdowns(){[Q.serverEventChannel,Q.clientEventChannel].forEach((K)=>{let A=K.value;K.innerHTML='<option value="">Select channel...</option>',Z.channels.forEach((L,C)=>{let O=document.createElement("option");if(O.value=C,O.textContent=C,C===A)O.selected=!0;K.appendChild(O)})});let X=Q.clientEventChannel.value!=="",W=Z.pusher?.connection?.state==="connected";Q.sendClientEventBtn.disabled=!X||!W}},J={update(X){if(!X){J.clear();return}if(Q.presenceChannelName.textContent=Z.currentPresenceChannel?.name||"None",Q.presenceCount.textContent=X.count||0,Q.presenceMembers.innerHTML="",X.count>0)X.each((W)=>{let K=document.createElement("div");K.className="member-item",console.log("Member:",W);let A=W.id===X.me?.id;K.innerHTML=`
            <img src="${W.info.user_info?.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(W.info.user_info.name)}&background=random`}" alt="${W.info.user_info.name}" class="member-avatar">
            <div class="member-info">
              <div class="member-name">${W.info.user_info.name}</div>
              <div class="member-id">${W.info.user_id}</div>
            </div>
            ${A?'<span class="member-badge">You</span>':""}
          `,Y.addAnimation(K),Q.presenceMembers.appendChild(K)});else Q.presenceMembers.innerHTML='<div class="member-item">No members present</div>'},clear(){Q.presenceChannelName.textContent="None",Q.presenceCount.textContent="0",Q.presenceMembers.innerHTML='<div class="member-item">Not subscribed to a presence channel</div>',Z.currentPresenceChannel=null}},G={async connect(){if(!Z.config){$.add({type:"error",title:"Configuration not loaded",timestamp:Date.now()});return}if(Z.pusher&&Z.pusher.connection.state!=="disconnected"){$.add({type:"system",title:"Already connected or connecting",timestamp:Date.now()});return}G.updateStatus("connecting","Connecting...");let X={cluster:Z.config.pusherCluster||"mt1",wsHost:Z.config.pusherHost||"localhost",wsPort:Z.config.pusherPort||6001,forceTLS:!1,disableStats:!0,enabledTransports:["ws"],authEndpoint:Z.config.authEndpoint,authTransport:"ajax",deltaCompression:{enabled:!0,algorithms:["fossil","xdelta3"],debug:!1,onStats:(W)=>{console.log("Delta Stats Update:",W),Q.deltaMessages.textContent=W.deltaMessages,Q.fullMessages.textContent=W.fullMessages,Q.bandwidthSaved.textContent=W.bandwidthSavedPercent.toFixed(1)+"%"},onError:(W)=>{console.error("Delta Compression Error:",W)}}};Z.pusher=new Pusher(Z.config.pusherKey,X),G.bindConnectionEvents()},disconnect(){if(Z.pusher)Z.pusher.disconnect()},bindConnectionEvents(){Z.pusher.connection.bind("connected",()=>{if(Z.stats.connectionStartTime=Date.now(),Z.stats.connectionTimer=setInterval(Y.updateConnectionTimer,1000),G.updateStatus("connected",`Connected (${Z.pusher.connection.socket_id})`),$.add({type:"system",title:"\uD83D\uDE80 Connected to WebSocket server",timestamp:Date.now(),data:{socketId:Z.pusher.connection.socket_id}}),Q.deltaCompressionToggle.disabled=!1,Z.pusher.deltaCompression)Z.pusher.deltaCompression.disable(),Q.deltaEnabled.textContent="No";Q.connectBtn.disabled=!0,Q.disconnectBtn.disabled=!1,Q.subscribeBtn.disabled=!1,H.updateDropdowns()}),Z.pusher.connection.bind("disconnected",()=>{if(Z.stats.connectionTimer)clearInterval(Z.stats.connectionTimer),Z.stats.connectionTimer=null;G.updateStatus("disconnected","Disconnected"),$.add({type:"system",title:"\uD83D\uDD0C Disconnected from server",timestamp:Date.now()}),Q.connectBtn.disabled=!1,Q.disconnectBtn.disabled=!0,Q.subscribeBtn.disabled=!0,Z.channels.clear(),H.render(),H.updateDropdowns(),J.clear()}),Z.pusher.connection.bind("connecting",()=>{G.updateStatus("connecting","Connecting...")}),Z.pusher.connection.bind("error",(X)=>{let W="Connection Error";if(X.error?.data)W+=`: ${X.error.data.code} - ${X.error.data.message}`;else if(X.message)W+=`: ${X.message}`;$.add({type:"error",title:W,timestamp:Date.now(),data:X}),G.updateStatus("error","Connection Error")}),Z.pusher.connection.bind("failed",()=>{$.add({type:"error",title:" Connection failed permanently",timestamp:Date.now()}),G.updateStatus("failed","Connection Failed"),Q.disconnectBtn.disabled=!0}),Z.pusher.bind_global((X,W,K)=>{if(console.log(`[Delta] Global event: ${X}, metadata:`,K),X==="pusher:delta_compression_enabled")Z.deltaCompression.enabled=!0,$.add({type:"system",title:" Delta compression enabled by server",timestamp:Date.now(),data:W})}),Z.pusher.connection.bind("pusher:error",(X)=>{if(X.data?.message?.includes("delta"))$.add({type:"error",title:`Delta compression error: ${X.data.message}`,timestamp:Date.now(),data:X})})},updateStatus(X,W){Q.connectionStatus.textContent=W,Q.statusDot.className=`status-dot ${X}`}},R={async send(){let X=Q.serverEventChannel.value,W=Q.serverEventName.value.trim(),K=Q.serverEventData.value.trim(),A=Q.serverEventTags.value.trim(),L=Q.conflationKey.value.trim();if(!X||!W){$.add({type:"error",title:"Channel and event name are required",timestamp:Date.now()});return}let C={};if(K)try{C=JSON.parse(K)}catch(T){$.add({type:"error",title:`Invalid JSON data: ${T.message}`,timestamp:Date.now()});return}let O=null;if(A)try{O=JSON.parse(A)}catch(T){$.add({type:"error",title:`Invalid JSON tags: ${T.message}`,timestamp:Date.now()});return}try{let T={channel:X,event:W,data:C};if(O)T.tags=O;if(L)T.conflation_key=L;let M=await(await fetch("/trigger-event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)})).json();if(M.success){let p=[];if(O)p.push("tags");if(L)p.push(`conflation: ${L}`);let ZQ=p.length?` (${p.join(", ")})`:"";$.add({type:"system",title:`\uD83D\uDCE4 Server event sent: ${W}  ${X}${ZQ}`,timestamp:Date.now(),data:{eventData:C,tags:O,conflation_key:L}}),Q.serverEventName.value="",Q.serverEventData.value="",Q.serverEventTags.value="",Q.conflationKey.value=""}else throw Error(M.error||"Failed to send event")}catch(T){$.add({type:"error",title:`Failed to send server event: ${T.message}`,timestamp:Date.now()})}},async sendBatch(){let X=Q.serverEventChannel.value;if(!X){$.add({type:"error",title:"Channel is required for batch events",timestamp:Date.now()});return}try{let K=await(await fetch("/trigger-batch-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channel:X,count:5,delay:500})})).json();if(K.success)$.add({type:"system",title:`\uD83D\uDCE4 Batch events triggered on ${X}`,timestamp:Date.now(),data:{message:K.message}});else throw Error(K.error||"Failed to trigger batch events")}catch(W){$.add({type:"error",title:`Failed to trigger batch events: ${W.message}`,timestamp:Date.now()})}}},V={send(){let X=Q.clientEventChannel.value,W=Q.clientEventName.value.trim(),K=Q.clientEventData.value.trim();if(!X||!W){$.add({type:"error",title:"Channel and event name are required",timestamp:Date.now()});return}if(!W.startsWith("client-")){$.add({type:"error",title:'Client event names must start with "client-"',timestamp:Date.now()});return}let A={};if(K)try{A=JSON.parse(K)}catch(C){$.add({type:"error",title:`Invalid JSON data: ${C.message}`,timestamp:Date.now()});return}let L=Z.channels.get(X);if(!L){$.add({type:"error",title:`Not subscribed to channel: ${X}`,timestamp:Date.now()});return}try{if(L.channel.trigger(W,A))$.add({type:"client",title:`\uD83D\uDCF1 Client event sent: ${W}  ${X}`,timestamp:Date.now(),data:A}),Q.clientEventName.value="",Q.clientEventData.value="";else throw Error("Failed to trigger client event")}catch(C){$.add({type:"error",title:`Failed to send client event: ${C.message}`,timestamp:Date.now()})}}},E={async fetch(){try{let W=await(await fetch("/webhooks-log")).json();if(Q.webhooksLog.innerHTML="",Q.webhookCount.textContent=W.length,W.length===0){Q.webhooksLog.innerHTML='<li class="webhook-item">No webhooks received yet</li>';return}W.forEach((K)=>{let A=document.createElement("li");A.className="webhook-item";let L=K.body?.events?.map((C)=>`${C.name} (${C.channel||"N/A"})`).join(", ")||"No events";A.innerHTML=`
            <div class="event-header">
              <div class="event-title">\uD83E\uDE9D ${L}</div>
              <div class="event-timestamp">${Y.formatTime(K.timestamp)}</div>
            </div>
            <div class="event-data">${Y.formatJSON(K.body)}</div>
          `,Y.addAnimation(A),Q.webhooksLog.appendChild(A)})}catch(X){$.add({type:"error",title:`Failed to fetch webhooks: ${X.message}`,timestamp:Date.now()})}},clear(){Q.webhooksLog.innerHTML="",Q.webhookCount.textContent="0"}},U=async()=>{try{let X=await fetch("/config");if(!X.ok)throw Error(`HTTP error! status: ${X.status}`);Z.config=await X.json(),Q.configDisplay.textContent=Y.formatJSON(Z.config),Q.connectBtn.disabled=!1,$.add({type:"system",title:" Configuration loaded successfully",timestamp:Date.now()})}catch(X){Q.configDisplay.textContent=`Error loading config: ${X.message}`,Q.connectBtn.disabled=!0,$.add({type:"error",title:`Configuration load failed: ${X.message}`,timestamp:Date.now()})}},j={enable(){if(!Z.pusher){console.error("Pusher not initialized"),$.add({type:"error",title:"Cannot enable delta compression: Not connected",timestamp:Date.now()});return}if(!Z.pusher.deltaCompression){console.error("Delta compression not available on Pusher instance"),$.add({type:"error",title:"Delta compression not available. Make sure deltaCompression config is set.",timestamp:Date.now()});return}Z.pusher.deltaCompression.enable(),Z.deltaCompression.enabled=!0,Q.deltaEnabled.textContent="Yes",$.add({type:"system",title:"\uD83D\uDDDC Delta compression enabled",timestamp:Date.now()})},disable(){if(!Z.pusher||!Z.pusher.deltaCompression)return;Z.pusher.deltaCompression.disable(),Z.deltaCompression.enabled=!1,Q.deltaEnabled.textContent="No",$.add({type:"system",title:"Delta compression disabled",timestamp:Date.now()})}};Q.connectBtn.addEventListener("click",G.connect),Q.disconnectBtn.addEventListener("click",G.disconnect),Q.subscribeBtn.addEventListener("click",()=>{let X=Q.channelNameInput.value.trim();if(X)H.subscribe(X),Q.channelNameInput.value=""}),Q.deltaCompressionToggle.addEventListener("change",(X)=>{if(X.target.checked)j.enable();else j.disable()}),Q.enableTagFilter.addEventListener("change",(X)=>{if(Z.tagFiltering.enabled=X.target.checked,Q.tagFilterControls.style.display=X.target.checked?"block":"none",!X.target.checked)Z.tagFiltering.currentFilter=null,Q.filterJson.value=""}),Q.filterPreset.addEventListener("change",(X)=>{let W=X.target.value,K=null,A=window.Filter;if(!A){console.error("Filter class not available");return}switch(W){case"goals":K=A.eq("event_type","goal");break;case"goals-shots":K=A.in("event_type",["goal","shot"]);break;case"high-xg":K=A.gte("xG","0.8");break;case"goals-high-xg":K=A.or(A.eq("event_type","goal"),A.and(A.eq("event_type","shot"),A.gte("xG","0.8")));break}if(K)Q.filterJson.value=JSON.stringify(K,null,2),Z.tagFiltering.currentFilter=K}),Q.filterJson.addEventListener("input",(X)=>{try{if(X.target.value.trim()){let W=JSON.parse(X.target.value);Z.tagFiltering.currentFilter=W}else Z.tagFiltering.currentFilter=null}catch(W){}}),Q.channelNameInput.addEventListener("keypress",(X)=>{if(X.key==="Enter")Q.subscribeBtn.click()}),Q.sendServerEventBtn.addEventListener("click",R.send),Q.sendBatchEventsBtn.addEventListener("click",R.sendBatch),Q.sendClientEventBtn.addEventListener("click",V.send),Q.clientEventChannel.addEventListener("change",H.updateDropdowns),Q.clearEventsBtn.addEventListener("click",$.clear),Q.exportEventsBtn.addEventListener("click",Y.exportEvents),Q.fetchWebhooksBtn.addEventListener("click",E.fetch),Q.clearWebhooksBtn.addEventListener("click",E.clear),document.querySelectorAll(".filter-btn").forEach((X)=>{X.addEventListener("click",()=>{document.querySelectorAll(".filter-btn").forEach((W)=>{W.classList.remove("active")}),X.classList.add("active"),Z.currentEventFilter=X.dataset.filter,$.render()})}),window.channelManager=H,U(),$.render(),J.clear(),E.fetch(),setInterval(E.fetch,30000)});window.Pusher=D;window.Filter=S;window.FilterExamples=kQ;window.FilterExamples=kQ;
